!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=128)}([function(t,e,n){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,n){"use strict";e.__esModule=!0;var i=n(146),r=function(t){return t&&t.__esModule?t:{default:t}}(i);e.default=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,r.default)(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()},function(t,e,n){"use strict";e.__esModule=!0;var i=n(4),r=function(t){return t&&t.__esModule?t:{default:t}}(i);e.default=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":(0,r.default)(e))&&"function"!=typeof e?t:e}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(174),o=i(r),a=n(178),s=i(a),u=n(4),l=i(u);e.default=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":(0,l.default)(e)));t.prototype=(0,s.default)(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(o.default?(0,o.default)(t,e):t.__proto__=e)}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(149),o=i(r),a=n(151),s=i(a),u="function"==typeof s.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":typeof t};e.default="function"==typeof s.default&&"symbol"===u(o.default)?function(t){return void 0===t?"undefined":u(t)}:function(t){return t&&"function"==typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":void 0===t?"undefined":u(t)}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(194),o=i(r),a=n(197),s=i(a);e.default=function t(e,n,i){null===e&&(e=Function.prototype);var r=(0,s.default)(e,n);if(void 0===r){var a=(0,o.default)(e);return null===a?void 0:t(a,n,i)}if("value"in r)return r.value;var u=r.get;return void 0!==u?u.call(i):void 0}},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(27)),i(n(10)),i(n(185)),i(n(186))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(162)),i(n(41)),i(n(20)),i(n(99)),i(n(51)),i(n(172)),i(n(22)),i(n(81)),i(n(52)),i(n(15))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(6),d=n(56),p=n(17),AutoComponent=function(t){function AutoComponent(t){(0,o.default)(this,AutoComponent);var e=(0,l.default)(this,(AutoComponent.__proto__||Object.getPrototypeOf(AutoComponent)).call(this,t));return e.opts=t,e}return(0,h.default)(AutoComponent,t),(0,s.default)(AutoComponent,[{key:"debugText",value:function(t){return p.Game.debugText(t)}},{key:"playOneShot",value:function(t){p.Game.SOUNDS[t].play()}},{key:"removeSelf",value:function(){this.entity.remove(this)}},{key:"destroyEntity",value:function(){this.entity.scene.remove(this.entity)}},{key:"level",get:function(){return this.scene instanceof d.Level?this.scene:null}}]),AutoComponent}(f.Component);e.AutoComponent=AutoComponent},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(117)),i(n(202)),i(n(203)),i(n(204))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c,h=n(50),f=n(79),d=n(173),p=n(181),y=n(182),v=n(28),m=n(108),g=n(52);!function(t){t[t.Desktop=0]="Desktop",t[t.Web=1]="Web"}(c=e.Client||(e.Client={}));var _=function(){function t(){if((0,s.default)(this,t),this.scene=null,this.nextScene=null,this.dt=0,this.elapsed=0,this.paused=!1,this.frameCount=0,this.lastTime=0,this.timeScale=1,null!=t.instance)throw Error("Engine has already been instantiated");if(!t.started)throw Error("Engine must be instantiated through static Engine.start");t.instance=this,this.client=c.Web,window&&window.process&&window.process.versions&&window.process.versions.electron&&(this.client=c.Desktop),this.startTime=Date.now(),this.lastTime=Date.now()}return(0,l.default)(t,[{key:"step",value:function(){var e=Date.now();this.dt=this.paused?0:Math.floor(e-this.lastTime)/1e3*this.timeScale,this.lastTime=e,this.frameCount++,this.elapsed+=this.dt,this.graphics.update(),v.Mouse.update(),v.Keyboard.update(),v.GamepadManager.update(),null!=this.nextScene&&(null!=this.scene&&(this.scene.ended(),this.disposeLastScene&&this.scene.dispose()),this.scene=this.nextScene,this.nextScene=null,this.scene.begin()),null!=this.scene&&this.scene.update(),null==this.nextScene&&(this.graphics.reset(),null!=this.scene&&this.scene.render(),this.graphics.finalize());var n=!0,i=!1,r=void 0;try{for(var o,a=f.Sound.active[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)o.value.update()}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}t.exiting||requestAnimationFrame(this.step.bind(this))}},{key:"exit",value:function(){t.exiting=!0,h.Assets.unload(),t.graphics.unload(),t.client===c.Desktop&&n(103).remote.getCurrentWindow().close()}}],[{key:"start",value:function(e,n,i,r,a){t.started=!0,new t,new p.GameWindow,document.addEventListener("visibilitychange",function(){document.hidden?t._hidden=!0:(t._hidden=!1,t.instance&&(t.instance.lastTime=Date.now()))}),window.addEventListener("blur",function(){return v.Keyboard.releaseAllKeys()});var s=function(){var t=window,e=t.innerWidth,r=t.innerHeight;return e>r?[Math.floor(e/r*i),i]:[n,Math.floor(r/e*n)]},u=function(){var e=s(),n=(0,o.default)(e,2),i=n[0],r=n[1];t.resize(i,r)},l=n,c=i;if(t.isMobile){window.addEventListener("orientationchange",u,!1);var h=s(),f=(0,o.default)(h,2);l=f[0],c=f[1]}p.GameWindow.title=e,p.GameWindow.resize(l*r,c*r),p.GameWindow.center();var _=function(){String.fromCharCode(9679),t.instance.root=document.getElementsByClassName("container")[0],d.registerDefaultOverlapTests(),m.FosterIO.init(),t.instance.graphics=new y.Graphics(t.instance),t.instance.graphics.load(),t.resize(l,c),g.Shaders.init(),v.Mouse.init(),v.Keyboard.init(),v.GamepadManager.init(),t.instance.step(),void 0!==a&&a()};"complete"===document.readyState||"interactive"===document.readyState?_():document.addEventListener("DOMContentLoaded",_)}},{key:"goto",value:function(e,n){return t.scene,t.instance.nextScene=e,t.instance.disposeLastScene=n,e}},{key:"exit",value:function(){t.started&&!t.exiting&&t.instance.exit()}},{key:"resize",value:function(e,n){t.instance.width=e,t.instance.height=n,t.instance.graphics.resize()}},{key:"assert",value:function(t,e){if(!t)throw e;return t}},{key:"root",get:function(){return t.instance.root}},{key:"client",get:function(){return t.instance.client}},{key:"scene",get:function(){return null!=t.instance.nextScene?t.instance.nextScene:t.instance.scene}},{key:"width",get:function(){return t.instance.width}},{key:"height",get:function(){return t.instance.height}},{key:"debugMode",get:function(){return t.instance.debuggerEnabled},set:function(e){t.instance.debuggerEnabled=e}},{key:"delta",get:function(){return t.instance.paused?0:t.instance.dt}},{key:"elapsed",get:function(){return t.instance.elapsed}},{key:"paused",get:function(){return this._hidden||t.instance.paused},set:function(e){t.instance.paused=e}},{key:"timeScale",get:function(){return t.instance.timeScale},set:function(e){t.instance.timeScale=e}},{key:"frameCount",get:function(){return t.instance.frameCount}},{key:"graphics",get:function(){return t.instance.graphics}},{key:"volume",get:function(){return t._volume},set:function(e){t._volume=e;var n=!0,i=!1,r=void 0;try{for(var o,a=f.Sound.active[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.volume=s.volume}}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}}},{key:"muted",get:function(){return t._muted},set:function(e){t._muted=e;var n=!0,i=!1,r=void 0;try{for(var o,a=f.Sound.active[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.muted=s.muted}}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}}},{key:"isMobile",get:function(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}}]),t}();_.version="0.1.11",_._volume=1,_._muted=!1,_._hidden=!1,_.instance=null,_.started=!1,_.exiting=!1,e.Engine=_},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(129),o=i(r),a=n(143),s=i(a);e.default=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,u=(0,s.default)(t);!(i=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if((0,o.default)(Object(e)))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(43)),i(n(101)),i(n(102))},function(t,e,n){(function(t,e){/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n;!function(n){"use strict";function i(t,e,n,i){if(E(n)){if(!j(t))throw new TypeError;if(!F(e))throw new TypeError;return d(t,e)}if(!j(t))throw new TypeError;if(!T(e))throw new TypeError;if(!T(i)&&!E(i)&&!O(i))throw new TypeError;return O(i)&&(i=void 0),n=M(n),p(t,e,n,i)}function r(t,e){function n(n,i){if(!T(n))throw new TypeError;if(!E(i)&&!D(i))throw new TypeError;b(t,e,n,i)}return n}function o(t,e,n,i){if(!T(n))throw new TypeError;return E(i)||(i=M(i)),b(t,e,n,i)}function a(t,e,n){if(!T(e))throw new TypeError;return E(n)||(n=M(n)),v(t,e,n)}function s(t,e,n){if(!T(e))throw new TypeError;return E(n)||(n=M(n)),m(t,e,n)}function u(t,e,n){if(!T(e))throw new TypeError;return E(n)||(n=M(n)),g(t,e,n)}function l(t,e,n){if(!T(e))throw new TypeError;return E(n)||(n=M(n)),_(t,e,n)}function c(t,e){if(!T(t))throw new TypeError;return E(e)||(e=M(e)),w(t,e)}function h(t,e){if(!T(t))throw new TypeError;return E(e)||(e=M(e)),x(t,e)}function f(t,e,n){if(!T(e))throw new TypeError;E(n)||(n=M(n));var i=y(e,n,!1);if(E(i))return!1;if(!i.delete(t))return!1;if(i.size>0)return!0;var r=tt.get(e);return r.delete(n),r.size>0||(tt.delete(e),!0)}function d(t,e){for(var n=t.length-1;n>=0;--n){var i=t[n],r=i(e);if(!E(r)&&!O(r)){if(!F(r))throw new TypeError;e=r}}return e}function p(t,e,n,i){for(var r=t.length-1;r>=0;--r){var o=t[r],a=o(e,n,i);if(!E(a)&&!O(a)){if(!T(a))throw new TypeError;i=a}}return i}function y(t,e,n){var i=tt.get(t);if(E(i)){if(!n)return;i=new Q,tt.set(t,i)}var r=i.get(e);if(E(r)){if(!n)return;r=new Q,i.set(e,r)}return r}function v(t,e,n){if(m(t,e,n))return!0;var i=V(e);return!O(i)&&v(t,i,n)}function m(t,e,n){var i=y(e,n,!1);return!E(i)&&A(i.has(t))}function g(t,e,n){if(m(t,e,n))return _(t,e,n);var i=V(e);return O(i)?void 0:g(t,i,n)}function _(t,e,n){var i=y(e,n,!1);if(!E(i))return i.get(t)}function b(t,e,n,i){y(n,i,!0).set(t,e)}function w(t,e){var n=x(t,e),i=V(t);if(null===i)return n;var r=w(i,e);if(r.length<=0)return n;if(n.length<=0)return r;for(var o=new Z,a=[],s=0,u=n;s<u.length;s++){var l=u[s],c=o.has(l);c||(o.add(l),a.push(l))}for(var h=0,f=r;h<f.length;h++){var l=f[h],c=o.has(l);c||(o.add(l),a.push(l))}return a}function x(t,e){var n=[],i=y(t,e,!1);if(E(i))return n;for(var r=i.keys(),o=N(r),a=0;;){var s=G(o);if(!s)return n.length=a,n;var u=I(s);try{n[a]=u}catch(t){try{U(o)}finally{throw t}}a++}}function k(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function E(t){return void 0===t}function O(t){return null===t}function S(t){return"symbol"==typeof t}function T(t){return"object"==typeof t?null!==t:"function"==typeof t}function C(t,e){switch(k(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",i=B(t,W);if(void 0!==i){var r=i.call(t,n);if(T(r))throw new TypeError;return r}return P(t,"default"===n?"number":n)}function P(t,e){if("string"===e){var n=t.toString;if(L(n)){var i=n.call(t);if(!T(i))return i}var r=t.valueOf;if(L(r)){var i=r.call(t);if(!T(i))return i}}else{var r=t.valueOf;if(L(r)){var i=r.call(t);if(!T(i))return i}var o=t.toString;if(L(o)){var i=o.call(t);if(!T(i))return i}}throw new TypeError}function A(t){return!!t}function R(t){return""+t}function M(t){var e=C(t,3);return S(e)?e:R(e)}function j(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function L(t){return"function"==typeof t}function F(t){return"function"==typeof t}function D(t){switch(k(t)){case 3:case 4:return!0;default:return!1}}function B(t,e){var n=t[e];if(void 0!==n&&null!==n){if(!L(n))throw new TypeError;return n}}function N(t){var e=B(t,K);if(!L(e))throw new TypeError;var n=e.call(t);if(!T(n))throw new TypeError;return n}function I(t){return t.value}function G(t){var e=t.next();return!e.done&&e}function U(t){var e=t.return;e&&e.call(t)}function V(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===q)return e;if(e!==q)return e;var n=t.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return e;var r=i.constructor;return"function"!=typeof r?e:r===t?e:r}function H(t){return t.__=void 0,delete t.__,t}var X,z=Object.prototype.hasOwnProperty,Y="function"==typeof Symbol,W=Y&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",K=Y&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator";!function(t){var e="function"==typeof Object.create,n={__proto__:[]}instanceof Array,i=!e&&!n;t.create=e?function(){return H(Object.create(null))}:n?function(){return H({__proto__:null})}:function(){return H({})},t.has=i?function(t,e){return z.call(t,e)}:function(t,e){return e in t},t.get=i?function(t,e){return z.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}}(X||(X={}));var q=Object.getPrototypeOf(Function),J="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,Q=J||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){function t(t,e){return t}function e(t,e){return e}function n(t,e){return[t,e]}var i={},r=[],o=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[K]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var e=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:e,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:t,done:!0}},t}();return function(){function r(){this._keys=[],this._values=[],this._cacheKey=i,this._cacheIndex=-2}return Object.defineProperty(r.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),r.prototype.has=function(t){return this._find(t,!1)>=0},r.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},r.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},r.prototype.delete=function(t){var e=this._find(t,!1);if(e>=0){for(var n=this._keys.length,r=e+1;r<n;r++)this._keys[r-1]=this._keys[r],this._values[r-1]=this._values[r];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=i,this._cacheIndex=-2),!0}return!1},r.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=i,this._cacheIndex=-2},r.prototype.keys=function(){return new o(this._keys,this._values,t)},r.prototype.values=function(){return new o(this._keys,this._values,e)},r.prototype.entries=function(){return new o(this._keys,this._values,n)},r.prototype["@@iterator"]=function(){return this.entries()},r.prototype[K]=function(){return this.entries()},r.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},r}()}():Map,Z=J||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){return function(){function t(){this._map=new Q}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[K]=function(){return this.keys()},t}()}():Set,$=J||"function"!=typeof WeakMap?function(){function t(){var t;do{t="@@WeakMap@@"+r()}while(X.has(a,t));return a[t]=!0,t}function e(t,e){if(!z.call(t,s)){if(!e)return;Object.defineProperty(t,s,{value:X.create()})}return t[s]}function n(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function i(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):n(new Uint8Array(t),t):n(Array(t),t)}function r(){var t=i(o);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var e="",n=0;n<o;++n){var r=t[n];4!==n&&6!==n&&8!==n||(e+="-"),r<16&&(e+="0"),e+=r.toString(16).toLowerCase()}return e}var o=16,a=X.create(),s=t();return function(){function n(){this._key=t()}return n.prototype.has=function(t){var n=e(t,!1);return void 0!==n&&X.has(n,this._key)},n.prototype.get=function(t){var n=e(t,!1);return void 0!==n?X.get(n,this._key):void 0},n.prototype.set=function(t,n){return e(t,!0)[this._key]=n,this},n.prototype.delete=function(t){var n=e(t,!1);return void 0!==n&&delete n[this._key]},n.prototype.clear=function(){this._key=t()},n}()}():WeakMap,tt=new $;n.decorate=i,n.metadata=r,n.defineMetadata=o,n.hasMetadata=a,n.hasOwnMetadata=s,n.getMetadata=u,n.getOwnMetadata=l,n.getMetadataKeys=c,n.getOwnMetadataKeys=h,n.deleteMetadata=f,function(t){if(void 0!==t.Reflect){if(t.Reflect!==n)for(var e in n)z.call(n,e)&&(t.Reflect[e]=n[e])}else t.Reflect=n}(void 0!==e?e:"undefined"!=typeof self?self:Function("return this;")())}(n||(n={}))}).call(e,n(77),n(78))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(200)),i(n(116)),i(n(201))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(41),l=function(){function t(e,n){(0,o.default)(this,t),this.x=0,this.y=0,void 0!==e&&(this.x=e),void 0!==n&&(this.y=n)}return(0,s.default)(t,[{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"add",value:function(t){return"number"==typeof t?(this.x+=t,this.y+=t):(this.x+=t.x,this.y+=t.y),this}},{key:"sub",value:function(t){return"number"==typeof t?(this.x-=t,this.y-=t):(this.x-=t.x,this.y-=t.y),this}},{key:"max",value:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}},{key:"min",value:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}},{key:"mult",value:function(t){return"number"==typeof t?(this.x*=t,this.y*=t):(this.x*=t.x,this.y*=t.y),this}},{key:"div",value:function(t){return"number"==typeof t?(this.x/=t,this.y/=t):(this.x/=t.x,this.y/=t.y),this}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this}},{key:"rotate",value:function(t,e){var n=this.x,i=this.y;return this.x=n*e-i*t,this.y=n*t+i*e,this}},{key:"approach",value:function(t,e){this.x=u.Calc.approach(this.x,t.x,e),this.y=u.Calc.approach(this.y,t.y,e)}},{key:"transform",value:function(t){var e=this.x,n=this.y;return this.x=t.mat[0]*e+t.mat[3]*n+t.mat[6],this.y=t.mat[1]*e+t.mat[4]*n+t.mat[7],this}},{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"normalize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this.length;return this.x=this.x/e*t,this.y=this.y/e*t,this}},{key:"length",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"angle",get:function(){return Math.atan2(this.y,this.x)}},{key:"normal",get:function(){var e=this.length;return new t(this.x/e,this.y/e)}}],[{key:"distance",value:function(e,n){return t._dist_temp.copy(e).sub(n).length}},{key:"zero",get:function(){return t._zero.set(0,0)}}]),t}();l._dist_temp=new l,l.directions=[new l(-1,0),new l(0,-1),new l(1,0),new l(0,1)],l.temp0=new l,l.temp1=new l,l.temp2=new l,l.temp3=new l,l.temp4=new l,l.temp5=new l,l.up=new l(0,-1),l.down=new l(0,1),l.left=new l(-1,0),l.right=new l(1,0),l._zero=new l,e.Vector=l},function(t,e,n){"use strict";function i(t){if(t.indexOf("_")!==t.lastIndexOf("_"))throw Error("only zero or one underscores permitted in name '"+t+"'");var e=t.split("_"),n=(0,c.default)(e,2);return[n[0],n[1]]}function r(t,e,n,r){var o=p[t];if(!o)throw Error("no prefab named "+t);e||(e=new f.Entity),void 0!==n&&(e.x=n),void 0!==r&&(e.y=r),void 0===e.name&&(e.name=t);var a=!0,s=!1,u=void 0;try{for(var l,d=Object.keys(o)[Symbol.iterator]();!(a=(l=d.next()).done);a=!0){var y=l.value,v=i(y),m=(0,c.default)(v,2),g=m[0],_=m[1],b=o[y],w=h.getComponentByName(g);if(!w)throw Error("no component named '"+g+"' found in template:\n "+JSON.stringify(o,null,2));var x=new w(b);x.prefabLink=b,e.add(x),void 0!==_&&(e.componentByName[_]=x)}}catch(t){s=!0,u=t}finally{try{!a&&d.return&&d.return()}finally{if(s)throw u}}return e}function o(){return p}function a(t){p=t}function s(){function t(){}var e=window.LiveReload;e&&(t.identifier="Foo2",t.prototype.reload=function(t,e){return!!(y>0&&t.endsWith("prefabs.json"))&&(y-=1,!0)},e.addPlugin(t))}function u(){function t(t){if(t.status>=200&&t.status<300)return t;var e=Error(t.statusText);throw e.response=t,e}y=2,fetch("/prefabs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o())}).then(t).then(function(t){return t.text()}).then(function(t){d.Game.debugText("Saved prefabs at "+f.Engine.elapsed+": "+t)}).catch(function(t){})}var l=n(11),c=function(t){return t&&t.__esModule?t:{default:t}}(l);Object.defineProperty(e,"__esModule",{value:!0});var h=n(23),f=n(6),d=n(17);e.instantiatePrefab=r;var p={};e.getPrefabs=o,e.setPrefabs=a;var y=0;e.initPrefabs=s,e.sendPrefabsToServer=u,e.default=p},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(){A=n(241),A.defineTemplates()}function o(t){var e=[];return JSON.stringify(t,function(t,n){if("object"===(void 0===n?"undefined":(0,d.default)(n))&&null!==n){if(-1!==e.indexOf(n))return;e.push(n)}return n},2)}var a=n(11),s=i(a),u=n(0),l=i(u),c=n(1),h=i(c),f=n(4),d=i(f);Object.defineProperty(e,"__esModule",{value:!0});var p=n(6),y=n(54),v=n(189),m=n(44),g=n(190),_=n(191),b=(n(45),n(192)),w=n(28),x=n(7),k=n(55),E=n(193),O=n(56),S=n(87),T=n(239),C=n(240),P=(n(34),n(16)),A=void 0,R=function(){function t(){(0,l.default)(this,t)}return(0,h.default)(t,null,[{key:"start",value:function(){p.Engine.start("Traplands",320,288,1,function(){p.Engine.graphics.clearColor=t.transitionColor,t.load()})}},{key:"load",value:function(){var e=t.KEYS;m.Input.mapAnyControllerButton(0,e.SHOOT),m.Input.mapAnyControllerButton(3,e.RESTART),m.Input.mapAnyControllerButton(9,e.BACK_TO_TITLE),m.Input.mapAnyControllerButton(12,e.UP),m.Input.mapAnyControllerButton(13,e.DOWN),m.Input.mapAnyControllerButton(14,e.LEFT),m.Input.mapAnyControllerButton(15,e.RIGHT),m.Input.mapKeys([w.Key.left,w.Key.a,w.Key.j],e.LEFT),m.Input.mapKeys([w.Key.right,w.Key.d,w.Key.l],e.RIGHT),m.Input.mapKeys([w.Key.up,w.Key.w,w.Key.i],e.UP),m.Input.mapKeys([w.Key.down,w.Key.s,w.Key.k],e.DOWN),m.Input.mapKeys([w.Key.space],e.SHOOT),m.Input.mapKeys([w.Key.r],e.RESTART),m.Input.mapKeys([w.Key.enter],e.START),m.Input.mapKeys([w.Key.escape],e.BACK_TO_TITLE),r(),UpdateLoadingBarProgress(.25),t.loadAssets()}},{key:"getAtlasReaderByName",value:function(t){switch(t){case"DoodleStudio":return g.AtlasReaders.DoodleStudio;case"Asesprite":return g.AtlasReaders.Aseprite;default:throw Error("expected a loaderType but got "+t)}}},{key:"loadAssets",value:function(){var e=new y.AssetLoader("assets");e.progressCallback=function(t){UpdateLoadingBarProgress(.25+.75*t)};var i="fantasy/TMX/";e.addAtlas("sprites","sprites/sprite_atlas.png","sprites/sprite_atlas.json",g.AtlasReaders.Aseprite).addXml(i+"oryx_creatures.xml").addXml(i+"oryx_items.xml").addXml(i+"oryx_world2.xml").addTexture(i+"../oryx_world2.png").addTexture(i+"../oryx_creatures.png").addTexture(i+"../oryx_items.png").addJson("prefabs.json").addSound("coin","sounds/coin.ogg").addSound("hurt","sounds/Hit_Hurt5.ogg").addSound("shotHit","sounds/shot_hit.ogg").addSound("emptyBreath","sounds/emptyBreath.ogg").addSound("pickupTreasure","sounds/coin.ogg").addSound("treeShootRoots","sounds/tree.ogg").addSound("iceExplode","sounds/iceExplode.ogg").addSound("pickupHeart","sounds/pickupHeart.ogg").addSound("blockPush","sounds/blockPush.ogg").addSound("stonePush","sounds/stonePush.ogg").addSound("exit","sounds/exit.ogg").addSound("dragonFlame","sounds/dragonFlame.ogg").addSound("onionDie","sounds/onionDie.ogg").addSound("flameHit","sounds/flameHit.ogg").addSound("spit","sounds/spit.ogg").addSound("doorOpen","sounds/doorOpen.ogg").load(function(){t.levels=n(242).levels,P.setPrefabs(y.Assets.json["assets/prefabs.json"]),RemoveLoadingBar(),t.begin()})}},{key:"debugText",value:function(e){e="object"===(void 0===e?"undefined":(0,d.default)(e))?o(e):e,t.getConsoleEl().innerText=""+e}},{key:"markLevelCompleted",value:function(t,e){b.SaveGame.markLevelCompleted(t,e),_.Analytics.onLevelCompleted(t)}},{key:"getEffectsForNextLevelName",value:function(t){return b.SaveGame.getEffectsForNextLevelName(t)}},{key:"getNextLevelName",value:function(t){return b.SaveGame.getNextLevelName(t)}},{key:"getNextLevelNameAndEffects",value:function(t){return b.SaveGame.getNextLevelNameAndEffects(t)}},{key:"clearCompletedLevels",value:function(){return b.SaveGame.clearCompletedLevels()}},{key:"getConsoleEl",value:function(){var t=document.getElementById("debug_console");return t||(t=document.createElement("pre"),t.setAttribute("id","debug_console"),document.body.appendChild(t)),t}},{key:"getStartScene",value:function(){return new S.TitleScreen}},{key:"getDebugStartScene",value:function(){var e=void 0,i=window.location.search;if(i.length>1&&"?"===i[0]){if(e=i.slice(1),-1!==e.indexOf("=")){var r=e.split("="),o=(0,s.default)(r,2),a=o[0],u=o[1];switch(a){case"prefab":return new C.PrefabTestScene(u);default:throw Error("unknown key "+a)}}}else e=localStorage.getItem("lastDevLevel")||t.levels[0];switch(e){case"title":return new S.TitleScreen;case"depth_test":return this.getDepthTestScene();case"endscreen":return new T.EndScreen;case"hitgrid_test":return new(n(125).HitgridHolesTestScene)}return new O.Level(e)}},{key:"getDepthTestScene",value:function(){var e=n(243),i=new e.GUI;i.add(p.Engine.graphics,"depthTestEnabled");var Sprite=n(9).Sprite,r=n(6).Entity,o=(n(9).Rectsprite,new p.Scene),a=new r;a.add(new Sprite({animation:"guy",play:"idle"}));var s=a.add(new Sprite({animation:"guy",play:"idle",x:10,y:10}));i.add(s,"zOverride",-1,1);var u=a.update;return a.update=function(){t.debugText({drawCalls:p.Engine.graphics.drawCalls}),u.call(a)},o.add(a),o}},{key:"begin",value:function(){p.Engine.graphics.pixel=y.Assets.atlases.sprites.get("pixel"),P.initPrefabs(),E.loadAutoSprites();var e=!0,n=!1,i=void 0;try{for(var r,o=Object.entries(y.Assets.sounds)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=(0,s.default)(r.value,2),u=a[0],l=(a[1],new v.Sound(u));t.SOUNDS[u]=l}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}k.TouchInput.init(p.Engine.graphics.canvas),p.Engine.goto(t.getStartScene(),!1)}},{key:"hasLevelsCompleted",get:function(){return b.SaveGame.hasLevelsCompleted}},{key:"EndScreen",get:function(){return new T.EndScreen}}]),t}();R.developer=!1,R.config={reloadTimeAfterDeath:1.1},R.cheats={unlimitedAmmo:!1},R.TAGS={PLAYER:"player",SOLID:"solid",ENEMY_SOLID:"enemy_solid"},R.KEYS={LEFT:"left",RIGHT:"right",UP:"up",DOWN:"down",SHOOT:"shoot",START:"start",BACK_TO_TITLE:"back_to_title",RESTART:"restart",DEBUG_TOGGLE_OVERLAY:"debug_toggle_overlay",DEBUG_PAUSE:"pause",DEBUG_FINISH_LEVEL:"finish_level",DEBUG_FAST_FORWARD:"fast_forward",DEBUG_NEXT_LEVEL:"debug_next_level",DEBUG_PREV_LEVEL:"debug_prev_level",DEBUG_OPEN_DOOR:"debug_open_door",DEBUG_OPEN_TREASURE:"debug_open_treasure",DEBUG_EDIT_MAP:"debug_edit_map"},R.SOUNDS={},R.COLORS=[new x.Color(155/255,188/255,15/255,1),new x.Color(139/255,172/255,15/255,1),new x.Color(48/255,98/255,48/255,1),new x.Color(15/255,56/255,15/255,1)],R.transitionColor=new x.Color(0,.25,.05),R.levels=[],R.debugConsoleId="debug_console",e.Game=R},function(t,e){var n=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(t,e,n){var i=n(69)("wks"),r=n(48),o=n(25).Symbol,a="function"==typeof o;(t.exports=function(t){return i[t]||(i[t]=a&&o[t]||(a?o:r)("Symbol."+t))}).store=i},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(e,n,i,r){(0,o.default)(this,t),this.color=[0,0,0,1],this.r=e||0,this.g=n||0,this.b=i||0,this.a=r||1}return(0,s.default)(t,[{key:"toString",value:function(){return"Color("+this.r+", "+this.g+", "+this.b+", "+this.a+")"}},{key:"set",value:function(t,e,n,i){return this.r=t,this.g=e,this.b=n,this.a=i,this}},{key:"copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"lerp",value:function(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this.a=t.a+(e.a-t.a)*n,this}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"mult",value:function(t){return this.set(this.r,this.g,this.b,this.a*t)}},{key:"r",get:function(){return this.color[0]},set:function(t){this.color[0]=Math.min(1,Math.max(0,t))}},{key:"g",get:function(){return this.color[1]},set:function(t){this.color[1]=Math.min(1,Math.max(0,t))}},{key:"b",get:function(){return this.color[2]},set:function(t){this.color[2]=Math.min(1,Math.max(0,t))}},{key:"a",get:function(){return this.color[3]},set:function(t){this.color[3]=Math.min(1,Math.max(0,t))}},{key:"rgba",get:function(){return this.color}}],[{key:"fromHex",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e=e.replace("#",""),new t(parseInt(3===e.length?e.slice(0,1).repeat(2):e.slice(0,2),16)/255,parseInt(3===e.length?e.slice(1,2).repeat(2):e.slice(2,4),16)/255,parseInt(3===e.length?e.slice(2,3).repeat(2):e.slice(4,6),16)/255,n)}}]),t}();u.white=new u(1,1,1,1),u.black=new u(0,0,0,1),u.red=new u(1,0,0,1),u.green=new u(0,1,0,1),u.blue=new u(0,0,1,1),u.temp=new u,e.Color=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(5),o=i(r),a=n(2),s=i(a),u=n(3),l=i(u),c=n(37),h=i(c),f=n(11),d=i(f),p=n(0),y=i(p),v=n(1),m=i(v),g=n(4),_=i(g),b=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,_.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var w=n(6),x=n(23),k=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;(0,y.default)(this,t),"string"==typeof e&&(e=[[e,[]]]),this.callInfos=e||[],n&&this.bind(n)}return(0,m.default)(t,[{key:"hasCallbacks",get:function(){return this.callInfos.length>0}}]),(0,m.default)(t,[{key:"bind",value:function(t){this.cbs=E.makeCalls(t,this.callInfos)}},{key:"invoke",value:function(){if(this.cbs){var t=!0,e=!1,n=void 0;try{for(var i,r=this.cbs[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)i.value.apply(void 0,arguments)}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}}}]),t}();e.EventDelegate=k;var E=function(){function t(){(0,y.default)(this,t)}return(0,m.default)(t,null,[{key:"makeCalls",value:function(e,n){var i=[];if(void 0!==n){"string"==typeof n&&(n=[[n,[]]]);var r=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value;i.push(t.makeCall(e,l))}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}}return i}},{key:"makeCall",value:function(e,n){if("string"==typeof n&&(n=[n,[]]),n instanceof Array){var i=n,r=(0,d.default)(i,2),o=r[0],a=r[1],s=o.split("."),u=(0,d.default)(s,2),l=u[0],c=u[1];return t.makeCall(e,{componentName:l,methodName:c,args:a})}var f=void 0;if(n.componentName[0].toLowerCase()===n.componentName[0])f=e.componentByName[n.componentName];else{var p=x.getComponentByName(n.componentName);f=e.find(p)}var y=f[n.methodName],v=n.args;return v instanceof Array||void 0===v||(v=[v]),function(){var t=[];void 0!==v&&t.push.apply(t,(0,h.default)(v)),t.push.apply(t,arguments),y.call.apply(y,[f].concat(t))}}}]),t}();e.EventUtil=E;var GameEvents=function(t){function GameEvents(t){(0,y.default)(this,GameEvents);var e=(0,s.default)(this,(GameEvents.__proto__||Object.getPrototypeOf(GameEvents)).call(this));return e.eventListeners=t,e}return(0,l.default)(GameEvents,t),(0,m.default)(GameEvents,[{key:"addedToScene",value:function(){var t=this.scene.events,e=!0,n=!1,i=void 0;try{for(var r,o=Object.entries(this.eventListeners)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=(0,d.default)(r.value,2),s=a[0],u=a[1],l=void 0;switch(s){case"onSingleHeartCollected":l=t.onSingleHeartCollected;break;case"onHeartsCollected":l=t.onHeartsCollected;break;case"onTreasureCollected":l=t.onTreasureCollected;break;default:throw Error("unrecognized event "+s)}var c=!0,h=!1,f=void 0;try{for(var p,y=u[Symbol.iterator]();!(c=(p=y.next()).done);c=!0){var v=p.value;l.push(E.makeCall(this.entity,v))}}catch(t){h=!0,f=t}finally{try{!c&&y.return&&y.return()}finally{if(h)throw f}}}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}}]),GameEvents}(w.Component);GameEvents=b([w.Component.register,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,_.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:paramtypes",[Object])],GameEvents),e.GameEvents=GameEvents;var GameEventsEmitter=O=function(t){function GameEventsEmitter(){(0,y.default)(this,GameEventsEmitter);var t=(0,s.default)(this,(GameEventsEmitter.__proto__||Object.getPrototypeOf(GameEventsEmitter)).apply(this,arguments));return t.onSingleHeartCollected=[],t.onHeartsCollected=[],t.onTreasureCollected=[],t}return(0,l.default)(GameEventsEmitter,t),(0,m.default)(GameEventsEmitter,[{key:"triggerSingleHeartCollected",value:function(){O.callAll(this.onSingleHeartCollected)}},{key:"addedToScene",value:function(){this.didEmitHeartsCollected=!1,this.didEmitTreasureCollected=!1}},{key:"update",value:function(){(0,o.default)(GameEventsEmitter.prototype.__proto__||Object.getPrototypeOf(GameEventsEmitter.prototype),"update",this).call(this),this.didEmitHeartsCollected||0!==this.scene.allCollidersInTag("heart").length||(this.didEmitHeartsCollected=!0,O.callAll(this.onHeartsCollected)),this.didEmitTreasureCollected||0!==this.scene.allCollidersInTag("treasure").length||(this.didEmitTreasureCollected=!0,O.callAll(this.onTreasureCollected))}}],[{key:"callAll",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)(0,r.value)()}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}}]),GameEventsEmitter}(w.Component);GameEventsEmitter=O=b([w.Component.register],GameEventsEmitter),e.GameEventsEmitter=GameEventsEmitter;var O},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(42),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=n(15),h=new c.Vector,f=function(){function t(e,n,i,r){(0,s.default)(this,t),this.x=e||0,this.y=n||0,this.width=i||1,this.height=r||1}return(0,l.default)(t,[{key:"getCenter",value:function(t){return t.set(this.centerX,this.centerY),t}},{key:"encompassPoint",value:function(t){t.x<this.left?this.left=t.x:t.x>this.right&&(this.right=t.x),t.y<this.top?this.top=t.y:t.y>this.bottom&&(this.bottom=t.y)}},{key:"encompassRect",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,o=t.corners()[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;this.encompassPoint(a)}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}},{key:"corners",value:o.default.mark(function t(){return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new c.Vector(this.x,this.y);case 2:return t.next=4,new c.Vector(this.x+this.width,this.y);case 4:return t.next=6,new c.Vector(this.x,this.y+this.height);case 6:return t.next=8,new c.Vector(this.x+this.width,this.y+this.height);case 8:case"end":return t.stop()}},t,this)})},{key:"toString",value:function(){return"<Rectangle "+this.x+", "+this.y+", "+this.width+", "+this.height+">"}},{key:"set",value:function(t,e,n,i){return this.x=t,this.y=e,this.width=n,this.height=i,this}},{key:"containsPoint",value:function(t){return this.x<=t.x&&this.right>t.x&&this.y<=t.y&&this.bottom>t.y}},{key:"overlapsVertically",value:function(t){return t.top>this.top&&t.top<this.bottom||t.bottom>this.top&&t.bottom<this.bottom}},{key:"overlapsHorizontally",value:function(t){return t.left>this.left&&t.left<this.right||t.right>this.left&&t.right<this.right}},{key:"expand",value:function(t,e){this.x-=t/2,this.width+=2*t,this.y-=e/2,this.height+=2*e}},{key:"intersectsRect",value:function(t){var e=h;return this.containsPoint(e.set(t.x,t.y))||this.containsPoint(e.set(t.x+t.width,t.y))||this.containsPoint(e.set(t.x,t.y+t.height))||this.containsPoint(e.set(t.x+t.width,t.y+t.height))}},{key:"cropRect",value:function(t){return t.x<this.x&&(t.width+=t.x-this.x,t.x=this.x),t.y<this.x&&(t.height+=t.y-this.y,t.y=this.y),t.x>this.right&&(t.x=this.right,t.width=0),t.y>this.bottom&&(t.y=this.bottom,t.height=0),t.right>this.right&&(t.width=this.right-t.x),t.bottom>this.bottom&&(t.height=this.bottom-t.y),t}},{key:"crop",value:function(e,n,i,r,o){return void 0===o&&(o=new t),o.set(e,n,i,r),this.cropRect(o),o}},{key:"clone",value:function(){return(new t).copy(this)}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}},{key:"left",get:function(){return this.x},set:function(t){var e=this.x+this.width;this.x=t,this.width=e-this.x}},{key:"right",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"top",get:function(){return this.y},set:function(t){var e=this.y+this.height;this.y=t,this.height=e-this.y}},{key:"bottom",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"centerX",get:function(){return this.x+this.width/2}},{key:"centerY",get:function(){return this.y+this.height/2}}]),t}();f.temp0=new f,f.temp1=new f,f.temp2=new f,e.Rectangle=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function o(t){if(!t)throw Error("must pass a non-empty non-null name to getComponentByName");var e=b.Component.registeredComponents[t];if(e)return e}var a=n(0),s=i(a),u=n(1),l=i(u),c=n(2),h=i(c),f=n(5),d=i(f),p=n(3),y=i(p),v=n(4),m=i(v),g=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,m.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},_=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,m.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0}),r(n(118)),r(n(205)),r(n(82)),r(n(121)),r(n(84)),r(n(207)),r(n(208)),r(n(209)),r(n(210)),r(n(211)),r(n(122)),r(n(212)),r(n(83)),r(n(213)),r(n(214)),r(n(21)),r(n(215)),r(n(57)),r(n(216)),r(n(217)),r(n(85)),r(n(218)),r(n(219)),r(n(220)),r(n(124)),r(n(34)),r(n(221)),r(n(123)),r(n(222)),r(n(223)),r(n(224)),r(n(225)),r(n(86)),r(n(58)),r(n(226)),r(n(227)),r(n(228)),r(n(234)),r(n(127)),n(13);var b=n(6),w=n(14),x=n(12),k=n(46),E=n(9),O=n(124),S=n(58),T=n(127),RenderDepth=function(t){function RenderDepth(t){var e=t.depth;(0,s.default)(this,RenderDepth);var n=(0,h.default)(this,(RenderDepth.__proto__||Object.getPrototypeOf(RenderDepth)).call(this));return n.depth=e,n}return(0,y.default)(RenderDepth,t),(0,l.default)(RenderDepth,[{key:"addedToScene",value:function(){(0,d.default)(RenderDepth.prototype.__proto__||Object.getPrototypeOf(RenderDepth.prototype),"addedToScene",this).call(this),void 0===this.depth||isNaN(this.depth)||(this.entity.depth=this.depth)}}]),RenderDepth}(b.Component);RenderDepth=g([b.Component.register,_("design:paramtypes",[Object])],RenderDepth),e.RenderDepth=RenderDepth;var Blockize=function(t){function Blockize(){return(0,s.default)(this,Blockize),(0,h.default)(this,(Blockize.__proto__||Object.getPrototypeOf(Blockize)).apply(this,arguments))}return(0,y.default)(Blockize,t),(0,l.default)(Blockize,[{key:"update",value:function(){this.physics.check("player")&&(this.sprite.play("blockize"),this.physics.stop(),this.wonder.active=!1)}}]),Blockize}(b.Component);g([b.Component.require,_("design:type",w.Physics)],Blockize.prototype,"physics",void 0),g([b.Component.require,_("design:type",E.Sprite)],Blockize.prototype,"sprite",void 0),g([b.Component.require,_("design:type",T.Wonder)],Blockize.prototype,"wonder",void 0),Blockize=g([b.Component.register],Blockize);var HeartPickup=function(t){function HeartPickup(t){(0,s.default)(this,HeartPickup);var e=(0,h.default)(this,(HeartPickup.__proto__||Object.getPrototypeOf(HeartPickup)).call(this,t));return e.type=t.type,e}return(0,y.default)(HeartPickup,t),(0,l.default)(HeartPickup,[{key:"didPickup",value:function(t){(0,d.default)(HeartPickup.prototype.__proto__||Object.getPrototypeOf(HeartPickup.prototype),"didPickup",this).call(this,t);var e=t.find(S.FreezingShot);e&&e.didPickupHeart(this),this.level&&this.level.events.triggerSingleHeartCollected(),n(17).Game.SOUNDS.pickupHeart.play()}}]),HeartPickup}(O.Pickup);HeartPickup=g([b.Component.register,_("design:paramtypes",[Object])],HeartPickup),e.HeartPickup=HeartPickup;var MapLocation=function(t){function MapLocation(t){var e=t.name;(0,s.default)(this,MapLocation);var n=(0,h.default)(this,(MapLocation.__proto__||Object.getPrototypeOf(MapLocation)).call(this));return n.name=e,n}return(0,y.default)(MapLocation,t),MapLocation}(b.Component);MapLocation=g([b.Component.register,_("design:paramtypes",[Object])],MapLocation),e.MapLocation=MapLocation;var Rotater=function(t){function Rotater(){(0,s.default)(this,Rotater);var t=(0,h.default)(this,(Rotater.__proto__||Object.getPrototypeOf(Rotater)).apply(this,arguments));return t.degrees=0,t.speed=2,t}return(0,y.default)(Rotater,t),(0,l.default)(Rotater,[{key:"update",value:function(){(0,d.default)(Rotater.prototype.__proto__||Object.getPrototypeOf(Rotater.prototype),"update",this).call(this),this.degrees+=b.Engine.delta*this.speed,this.graphic.rotation=this.degrees}}]),Rotater}(b.Component);g([b.Component.require,_("design:type",E.Graphic)],Rotater.prototype,"graphic",void 0),Rotater=g([b.Component.register],Rotater);for(var C=[x.Hitbox,w.Physics,E.Sprite,k.ParticleSystem],P=0;P<C.length;P++){var A=C[P];b.Component.register(A)}e.getComponentByName=o},function(t,e,n){var i=n(134),r=n(62);t.exports=function(t){return i(r(t))}},function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e,n){var i=n(31),r=n(89),o=n(65),a=Object.defineProperty;e.f=n(32)?Object.defineProperty:function(t,e,n){if(i(t),e=o(e,!0),i(n),r)try{return a(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(t instanceof d.Vector)t.copy(e);else{if(!(t instanceof f.Color))return!1;t.copy(e)}return!0}var o=n(11),a=i(o),s=n(4),u=(i(s),n(0)),l=i(u),c=n(1),h=i(c);Object.defineProperty(e,"__esModule",{value:!0}),n(13);var f=n(20),d=n(15),p=function(){function t(e){(0,l.default)(this,t),this._entity=null,this.scene=null,this.active=!0,this.visible=!0,this.position=new d.Vector(0,0),e&&void 0!==e.active&&(this.active=e.active)}return(0,h.default)(t,[{key:"toString",value:function(){return"<"+this.constructor.name+" of "+this.entity+">"}},{key:"setPrefabValues",value:function(t){if(this.prefabLink){var e=this.prefabLink,n=!0,i=!1,o=void 0;try{for(var s,u=Object.entries(t)[Symbol.iterator]();!(n=(s=u.next()).done);n=!0){var l=(0,a.default)(s.value,2),c=l[0],h=l[1];c in e&&(r(e[c],h)||(e[c]=h))}}catch(t){i=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}}var f=!0,d=!1,p=void 0;try{for(var y,v=Object.entries(t)[Symbol.iterator]();!(f=(y=v.next()).done);f=!0){var m=(0,a.default)(y.value,2),c=m[0],h=m[1];r(this[c],h)||(this[c]=h)}}catch(t){d=!0,p=t}finally{try{!f&&v.return&&v.return()}finally{if(d)throw p}}}},{key:"setActive",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.active=t}},{key:"setVisible",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.visible=t}},{key:"getScenePosition",value:function(t){return t.set(this.sceneX,this.sceneY)}},{key:"addedToEntity",value:function(){}},{key:"addedToScene",value:function(){if(void 0!==this.siblings){var t=!0,e=!1,n=void 0;try{for(var i,r=Object.entries(this.siblings)[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=(0,a.default)(i.value,2),s=o[0],u=o[1],l=this.entity.find(u);if(!l)throw Error("@Component.require needs "+u.name+" but it is missing");this[s]=l}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}}},{key:"removedFromEntity",value:function(){}},{key:"removedFromScene",value:function(){}},{key:"update",value:function(){}},{key:"lateUpdate",value:function(){}},{key:"render",value:function(t){}},{key:"debugRender",value:function(t){}},{key:"entity",get:function(){return this._entity},set:function(t){if(null!=this._entity&&null!=t)throw Error("This Component is already attached to an Entity");this._entity=t}},{key:"sceneVisible",get:function(){return this.entity&&this.entity.visible&&this.visible}},{key:"x",get:function(){return this.position.x},set:function(t){this.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.position.y=t}},{key:"scenePosition",get:function(){return this.getScenePosition(new d.Vector)},set:function(t){this.position.set(t.x-(this._entity?this._entity.x:0),t.y-(this._entity?this._entity.y:0))}},{key:"sceneX",get:function(){return(this._entity?this._entity.x:0)+this.position.x}},{key:"sceneY",get:function(){return(this._entity?this._entity.y:0)+this.position.y}}],[{key:"register",value:function(e){if(e.name in t.registeredComponents)throw Error("already a Component named "+e.name);t.registeredComponents[e.name]=e}},{key:"require",value:function(t,e){var n=Reflect.getMetadata("design:type",t,e);if(!n){var i="no design:type metadata found for key "+e;throw i+=" - is experimentalDecorators and emitDecoratorMetadata on in tsconfig.json?"}(t.siblings||(t.siblings={}))[e]=n}}]),t}();p.registeredComponents={},e.Component=p},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(183)),i(n(184)),i(n(80))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f);Object.defineProperty(e,"__esModule",{value:!0});var p=n(6),y=n(12),v=n(44),m=n(123),g=n(7),_=n(23),b=n(17),w=n(56),x=n(14),k=n(16),E=function(t){function e(){(0,o.default)(this,e);var t=(0,l.default)(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.killed=!1,k.instantiatePrefab("player",t),t.group("player"),t.physics=t.find(x.Physics),t.find(_.Health).onDie.push(function(){t.find(_.TopDownControls).movingEnabled=!1,t.find(_.FreezingShot).active=!1,t._untagHack()}),t.shadow=t.find(m.Shadow),t}return(0,d.default)(e,t),(0,s.default)(e,[{key:"update",value:function(){(0,h.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),v.Input.pressed(b.Game.KEYS.RESTART)&&(this.killed?this.level&&this.level.reloadLevel(!1):this.kill()),this.physics&&this.shadow&&this.shadow.graphic&&(this.shadow.graphic.visible=!this.physics.check("solid",0,3))}},{key:"lateUpdate",value:function(){this.lastFramePosition?e.movementLastFrame=g.Vector.temp0.copy(this.position).sub(this.lastFramePosition).length:this.lastFramePosition=(new g.Vector).copy(this.position),this.lastFramePosition.copy(this.position)}},{key:"kill",value:function(){this.killed||(this.killed=!0,this.find(_.Health).kill())}},{key:"_untagHack",value:function(){this.ungroup("player"),this.findAll(y.Collider).forEach(function(t){return t.untag("player")})}},{key:"level",get:function(){return this.scene instanceof w.Level?this.scene:null}}],[{key:"isPlayerOrb",value:function(t){return-1!==t.tags.indexOf("player")&&!(t.entity&&t.entity instanceof e)}},{key:"isPlayer",value:function(t){return-1!==t.tags.indexOf("player")&&t.entity&&t.entity instanceof e}}]),e}(p.Entity);E.movementLastFrame=0,e.Player=E},function(t,e,n){var i=n(25),r=n(18),o=n(64),a=n(36),s=function(t,e,n){var u,l,c,h=t&s.F,f=t&s.G,d=t&s.S,p=t&s.P,y=t&s.B,v=t&s.W,m=f?r:r[e]||(r[e]={}),g=m.prototype,_=f?i:d?i[e]:(i[e]||{}).prototype;f&&(n=e);for(u in n)(l=!h&&_&&void 0!==_[u])&&u in m||(c=l?_[u]:n[u],m[u]=f&&"function"!=typeof _[u]?n[u]:y&&l?o(c,i):v&&_[u]==c?function(t){var e=function(e,n,i){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,i)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(c):p&&"function"==typeof c?o(Function.call,c):c,p&&((m.virtual||(m.virtual={}))[u]=c,t&s.R&&g&&!g[u]&&a(g,u,c)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,t.exports=s},function(t,e,n){var i=n(38);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e,n){t.exports=!n(39)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c),f=n(4),d=i(f),p=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},y=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var v,m=n(8),g=n(9),_=n(7);!function(t){t[t.WalkBackwards=0]="WalkBackwards"}(v=e.EffectType||(e.EffectType={}));var PlayerEffects=function(t){function PlayerEffects(t){(0,o.default)(this,PlayerEffects);var e=(0,l.default)(this,(PlayerEffects.__proto__||Object.getPrototypeOf(PlayerEffects)).call(this,t));return e.exiting=!1,e.effects=t.effects?t.effects.slice():[],e}return(0,h.default)(PlayerEffects,t),(0,s.default)(PlayerEffects,[{key:"asJSON",value:function(){return this.effects.slice()}},{key:"toString",value:function(){return"<PlayerEffects (eid="+this.entity.id+") ["+this.effects.join(", ")+"]>"}},{key:"addEffect",value:function(t){this.hasEffect(t)||this.effects.push(t)}},{key:"removeEffect",value:function(t){this.hasEffect(t)&&this.effects.splice(this.effects.indexOf(t),1)}},{key:"hasEffect",value:function(t){return-1!==this.effects.indexOf(t)}},{key:"toggleEffect",value:function(t){return this.hasEffect(t)?(this.removeEffect(t),!1):(this.addEffect(t),!0)}},{key:"copyFrom",value:function(t){this.effects=t.slice()}}]),PlayerEffects}(m.AutoComponent);PlayerEffects=p([m.AutoComponent.register,y("design:paramtypes",[Object])],PlayerEffects),e.PlayerEffects=PlayerEffects;var PlayerEffectsGraphic=function(t){function PlayerEffectsGraphic(){return(0,o.default)(this,PlayerEffectsGraphic),(0,l.default)(this,(PlayerEffectsGraphic.__proto__||Object.getPrototypeOf(PlayerEffectsGraphic)).apply(this,arguments))}return(0,h.default)(PlayerEffectsGraphic,t),(0,s.default)(PlayerEffectsGraphic,[{key:"update",value:function(){this.sprite.color=this.playerEffects.hasEffect(v.WalkBackwards)?_.Color.red:_.Color.white}}]),PlayerEffectsGraphic}(m.AutoComponent);p([m.AutoComponent.require,y("design:type",PlayerEffects)],PlayerEffectsGraphic.prototype,"playerEffects",void 0),p([m.AutoComponent.require,y("design:type",g.Sprite)],PlayerEffectsGraphic.prototype,"sprite",void 0),PlayerEffectsGraphic=p([m.AutoComponent.register],PlayerEffectsGraphic),e.PlayerEffectsGraphic=PlayerEffectsGraphic},function(t,e){t.exports={}},function(t,e,n){var i=n(26),r=n(40);t.exports=n(32)?function(t,e,n){return i.f(t,e,r(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){"use strict";e.__esModule=!0;var i=n(163),r=function(t){return t&&t.__esModule?t:{default:t}}(i);e.default=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return(0,r.default)(t)}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"sign",value:function(t){return t<0?-1:t>0?1:0}},{key:"cmp",value:function(t,e){return t<e?-1:t>e?1:0}},{key:"clamp",value:function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=1),Math.max(e,Math.min(n,t))}},{key:"almostEqual",value:function(e,n){return e-n<t.EPSILON}},{key:"approach",value:function(t,e,n){return t>e?Math.max(t-n,e):Math.min(t+n,e)}},{key:"range",value:function(t,e){return void 0===e?-t+Math.random()*t*2:t+Math.random()*(e-t)}},{key:"choose",value:function(t){return t[Math.floor(Math.random()*t.length)]}}]),t}();u.EPSILON=1e-6,e.Calc=u},function(t,e,n){t.exports=n(170)},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(37),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u),c=n(2),h=i(c),f=n(3),d=i(f);Object.defineProperty(e,"__esModule",{value:!0});var p=n(27),Collider=function(t){function Collider(){(0,s.default)(this,Collider);var t=(0,h.default)(this,(Collider.__proto__||Object.getPrototypeOf(Collider)).apply(this,arguments));return t.tags=[],t.blacklistedEntities=[],t}return(0,d.default)(Collider,t),(0,l.default)(Collider,[{key:"tag",value:function(t){this.tags.push(t),null!=this.entity&&null!=this.entity.scene&&this.entity.scene._trackCollider(this,t)}},{key:"untagAll",value:function(){for(;this.tags.length;)this.untag(this.tags[0])}},{key:"untag",value:function(t){var e=this.tags.indexOf(t);e>=0&&(this.tags.splice(e,1),null!=this.entity&&null!=this.entity.scene&&this.entity.scene._untrackCollider(this,t))}},{key:"check",value:function(t,e,n){return null!=this.collide(t,e,n)}},{key:"checks",value:function(t,e,n){var i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value;if(null!=this.collide(u,e,n))return!0}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return!1}},{key:"collide",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=null,r=this.entity.scene.allCollidersInTag(t);this.x+=e||0,this.y+=n||0;var o=!0,a=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;if(c.active&&c.entity!==this.entity&&-1===this.blacklistedEntities.indexOf(c.entity)&&Collider.overlap(this,c)){i=c;break}}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return this.x-=e||0,this.y-=n||0,i}},{key:"collides",value:function(t,e,n){var i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value,l=this.collide(u,e,n);if(null!=l)return l}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return null}},{key:"collideAll",value:function(t,e,n){return this.collideAllMulti([t],e,n)}},{key:"collideAllMulti",value:function(t,e,n){var i=[],r=!0,a=!1,s=void 0;try{for(var u,l=t[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=u.value;i.push.apply(i,(0,o.default)(this.entity.scene.allCollidersInTag(c)))}}catch(t){a=!0,s=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw s}}var h=[];this.x+=e||0,this.y+=n||0;var f=!0,d=!1,p=void 0;try{for(var y,v=i[Symbol.iterator]();!(f=(y=v.next()).done);f=!0){var m=y.value;m.active&&m.entity!==this.entity&&-1===this.blacklistedEntities.indexOf(m.entity)&&Collider.overlap(this,m)&&h.push(m)}}catch(t){d=!0,p=t}finally{try{!f&&v.return&&v.return()}finally{if(d)throw p}}return this.x-=e||0,this.y-=n||0,h}}],[{key:"registerOverlapTest",value:function(t,e,n){void 0===Collider.overlaptest[t.name]&&(Collider.overlaptest[t.name]={}),void 0===Collider.overlaptest[e.name]&&(Collider.overlaptest[e.name]={}),Collider.overlaptest[t.name][e.name]=function(t,e){return n(t,e)},Collider.overlaptest[e.name][t.name]=function(t,e){return n(e,t)}}},{key:"overlap",value:function(t,e){return Collider.overlaptest[t.type][e.type](t,e)}}]),Collider}(p.Component);Collider.overlaptest={},e.Collider=Collider},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=n(28),h=function(){function t(){(0,s.default)(this,t)}return(0,l.default)(t,null,[{key:"update",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.digitalInputs.values()[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)i.value.update(!1)}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}for(var a=0;a<c.GamepadManager.numControllers();++a){var s=c.GamepadManager.getController(a);if(s){var u=!0,l=!1,h=void 0;try{for(var f,d=this.anyControllerButtons[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var p=(0,o.default)(f.value,2),y=p[0],v=p[1];s.getButton(y).down()&&(this.digitalInputs.get(v)._next=!0)}}catch(t){l=!0,h=t}finally{try{!u&&d.return&&d.return()}finally{if(l)throw h}}}}var m=!0,g=!1,_=void 0;try{for(var b,w=this.keys[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var x=(0,o.default)(b.value,2),k=x[0],v=x[1];c.Keyboard.check(k)&&(this.digitalInputs.get(v)._next=!0)}}catch(t){g=!0,_=t}finally{try{!m&&w.return&&w.return()}finally{if(g)throw _}}}},{key:"mapAnyControllerButton",value:function(t,e){this.anyControllerButtons.push([t,e]),this.ensureButtonState(e)}},{key:"mapKey",value:function(t,e){this.mapKeys([t],e)}},{key:"mapKeys",value:function(t,e){var n=!0,i=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;this.keys.push([s,e])}}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}this.ensureButtonState(e)}},{key:"ensureButtonState",value:function(t){this.digitalInputs.has(t)||this.digitalInputs.set(t,new c.ButtonState)}},{key:"pressed",value:function(t){return this.digitalInputs.get(t).pressed()}},{key:"down",value:function(t){return this.digitalInputs.get(t).down()}}]),t}();h.anyControllerButtons=[],h.keys=[],h.digitalInputs=new Map,e.Input=h},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(112)),i(n(114)),i(n(113))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(119)),i(n(206)),i(n(120))},function(t,e,n){var i=n(92),r=n(70);t.exports=Object.keys||function(t){return i(t,r)}},function(t,e){var n=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+i).toString(36))}},function(t,e,n){"use strict";var i=n(141)(!0);n(88)(String,"String",function(t){this._t=t+"",this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=i(e,n),this._i+=t.length,{value:t,done:!1})})},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"unload",value:function(){t.json={},t.xml={},t.text={},t.atlases={};for(var e in t.textures)t.textures[e].dispose();t.textures={};for(var n in t.sounds)t.sounds[n].dispose();t.sounds={}}}]),t}();u.textures={},u.json={},u.xml={},u.text={},u.sounds={},u.atlases={},e.Assets=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){(0,o.default)(this,t),this.mat=new Float32Array(9),this.identity()}return(0,s.default)(t,[{key:"identity",value:function(){return this.mat[0]=1,this.mat[1]=0,this.mat[2]=0,this.mat[3]=0,this.mat[4]=1,this.mat[5]=0,this.mat[6]=0,this.mat[7]=0,this.mat[8]=1,this}},{key:"copy",value:function(t){return this.mat[0]=t.mat[0],this.mat[1]=t.mat[1],this.mat[2]=t.mat[2],this.mat[3]=t.mat[3],this.mat[4]=t.mat[4],this.mat[5]=t.mat[5],this.mat[6]=t.mat[6],this.mat[7]=t.mat[7],this.mat[8]=t.mat[8],this}},{key:"set",value:function(t,e,n,i,r,o){return this.mat[0]=t,this.mat[1]=i,this.mat[2]=0,this.mat[3]=n,this.mat[4]=e,this.mat[5]=0,this.mat[6]=r,this.mat[7]=o,this.mat[8]=1,this}},{key:"add",value:function(t){return this.mat[0]+=t.mat[0],this.mat[1]+=t.mat[1],this.mat[2]+=t.mat[2],this.mat[3]+=t.mat[3],this.mat[4]+=t.mat[4],this.mat[5]+=t.mat[5],this.mat[6]+=t.mat[6],this.mat[7]+=t.mat[7],this.mat[8]+=t.mat[8],this}},{key:"sub",value:function(t){return this.mat[0]-=t.mat[0],this.mat[1]-=t.mat[1],this.mat[2]-=t.mat[2],this.mat[3]-=t.mat[3],this.mat[4]-=t.mat[4],this.mat[5]-=t.mat[5],this.mat[6]-=t.mat[6],this.mat[7]-=t.mat[7],this.mat[8]-=t.mat[8],this}},{key:"scaler",value:function(t){return this.mat[0]*=t,this.mat[1]*=t,this.mat[2]*=t,this.mat[3]*=t,this.mat[4]*=t,this.mat[5]*=t,this.mat[6]*=t,this.mat[7]*=t,this.mat[8]*=t,this}},{key:"invert",value:function(){var t=this.mat[0],e=this.mat[1],n=this.mat[2],i=this.mat[3],r=this.mat[4],o=this.mat[5],a=this.mat[6],s=this.mat[7],u=this.mat[8],l=u*r-o*s,c=-u*i+o*a,h=s*i-r*a,f=t*l+e*c+n*h;return f?(f=1/f,this.mat[0]=l*f,this.mat[1]=(-u*e+n*s)*f,this.mat[2]=(o*e-n*r)*f,this.mat[3]=c*f,this.mat[4]=(u*t-n*a)*f,this.mat[5]=(-o*t+n*i)*f,this.mat[6]=h*f,this.mat[7]=(-s*t+e*a)*f,this.mat[8]=(r*t-e*i)*f,this):this}},{key:"multiply",value:function(t){var e=this.mat[0],n=this.mat[1],i=this.mat[2],r=this.mat[3],o=this.mat[4],a=this.mat[5],s=this.mat[6],u=this.mat[7],l=this.mat[8],c=t.mat[0],h=t.mat[1],f=t.mat[2],d=t.mat[3],p=t.mat[4],y=t.mat[5],v=t.mat[6],m=t.mat[7],g=t.mat[8];return this.mat[0]=c*e+h*r+f*s,this.mat[1]=c*n+h*o+f*u,this.mat[2]=c*i+h*a+f*l,this.mat[3]=d*e+p*r+y*s,this.mat[4]=d*n+p*o+y*u,this.mat[5]=d*i+p*a+y*l,this.mat[6]=v*e+m*r+g*s,this.mat[7]=v*n+m*o+g*u,this.mat[8]=v*i+m*a+g*l,this}},{key:"rotate",value:function(t){var e=this.mat[0],n=this.mat[1],i=this.mat[2],r=this.mat[3],o=this.mat[4],a=this.mat[5],s=Math.sin(t),u=Math.cos(t);return this.mat[0]=u*e+s*r,this.mat[1]=u*n+s*o,this.mat[2]=u*i+s*a,this.mat[3]=u*r-s*e,this.mat[4]=u*o-s*n,this.mat[5]=u*a-s*i,this}},{key:"scale",value:function(t,e){return this.mat[0]=t*this.mat[0],this.mat[1]=t*this.mat[1],this.mat[2]=t*this.mat[2],this.mat[3]=e*this.mat[3],this.mat[4]=e*this.mat[4],this.mat[5]=e*this.mat[5],this}},{key:"translate",value:function(t,e){var n=this.mat[0],i=this.mat[1],r=this.mat[2],o=this.mat[3],a=this.mat[4],s=this.mat[5],u=this.mat[6],l=this.mat[7],c=this.mat[8];return this.mat[6]=t*n+e*o+u,this.mat[7]=t*i+e*a+l,this.mat[8]=t*r+e*s+c,this}},{key:"fromRotation",value:function(t){var e=Math.sin(t),n=Math.cos(t);return this.identity(),this.mat[0]=n,this.mat[1]=-e,this.mat[3]=e,this.mat[4]=n,this}},{key:"fromScale",value:function(t,e){return this.identity(),this.mat[0]=t,this.mat[4]=e,this}},{key:"fromTranslation",value:function(t,e){return this.identity(),this.mat[6]=t,this.mat[7]=e,this}}]),t}();e.Matrix=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(81),l="\tgl_Position = vec4((matrix * vec3(a_position.xy, 1.0)).xy, a_position.z, 1.0);",c=function(){function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"init",value:function(){t.texture=new u.Shader("attribute vec3 a_position;attribute vec2 a_texcoord;attribute vec4 a_color;uniform mat3 matrix;varying vec2 v_texcoord;varying vec4 v_color;void main(){"+l+"\tv_texcoord = a_texcoord;\tv_color = vec4(a_color.rgb * a_color.a, a_color.a);   v_color.rgb += a_position.z;}","precision mediump float;varying vec2 v_texcoord;varying vec4 v_color;uniform sampler2D texture;void main() {\tgl_FragColor = texture2D(texture, v_texcoord) * v_color;}",[new u.ShaderUniform("matrix",u.ShaderUniformType.matrix3d),new u.ShaderUniform("texture",u.ShaderUniformType.sampler2D)],[new u.ShaderAttribute("a_position",u.ShaderAttributeType.Position),new u.ShaderAttribute("a_texcoord",u.ShaderAttributeType.Texcoord),new u.ShaderAttribute("a_color",u.ShaderAttributeType.Color)]),t.solid=new u.Shader("attribute vec3 a_position;attribute vec2 a_texcoord;attribute vec4 a_color;uniform mat3 matrix;varying vec2 v_texcoord;varying vec4 v_color;void main(){"+l+"\tv_texcoord = a_texcoord;\tv_color = a_color;}","precision mediump float;varying vec2 v_texcoord;varying vec4 v_color;uniform sampler2D texture;void main() {\tgl_FragColor = v_color * texture2D(texture, v_texcoord).a;}",[new u.ShaderUniform("matrix",u.ShaderUniformType.matrix3d),new u.ShaderUniform("texture",u.ShaderUniformType.sampler2D)],[new u.ShaderAttribute("a_position",u.ShaderAttributeType.Position),new u.ShaderAttribute("a_texcoord",u.ShaderAttributeType.Texcoord),new u.ShaderAttribute("a_color",u.ShaderAttributeType.Color)]),t.primitive=new u.Shader("attribute vec3 a_position;attribute vec4 a_color;uniform mat3 matrix;varying vec4 v_color;void main(){"+l+"\tv_color = a_color;}","precision mediump float;varying vec4 v_color;void main() {\tgl_FragColor = v_color;}",[new u.ShaderUniform("matrix",u.ShaderUniformType.matrix3d)],[new u.ShaderAttribute("a_position",u.ShaderAttributeType.Position),new u.ShaderAttribute("a_color",u.ShaderAttributeType.Color)])}}]),t}();e.Shaders=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(10),l=n(22),c=n(15),h=n(107),f=function(){function t(e,n,i){(0,o.default)(this,t),this.bounds=null,this.frame=null,this.texture=null,this.metadata={},this.texture=e,this.bounds=n||new l.Rectangle(0,0,e.width,e.height),this.frame=i||new l.Rectangle(0,0,this.bounds.width,this.bounds.height),this.center=new c.Vector(this.frame.width/2,this.frame.height/2)}return(0,s.default)(t,[{key:"getSubtexture",value:function(e,n){return void 0===n?n=new t(this.texture):n.texture=this.texture,n.bounds.x=this.bounds.x+Math.max(0,Math.min(this.bounds.width,e.x+this.frame.x)),n.bounds.y=this.bounds.y+Math.max(0,Math.min(this.bounds.height,e.y+this.frame.y)),n.bounds.width=Math.max(0,this.bounds.x+Math.min(this.bounds.width,e.x+this.frame.x+e.width)-n.bounds.x),n.bounds.height=Math.max(0,this.bounds.y+Math.min(this.bounds.height,e.y+this.frame.y+e.height)-n.bounds.y),n.frame.x=Math.min(0,this.frame.x+e.x),n.frame.y=Math.min(0,this.frame.y+e.y),n.frame.width=e.width,n.frame.height=e.height,n.center=new c.Vector(n.frame.width/2,n.frame.height/2),n}},{key:"clone",value:function(){return new t(this.texture,this.bounds.clone(),this.frame.clone())}},{key:"toString",value:function(){return this.texture.path+": ["+this.bounds.x+", "+this.bounds.y+", "+this.bounds.width+", "+this.bounds.height+"]frame["+this.frame.x+", "+this.frame.y+", "+this.frame.width+", "+this.frame.height+"]"}},{key:"draw",value:function(t,e,n,i,r,o,a){u.Engine.graphics.texture(this,t.x,t.y,null,r,e,n,i,o,a)}},{key:"drawCropped",value:function(t,e,n,i,r,o,a,s){u.Engine.graphics.texture(this,t.x,t.y,e,o,n,i,r,a,s)}},{key:"drawCenter",value:function(t,e,n,i,r,o){u.Engine.graphics.texture(this,t.x,t.y,null,i,this.center,e,n,r,o)}},{key:"drawCenterCropped",value:function(t,e,n,i,r,o,a){u.Engine.graphics.texture(this,t.x,t.y,e,r,new c.Vector(e.width/2,e.height/2),n,i,o,a)}},{key:"drawJustify",value:function(t,e,n,i,r,o,a){u.Engine.graphics.texture(this,t.x,t.y,null,r,new c.Vector(this.width*e.x,this.height*e.y),n,i,o,a)}},{key:"drawJustifyCropped",value:function(t,e,n,i,r,o,a,s){u.Engine.graphics.texture(this,t.x,t.y,e,o,new c.Vector(e.width*n.x,e.height*n.y),i,r,a,s)}},{key:"dispose",value:function(){this.texture.dispose(),this.texture=null}},{key:"width",get:function(){return this.frame.width}},{key:"height",get:function(){return this.frame.height}},{key:"clippedWidth",get:function(){return this.bounds.width}},{key:"clippedHeight",get:function(){return this.bounds.height}}],[{key:"makeTransparent",value:function(t,e){var n=document.createElement("canvas");n.width=t.width,n.height=t.height;var i=n.getContext("2d");i.drawImage(t,0,0);for(var r=i.getImageData(0,0,n.width,n.height),o=r.data,a=0;a<o.length;a+=4)o[a+0]===e.r&&o[a+1]===e.g&&o[a+2]===e.b&&(o[a+3]=0);return i.putImageData(r,0,0),n}},{key:"create",value:function(e,n){var i=u.Engine.graphics.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),n?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.makeTransparent(e,n)):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindTexture(i.TEXTURE_2D,null),new t(new h.FosterWebGLTexture(r,e.width,e.height))}},{key:"createFromData",value:function(e,n,i){for(var r=u.Engine.graphics.gl,o=r.createTexture(),a=[],s=0;s<e.length;s++)a[s]=Math.floor(255*e[s]);return r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n,i,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array(e)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),new t(new h.FosterWebGLTexture(o,n,i))}}]),t}();e.Texture=f},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(188)),i(n(50))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=n(6),h=n(7),f=function(){function t(e){(0,s.default)(this,t),this.startPagePos=new h.Vector,this.currentPos=new h.Vector,this.touchId=-1,this.touchStartTime=-1e3,this.touchDidMove=!1,this.borderColor=new h.Color(.7,.7,.8),this.lastTouchEnd=-1e3,e.addEventListener("touchstart",this.touchStart.bind(this),!1),e.addEventListener("touchmove",this.touchMove.bind(this),!1),e.addEventListener("touchend",this.touchEnd.bind(this),!1)}return(0,l.default)(t,[{key:"draw",value:function(t){if(-1!==this.touchId){var e=c.Engine.graphics;e.setRenderTarget(c.Engine.graphics.buffer),e.shader=h.Shaders.primitive,e.shader.set("matrix",t.matrix);var n=c.Engine.graphics.pageToScreen(this.startPagePos.x,this.startPagePos.y),i=(0,o.default)(n,2),r=i[0],a=i[1],s=t.screenToWorld(r,a),u=(0,o.default)(s,2),l=u[0],f=u[1];e.hollowRect(l-4,f-4,8,8,2,this.borderColor)}}},{key:"touchStart",value:function(e){if(e.preventDefault(),!(t.touchTarget&&t.touchTarget.onTouchStart(e)||-1!==this.touchId))for(var n=0;n<e.changedTouches.length;++n){var i=e.changedTouches[n];this.touchId=i.identifier,this.touchStartTime=(new Date).getTime(),this.startPagePos.set(i.pageX,i.pageY);break}}},{key:"touchMove",value:function(e){if(e.preventDefault(),-1!==this.touchId)for(var n=0;n<e.changedTouches.length;++n){var i=e.changedTouches[n];if(i.identifier===this.touchId){this.currentPos.set(i.pageX,i.pageY);var r=Math.abs(this.currentPos.x-this.startPagePos.x),o=Math.abs(this.currentPos.y-this.startPagePos.y);!this.touchDidMove&&(r>75||o>75)&&(this.touchDidMove=!0);var a=h.Calc.sign(this.currentPos.x-this.startPagePos.x),s=h.Calc.sign(this.currentPos.y-this.startPagePos.y);r>100&&o>100?t.joystick.set(r>75?a:0,o>75?s:0):r>=o?t.joystick.set(r>75?a:0,0):o>=o&&t.joystick.set(0,o>75?s:0)}}}},{key:"touchEnd",value:function(e){if(e.preventDefault(),!(t.touchTarget&&t.touchTarget.onTouchEnd(e)||-1===this.touchId))for(var n=0;n<e.changedTouches.length;++n){var i=e.changedTouches[n];if(i.identifier===this.touchId){if(!this.touchDidMove&&(new Date).getTime()-this.touchStartTime<400){this.touchStartTime=-1e3,t.tapped=!0;var r=c.Engine.graphics.pageToScreen(i.pageX,i.pageY),a=(0,o.default)(r,2),s=a[0],u=a[1];t.tapPos.set(s,u),t.tappedFrame=-1}this.touchId=-1,this.touchDidMove=!1,t.joystick.set(0,0);break}}}}],[{key:"init",value:function(e){if(this.instance)throw Error("already init-ed");this.instance=new t(e)}},{key:"tappedThisFrame",value:function(){if(-1===this.tappedFrame){var t=this.tapped;return this.tapped=!1,this.tappedFrame=c.Engine.frameCount,t}return c.Engine.frameCount==this.tappedFrame}}]),t}();f.joystick=new h.Vector(0,0),f.tapped=!1,f.tapPos=new h.Vector,f.tappedFrame=-1,e.TouchInput=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var n=t.getAttribute(e);return parseInt(n,10)}function o(t,e){switch(e){case"int":return parseInt(t,10);case"float":return parseFloat(t);case"bool":return""+t=="true";case"string":default:return""+t}}function a(t){return parseInt(t,10)}function s(t,e){var n=!0,i=!1,r=void 0;try{for(var o,s=Object.entries(t.tileproperties)[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=(0,v.default)(o.value,2),l=u[0],c=u[1].shadow;void 0!==c&&(e[c]=t.tilemap.getTileSubtexture(a(l)))}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}}function u(t){var e={},n=!0,i=!1,r=void 0;try{for(var o,s=Object.entries(t.tileproperties)[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=(0,v.default)(o.value,2),l=u[0],c=u[1],h=c.anim_name,f=c.anim_frame,d=c.anim_speed,p=c.anim_track,y=c.anim_goto,m=c.anim_loops;if(h){var g=a(l),_=p||"main",b=e[h]||(e[h]={});void 0===b[_]&&(b[_]={frames:[],speed:2.2,gotoFrames:null,loops:void 0});var w=b[_].frames,x=t.tilemap.getTileSubtexture(g);void 0===f?w.push(x):w.splice(f,0,x),void 0!==d&&(b[_].speed=d),void 0!==y&&(b[_].gotoFrames=[""+y]),void 0!==m&&(b[_].loops=m)}}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}var k=!0,E=!1,O=void 0;try{for(var S,T=Object.entries(e)[Symbol.iterator]();!(k=(S=T.next()).done);k=!0){var C=(0,v.default)(S.value,2),P=C[0],A=C[1],R=F.SpriteBank.create(P),M=!0,j=!1,L=void 0;try{for(var D,B=Object.entries(A)[Symbol.iterator]();!(M=(D=B.next()).done);M=!0){var N=(0,v.default)(D.value,2),I=N[0],G=N[1],U=G.loops,V=G.speed,H=G.frames,X=G.gotoFrames,z=R.add(I,V,H,!0),Y=z.get(I);void 0!==U&&(Y.loops=!1),X&&(Y.goto=X,Y.loops=!1)}}catch(t){j=!0,L=t}finally{try{!M&&B.return&&B.return()}finally{if(j)throw L}}}}catch(t){E=!0,O=t}finally{try{!k&&T.return&&T.return()}finally{if(E)throw O}}}function l(t){return t&=~(J|Q|Z)}function c(t,e){if(!e)return{localId:e,flipX:!1,flipY:!1};var n=0!=(e&J),i=0!=(e&Q);return{localId:l(e)-t.firstGid,flipX:n,flipY:i}}function h(t,e){var n=c(t,e),i=n.localId,r=n.flipX,o=n.flipY,a=t.tilemap.getTileSubtexture(i),s=new B.Graphic(a);return s.flipX=r,s.flipY=o,s}function f(t){var e,n,i,r,o,a,s,u;return p.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:e=0,n=0,i=!0,r=!1,o=void 0,l.prev=5,a=t.data[Symbol.iterator]();case 7:if(i=(s=a.next()).done){l.next=15;break}return u=s.value,l.next=11,{tile:u,mapX:e,mapY:n};case 11:++e>=t.width&&(e=0,n++);case 12:i=!0,l.next=7;break;case 15:l.next=21;break;case 17:l.prev=17,l.t0=l.catch(5),r=!0,o=l.t0;case 21:l.prev=21,l.prev=22,!i&&a.return&&a.return();case 24:if(l.prev=24,!r){l.next=27;break}throw o;case 27:return l.finish(24);case 28:return l.finish(21);case 29:case"end":return l.stop()}},P[0],this,[[5,17,21,29],[22,,24,28]])}var d=n(42),p=i(d),y=n(11),v=i(y),m=n(5),g=i(m),_=n(0),b=i(_),w=n(1),x=i(w),k=n(2),E=i(k),O=n(3),S=i(O),T=n(4),C=i(T),P=[f].map(p.default.mark),A=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,C.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var R=n(6),M=n(14),j=n(44),L=n(54),F=n(45),D=n(12),B=n(9),N=n(28),I=n(109),G=n(7),U=n(23),V=n(59),H=n(17),X=n(29),z=n(235),Y=n(16);window.levelExt="xml";var W="assets",K=["terrain","shadows","corners","water","water_corners"],WobblyShaderParams=function(t){function WobblyShaderParams(){return(0,b.default)(this,WobblyShaderParams),(0,E.default)(this,(WobblyShaderParams.__proto__||Object.getPrototypeOf(WobblyShaderParams)).apply(this,arguments))}return(0,S.default)(WobblyShaderParams,t),(0,x.default)(WobblyShaderParams,[{key:"update",value:function(){this.tilemap.color.r=(Math.sin(R.Engine.elapsed)+1)/2+.5,this.tilemap.color.g=(Math.cos(R.Engine.elapsed)+1)/2}}]),WobblyShaderParams}(R.Component);A([R.Component.require,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,C.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",B.Tilemap)],WobblyShaderParams.prototype,"tilemap",void 0),WobblyShaderParams=A([R.Component.register],WobblyShaderParams);var q=n(236),J=(function(t){function e(t){(0,b.default)(this,e);var n=(0,E.default)(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.sortOrder=1,n.groupsMask.push(t),n.shader=e.shader,n.shaderCameraUniformName="matrix",n}(0,S.default)(e,t),(0,x.default)(e,null,[{key:"shader",get:function(){return e._shader||(e._shader=q()),e._shader}}]),(0,x.default)(e,[{key:"render",value:function(){return this.shader.set("time",R.Engine.elapsed),(0,g.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"render",this).call(this)}}])}(I.Renderer),2147483648),Q=1073741824,Z=536870912,$=function(t){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,b.default)(this,e);var i=(0,E.default)(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));i._shadows={},i.events=new U.GameEventsEmitter,i.cameraLerpSpeed=50,i.didCameraOnce=!1,i.targetCameraPosition=new G.Vector,i.solidHitgrids=[],i.shouldBegin=!1,i.reloading=!1,i.scene=t;var r=function(){i.loaded=!0,i.shouldBegin&&i.afterLoad()};return i.loaded=!1,L.Assets.xml[W+"/"+i.mapPath]?r():new L.AssetLoader(W).addXml(i.mapPath).load(r),i}return(0,S.default)(e,t),(0,x.default)(e,[{key:"tilemapCoords",value:function(t){return[Math.floor(t.sceneX/this.terrainTilemap.tileWidth),Math.floor(t.sceneY/this.terrainTilemap.tileHeight)]}},{key:"hitgridSquaresForHitbox",value:function(t){var e=[[t.sceneLeft,t.sceneTop],[t.sceneLeft,t.sceneBottom],[t.sceneRight,t.sceneTop],[t.sceneRight,t.sceneBottom]],n={},i=[],r=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=(0,v.default)(s.value,2),c=l[0],h=l[1],f=c/this.terrainTilemap.tileWidth,d=h/this.terrainTilemap.tileHeight,p=f+"_"+d;n[p]||(n[p]=!0,i.push([f,d]))}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return i}},{key:"getExitingEffects",value:function(){var t=void 0,e=!0,n=!1,i=void 0;try{for(var r,o=this.findAll(X.Player)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value,s=a.find(U.PlayerEffects);s&&s.exiting&&(t||(t=s))}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}return t}},{key:"getShadow",value:function(t){return this._shadows[t]}},{key:"loadTiledXML",value:function(t){for(var e=[],n=[],i=0;i<t.childElementCount;++i){var o=t.children[i];if("layer"===o.nodeName){var a=o.children[0],s=[],u=a.textContent.split(","),l=!0,c=!1,h=void 0;try{for(var f,d=u[Symbol.iterator]();!(l=(f=d.next()).done);l=!0){var p=f.value;s.push(parseInt(p,10))}}catch(t){c=!0,h=t}finally{try{!l&&d.return&&d.return()}finally{if(c)throw h}}e.push({width:r(o,"width"),height:r(o,"height"),name:o.getAttribute("name"),type:"tilelayer",data:s,objects:[],x:0,y:0})}else{if("tileset"!==o.nodeName)throw Error(o.nodeName);var y=o.getAttribute("source");!y||y.length,n.push({firstgid:r(o,"firstgid"),source:o.getAttribute("source")})}}return{tilewidth:r(t,"tilewidth"),tileheight:r(t,"tileheight"),width:r(t,"width"),height:r(t,"height"),type:t.nodeName,tilesets:n,layers:e}}},{key:"loadTiled",value:function(t,e,n,i){function r(t){t=l(t);var e=!0,n=!1,i=void 0;try{for(var r,o=y[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;if(t>=a.firstGid&&t<a.lastGid)return a}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}function a(t){if((t=l(t))<1)return null;var e=r(t);if(!e)return null;var n=c(e,t).localId;return(null!=e.tileproperties?e.tileproperties[n]:void 0)||null}var d=L.AssetLoader.pathify(t+e),p=void 0;if(e.endsWith("json")?p=L.Assets.json[d]:e.endsWith("xml")&&(p=this.loadTiledXML(L.Assets.xml[d].documentElement)),!p)throw Error("no level at "+d);var y=[],m=!0,g=!1,_=void 0;try{for(var b,w=p.tilesets[Symbol.iterator]();!(m=(b=w.next()).done);m=!0){var x=b.value,k=x.firstgid;if(void 0!==x.source)!function(){var e=function(t){if(null==t)throw Error("got null");var e=parseInt(t,10);if(isNaN(e))throw Error("expected a number, got "+t);return e},n=L.AssetLoader.pathify(t+x.source);n.endsWith(".tsx")&&(n=n.slice(0,n.length-3)+"xml");for(var i=L.Assets.xml[n],r=i.documentElement,a=function(t){return e(r.getAttribute(t))},s=(a("columns"),a("tilewidth")),u=a("tileheight"),l=k+a("tilecount"),c=-1,h="",f=-1,d={},p=0;p<r.children.length;++p){var v=r.children[p];switch(v.nodeName){case"image":c=e(v.getAttribute("width")),e(v.getAttribute("height")),v.getAttribute("trans"),h=v.getAttribute("source"),f=Math.floor(c/s);break;case"tileoffset":var m=e(v.getAttribute("x")),g=e(v.getAttribute("y"));new G.Vector(m,g);break;case"tile":var _=e(v.getAttribute("id")),b=v.getAttribute("type");b&&(d[_]={type:b});for(var w=0;w<v.children.length;++w){var E=v.children[w];switch(E.nodeName){case"properties":for(var O=d[_]||(d[_]={}),S=0;S<E.children.length;++S){var T=E.children[S],C=T.getAttribute("name");if(null==C)throw Error("null name");var P=T.getAttribute("value");if(null==P)throw Error("expected non-null at value");var A=T.getAttribute("type");O[C]=o(P,A)}break;default:throw Error("unknown <tile/> child "+E.nodeName)}}break;default:throw Error("unknown node name "+v.nodeName)}}var R={firstGid:k,lastGid:l,tilewidth:s,tileheight:u,tilesPerRow:f,image:h,tileproperties:d,tilemap:null};y.push(R)}();else{var E=k+function(t,e){var n=t[e],i=void 0===n?"undefined":(0,C.default)(n);if("number"!==i)throw Error("expected "+e+" to be a number, got "+i);if(isNaN(n))throw Error("expected "+e+" to be a number, got NaN");return n}(x,"tilecount"),O={firstGid:k,lastGid:E,tilewidth:x.tilewidth,tileheight:x.tileheight,tilesPerRow:Math.floor(x.imagewidth/x.tilewidth),tileproperties:x.tileproperties,image:x.image,tilemap:null};y.push(O)}}}catch(t){g=!0,_=t}finally{try{!m&&w.return&&w.return()}finally{if(g)throw _}}var S=new D.Hitgrid(p.tilewidth,p.tileheight,[H.Game.TAGS.SOLID]);n.add(S),this.solidHitgrids.push(S);var T=void 0;T=new D.Hitgrid(p.tilewidth,p.tileheight,["water"]),i.add(T),this.solidHitgrids.push(T);var P={},A=!0,M=!1,j=void 0;try{for(var F,N=y[Symbol.iterator]();!(A=(F=N.next()).done);A=!0){var I=F.value,V=L.AssetLoader.pathify(t+I.image),X=L.Assets.textures[V],z=new B.Tilemap(X,I.tilewidth,I.tileheight);I.tilemap=z,u(I),s(I,this._shadows);var W=!0,q=!1,J=void 0;try{for(var Q,Z=Object.entries(I.tileproperties)[Symbol.iterator]();!(W=(Q=Z.next()).done);W=!0){var $=(0,v.default)(Q.value,2),tt=$[0],et=$[1];et&&(P[parseInt(tt,10)+I.firstGid]=et.solid)}}catch(t){q=!0,J=t}finally{try{!W&&Z.return&&Z.return()}finally{if(q)throw J}}}}catch(t){M=!0,j=t}finally{try{!A&&N.return&&N.return()}finally{if(M)throw j}}var nt=[],it=-1,rt=!0,ot=!1,at=void 0;try{for(var st,ut=p.layers[Symbol.iterator]();!(rt=(st=ut.next()).done);rt=!0){var lt=st.value;if(it+=1,"objects"===lt.name){var ct=!0,ht=!1,ft=void 0;try{for(var dt,pt=f(lt)[Symbol.iterator]();!(ct=(dt=pt.next()).done);ct=!0){var yt=dt.value,vt=yt.mapX,mt=yt.mapY,gt=yt.tile,_t=a(gt);if(_t)if(_t.pushable){var bt=void 0,wt=r(gt);wt&&wt.tilemap&&(this.add(bt=new R.Entity(vt*wt.tilewidth,mt*wt.tileheight)),bt.depth=-10,bt.add(h(wt,gt)),Y.instantiatePrefab("pushableBlock",bt))}else if(_t.type){var xt=r(gt),kt=0,Et=0;xt&&(kt=.5*(p.tilewidth-xt.tilewidth),Et=.5*(p.tileheight-xt.tileheight));var Ot=vt*p.tilewidth+kt,St=mt*p.tileheight+Et,Tt=Y.instantiatePrefab(_t.type,void 0,Ot,St);xt&&xt.tilemap&&!Tt.find(B.Graphic)&&!Tt.find(U.MapLocation)&&Tt.add(_t.anim_name?new B.Sprite({animation:_t.anim_name}):h(xt,gt)),this.add(Tt)}}}catch(t){ht=!0,ft=t}finally{try{!ct&&pt.return&&pt.return()}finally{if(ht)throw ft}}}else if(-1!==K.indexOf(lt.name)){var Ct=!0,Pt=!1,At=void 0;try{for(var Rt,Mt=f(lt)[Symbol.iterator]();!(Ct=(Rt=Mt.next()).done);Ct=!0){var jt=Rt.value,vt=jt.mapX,mt=jt.mapY,gt=jt.tile;if(0!==gt){"terrain"===lt.name&&P[gt]?S.set(!0,vt,mt):"water"===lt.name&&T.set(!0,vt,mt);var Lt=r(gt);if(!Lt)throw Error("couldn't find a tilesetInfo for tile "+gt+" at ("+vt+", "+mt+") in layer "+lt.name);var Ft=c(Lt,gt),Dt=(Ft.localId,Ft.flipX),Bt=Ft.flipY,Nt=lt.name.startsWith("water")?i:n;if(Dt||Bt)Nt.add(h(Lt,gt)).position.set(vt*Lt.tilewidth,mt*Lt.tileheight);else{var It=gt-Lt.firstGid,Gt=Math.floor(It/Lt.tilesPerRow),Ut=Math.floor(It%Lt.tilesPerRow);if(void 0===nt[it]&&Lt.tilemap){var Vt=nt[it]=new B.Tilemap(Lt.tilemap.texture,Lt.tilemap.tileWidth,Lt.tilemap.tileHeight);Nt.add(Vt)}nt[it].set(Ut,Gt,vt,mt)}}}}catch(t){Pt=!0,At=t}finally{try{!Ct&&Mt.return&&Mt.return()}finally{if(Pt)throw At}}"terrain"===lt.name&&(this.terrainTilemap=nt[it]),"water"===lt.name&&nt[it].entity.add(new U.WaterFlow({tilemap:nt[it],hitgrid:T}))}else if("entities"===lt.name){var Ht=!0,Xt=!1,zt=void 0;try{for(var Yt,Wt=lt.objects[Symbol.iterator]();!(Ht=(Yt=Wt.next()).done);Ht=!0){var Kt=Yt.value,qt=new R.Entity(Kt.x,Kt.y);qt.depth=-2e3;var Jt=void 0,Qt=Kt.gid;if("number"==typeof Qt&&Qt>=1){var et=a(Qt),Zt=r(Qt);et&&et.type&&(Jt=et.type),Zt&&Zt.tilemap&&qt.add(h(Zt,Qt))}else Jt=Kt.type;Jt&&Y.instantiatePrefab(Jt,qt),qt.components.count>0&&this.add(qt)}}catch(t){Xt=!0,zt=t}finally{try{!Ht&&Wt.return&&Wt.return()}finally{if(Xt)throw zt}}}else if("solids"===lt.name){var $t=!0,te=!1,ee=void 0;try{for(var ne,ie=f(lt)[Symbol.iterator]();!($t=(ne=ie.next()).done);$t=!0){var re=ne.value,vt=re.mapX,mt=re.mapY,gt=re.tile;0!==gt&&S.set(!0,vt,mt)}}catch(t){te=!0,ee=t}finally{try{!$t&&ie.return&&ie.return()}finally{if(te)throw ee}}}}}catch(t){ot=!0,at=t}finally{try{!rt&&ut.return&&ut.return()}finally{if(ot)throw at}}}},{key:"onFinishedLevel",value:function(){delete L.Assets.xml[this.assetsPath]}},{key:"begin",value:function(){(0,g.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"begin",this).call(this),this.loaded?this.afterLoad():this.shouldBegin=!0}},{key:"dispose",value:function(){(0,g.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this)}},{key:"afterLoad",value:function(){R.Engine.isMobile&&this.scene,this.visibleZoom=1,this.targetZoom=1,this.add(new z.Hud);var t=this.terrain=this.add(new R.Entity);t.name="terrain",t.depth=100,this.loadTiled("assets/fantasy/TMX/",this.scene+".xml",t,t);var e=this.add(new R.Entity);e.name="events",e.add(this.events);var n=!0,i=!1,r=void 0;try{for(var o,a=this.getMapLocationsByName("player_spawn")[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=this.add(new X.Player,s.getScenePosition(G.Vector.temp0).add(G.Vector.temp3.set(0,-8)));U.PlayerEffects.nextLevelEffects&&u.find(U.PlayerEffects).copyFrom(U.PlayerEffects.nextLevelEffects)}}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}U.PlayerEffects.nextLevelEffects=void 0,this.preloadNextLevel()}},{key:"getMapLocationsByName",value:function(t){var e=(!(arguments.length>1&&void 0!==arguments[1])||arguments[1],this.findAllComponents(U.MapLocation).filter(function(e){return e.name===t}));return e.length,e}},{key:"checkDevKeys",value:function(){if(N.Keyboard.pressed(H.Game.KEYS.DEBUG_OPEN_DOOR)&&U.GameEventsEmitter.callAll(this.events.onTreasureCollected),N.Keyboard.pressed(H.Game.KEYS.DEBUG_OPEN_TREASURE)&&U.GameEventsEmitter.callAll(this.events.onHeartsCollected),N.Keyboard.pressed(H.Game.KEYS.DEBUG_NEXT_LEVEL))this.nextLevel(!1,!0);else{if(!N.Keyboard.pressed(H.Game.KEYS.DEBUG_PREV_LEVEL))return!0;this.prevLevel(!1,!0)}return!1}},{key:"update",value:function(){var t=this;if((0,g.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.loaded){if(j.Input.pressed(H.Game.KEYS.BACK_TO_TITLE))return void this.transitionToTitle();this.dust&&this.dust.burst(this.camera.position.x+R.Engine.width,this.camera.position.y-R.Engine.height+Math.random()*R.Engine.height*2,0),0!==this.allCollidersInTag("player").length||this.reloading||(this.reloading=!0,M.Alarm.create(this.terrain).start(H.Game.config.reloadTimeAfterDeath,function(){-1!==H.Game.levels.indexOf(t.scene)&&(U.PlayerEffects.nextLevelEffects=H.Game.getEffectsForNextLevelName(t.scene)),t.reloadLevel()})),this.cameraFollowPlayers()}}},{key:"getRectangleAroundAllPlayers",value:function(){var t=void 0,e=!0,n=!1,i=void 0;try{for(var r,o=this.allCollidersInTag(H.Game.TAGS.PLAYER)[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value,s=a.getSceneBounds(new G.Rectangle);t?t.encompassRect(s):t=(new G.Rectangle).copy(s)}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}return t}},{key:"cameraFollowPlayers",value:function(){var t=this.getRectangleAroundAllPlayers();if(t){var e=this.targetZoom,n=void 0;n=t.width>t.height?R.Engine.width/t.width:R.Engine.height/t.height,e=Math.min(this.targetZoom,n),e=this.targetZoom,this.visibleZoom=G.Calc.approach(this.visibleZoom,e,R.Engine.delta*Math.abs(e-this.visibleZoom)),this.camera.scale.set(this.visibleZoom,this.visibleZoom);var i=(new G.Rectangle).copy(this.camera.extents),r=this.terrainTilemap,o=r.getSceneBounds(new G.Rectangle),a=void 0,s=void 0;o.width<i.width?a=o.centerX:t.right=Math.min(o.right,t.right),o.height<i.height&&(s=o.centerY);var u=new G.Rectangle((void 0!==a?a:t.centerX)-i.width/2,(void 0!==s?s:t.centerY)-i.height/2,i.width,i.height);if(a||(u.right>o.right&&(u.x-=u.right-o.right),u.left<o.left&&(u.x+=o.left-u.left)),s||(u.bottom>o.bottom&&(u.y-=u.bottom-o.bottom),u.top<o.top&&(u.y+=o.top-u.top)),this.targetCameraPosition.set(u.x,u.y),this.didCameraOnce){var l=G.Vector.distance(this.targetCameraPosition,this.camera.position),c=R.Engine.delta*this.cameraLerpSpeed*l;this.camera.position.approach(this.targetCameraPosition,c)}else this.didCameraOnce=!0,this.camera.position.copy(this.targetCameraPosition)}}},{key:"mapWidth",get:function(){return this.terrainTilemap.mapWidth}},{key:"mapHeight",get:function(){return this.terrainTilemap.mapHeight}},{key:"terrainSize",get:function(){return[this.terrainTilemap.width,this.terrainTilemap.height]}},{key:"numShadows",get:function(){return Object.keys(this._shadows).length}},{key:"mapPath",get:function(){return"fantasy/TMX/"+this.scene+".xml"}},{key:"assetsPath",get:function(){return W+"/"+this.mapPath}},{key:"waterFlow",get:function(){return this.terrain.find(U.WaterFlow)}}]),e}(V.EditableScene);e.Level=$},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(6),m=n(8),g=n(21),Health=function(t){function Health(){(0,o.default)(this,Health);var t=(0,l.default)(this,(Health.__proto__||Object.getPrototypeOf(Health)).apply(this,arguments));return t.health=1,t.invincibilityTime=1,t.lastHitTime=-1e3,t.onDamage=[],t.onDie=[],t}return(0,d.default)(Health,t),(0,s.default)(Health,[{key:"addedToScene",value:function(){(0,h.default)(Health.prototype.__proto__||Object.getPrototypeOf(Health.prototype),"addedToScene",this).call(this),this.onDieDelegate=new g.EventDelegate(this.opts.onDie,this.entity)}},{key:"kill",value:function(){this.applyDamage(this.health,null)}},{key:"tryApplyDamage",value:function(t){return!this.invincible&&this.applyDamage(t.amount,t)}},{key:"applyDamage",value:function(t,e){this.lastHitTime=v.Engine.elapsed;var n=this.health;this.health-=t;var i=!0,r=!1,o=void 0;try{for(var a,s=this.onDamage[Symbol.iterator]();!(i=(a=s.next()).done);i=!0)(0,a.value)(e)}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}if(n>0&&this.health<=0){this.onDieDelegate.invoke();var u=!0,l=!1,c=void 0;try{for(var h,f=this.onDie[Symbol.iterator]();!(u=(h=f.next()).done);u=!0)(0,h.value)(e)}catch(t){l=!0,c=t}finally{try{!u&&f.return&&f.return()}finally{if(l)throw c}}this.opts.removeFromScene&&this.entity.destroyLater()}return!0}},{key:"dead",get:function(){return this.health<=0}},{key:"invincible",get:function(){return!this.dead&&v.Engine.elapsed-this.lastHitTime<this.invincibilityTime}}]),Health}(m.AutoComponent);Health=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([m.AutoComponent.register],Health),e.Health=Health},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(5),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u),c=n(2),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},m=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var g=n(6),_=n(14),b=n(12),w=n(9),x=n(55),k=n(44),E=n(7),O=n(29),S=n(34),T=n(17),C=n(16),P=n(85),A=n(83),R=n(21),TopDownDirection=function(t){function TopDownDirection(){(0,s.default)(this,TopDownDirection);var t=(0,h.default)(this,(TopDownDirection.__proto__||Object.getPrototypeOf(TopDownDirection)).apply(this,arguments));return t.lastDirection=new E.Vector(1,0),t.direction=new E.Vector(1,0),t}return(0,d.default)(TopDownDirection,t),(0,l.default)(TopDownDirection,[{key:"findMajorDirection",value:function(t){this.lastDirection.copy(this.direction),0===t.x&&0===t.y||(Math.abs(t.x)>Math.abs(t.y)?this.direction.set(t.x>0?1:-1,0):this.direction.set(0,t.y>0?1:-1))}}]),TopDownDirection}(g.Component);TopDownDirection=v([g.Component.register],TopDownDirection),e.TopDownDirection=TopDownDirection;var FreezingShot=function(t){function FreezingShot(t){var e=t.shotSpeed,n=t.onShot;(0,s.default)(this,FreezingShot);var i=(0,h.default)(this,(FreezingShot.__proto__||Object.getPrototypeOf(FreezingShot)).call(this));return i.shotSpeed=10,i.shots=[],i.emptyShotsTaken=0,i.onShotCbs=n,i.shotSpeed=void 0!==e?e:i.shotSpeed,i}return(0,d.default)(FreezingShot,t),(0,l.default)(FreezingShot,[{key:"addedToScene",value:function(){(0,o.default)(FreezingShot.prototype.__proto__||Object.getPrototypeOf(FreezingShot.prototype),"addedToScene",this).call(this),this.bodySprite=this.entity.getComponentByName("body"),this.mouthSprite=this.entity.getComponentByName("mouth"),this.mouthSprite.visible=!1,this.onShot=new R.EventDelegate(this.onShotCbs,this.entity)}},{key:"update",value:function(){if(k.Input.pressed(T.Game.KEYS.SHOOT)||x.TouchInput.tappedThisFrame()){var t=this.bodySprite.flipX;if(this.topDownDirection.direction.y>=0&&(this.mouthSprite.x=t?7:9,this.mouthSprite.visible=!0,this.mouthSprite.play("close",!0)),this.shots.length>0)this.fireShot(this.shots.splice(0,1)[0]);else if(T.Game.cheats.unlimitedAmmo)this.fireShot("ice");else{this.emptyShotsTaken+=1;var e=void 0,n=void 0;0!==this.topDownDirection.direction.y?(n="empty_breathup",e=this.sceneX+17):(n="empty_breath",e=this.sceneX+(t?-17:17));var i=this.scene.add(C.instantiatePrefab(n,null,e,this.sceneY)),r=i.find(w.Sprite);this.topDownDirection.direction.y<0&&(i.depth=this.entity.depth+1),"empty_breath"==n&&t&&(r.flipX=!0),this.topDownDirection.direction.y>0&&(r.flipY=!0,r.y+=30)}}}},{key:"fireShot",value:function(t){var e=this,n=void 0;switch(t){case"ice":n="blue_orb";break;case"mimic":n="grey_orb";break;default:throw Error(n)}var i=this.scene.add(C.instantiatePrefab(n,null,this.physics.sceneCenterX,this.physics.sceneCenterY)),r=i.find(P.Mover),o=this.topDownDirection.direction,a=o.x,s=o.y,u=void 0;if("ice"===t){u=300;var l=!1;i.find(_.Physics).onCollide.push(function(t,n){var i=n.entity?n.entity.find(A.Freezable):null;i&&i.canFreezeFrom(e.physics.sceneCenterX,e.physics.sceneCenterY)&&!l&&(l=!0,i.freeze())})}else{if("mimic"!==t)throw Error(t);u=120;var c=!1;i.group("player");var h=i.find(_.Physics),f=i.find(S.PlayerEffects);h.onCollide.push(function(t,n){if(!c){c=!0;var i=E.Vector.temp0.set(h.sceneCenterX,h.sceneCenterY).sub(E.Vector.temp2.set(12,12)).add(E.Vector.temp1.set(12*-a,12*-s)),r=e.scene.add(new O.Player,i);r.find(S.PlayerEffects).copyFrom(f.effects);var o=r.find(w.Sprite);_.Tween.create(r).start(.2,.5,1,E.Ease.cubeOut,function(t){o.scale.set(t,t)},!0).restart()}})}r.setDelta(a*u,s*u),this.onShot.invoke()}},{key:"didPickupHeart",value:function(t){this.shots.push(t.type)}},{key:"shotsLeft",get:function(){return this.shots.length}}]),FreezingShot}(g.Component);v([g.Component.require,m("design:type",TopDownDirection)],FreezingShot.prototype,"topDownDirection",void 0),v([g.Component.require,m("design:type",_.Physics)],FreezingShot.prototype,"physics",void 0),FreezingShot=v([g.Component.register,m("design:paramtypes",[Object])],FreezingShot),e.FreezingShot=FreezingShot;var TopDownControls=function(t){function TopDownControls(t){var e=t.maxSpeed,n=t.speed,i=t.friction;(0,s.default)(this,TopDownControls);var r=(0,h.default)(this,(TopDownControls.__proto__||Object.getPrototypeOf(TopDownControls)).call(this));return r.movingEnabled=!0,r.addedSpeed=new E.Vector(0,0),r.programmaticMove=new E.Vector(0,0),r.maxSpeed=e,r.speed=n,r.friction=i,r}return(0,d.default)(TopDownControls,t),(0,l.default)(TopDownControls,[{key:"addedToScene",value:function(){var t=this;(0,o.default)(TopDownControls.prototype.__proto__||Object.getPrototypeOf(TopDownControls.prototype),"addedToScene",this).call(this),this.physics.onCollideX=function(){t.physics.speed.x=0},this.physics.onCollideY=function(){t.physics.speed.y=0}}},{key:"unstick",value:function(){var t=this.physics,e=["water_solid","solid"],n=t.collideAllMulti(e),i=t.sceneBounds.getCenter(E.Vector.temp0);if(0!==n.length){var r=n[0],o=void 0;if(r instanceof b.Hitgrid){var a=[[t.collideAllMulti(e,-2,0).length,[-1,0]],[t.collideAllMulti(e,2,0).length,[1,0]],[t.collideAllMulti(e,0,-2).length,[0,-1]],[t.collideAllMulti(e,0,2).length,[0,1]]];a.sort(function(t,e){return E.Calc.cmp(t[0],e[0])}),o=a[0][1]}else if(r instanceof b.Hitbox){var s=[Math.abs(i.x-r.sceneLeft),[-1,0]],u=[Math.abs(i.x-r.sceneRight),[1,0]],l=[Math.abs(i.x-r.sceneTop),[0,-1]],c=[Math.abs(i.x-r.sceneBottom),[0,1]],h=[s,u,l,c];h.sort(function(t,e){return E.Calc.cmp(t[0],e[0])}),o=h[0][1],t.height}t.entity.position.add(E.Vector.temp1.set(o[0],o[1]))}}},{key:"faceLeft",value:function(){this.programmaticMove.set(-1,0)}},{key:"update",value:function(){(0,o.default)(TopDownControls.prototype.__proto__||Object.getPrototypeOf(TopDownControls.prototype),"update",this).call(this);var t=this.friction,e=this.speed,n=this.maxSpeed,i=e*g.Engine.delta,r=this.addedSpeed.set(0,0),a=this.entity.find(TopDownDirection);if(this.movingEnabled){var s=x.TouchInput.joystick.x<0||k.Input.down(T.Game.KEYS.LEFT),u=x.TouchInput.joystick.x>0||k.Input.down(T.Game.KEYS.RIGHT),l=x.TouchInput.joystick.y<0||k.Input.down(T.Game.KEYS.UP),c=x.TouchInput.joystick.y>0||k.Input.down(T.Game.KEYS.DOWN);r.set((s?-i:0)+(u?i:0),(l?-i:0)+(c?i:0)),this.playerEffects.hasEffect(S.EffectType.WalkBackwards)&&r.negate(),r.add(this.programmaticMove),this.programmaticMove.set(0,0),a.findMajorDirection(r)}this.physics.speed.add(r),this.physics.friction(0===r.x?t:0,0===r.y?t:0),this.physics.circularMaxspeed(n);var h=E.Calc.sign(this.physics.speed.x);0!==h&&(this.sprite.flipX=!(h>0)),this.movingEnabled&&this.sprite.play(this.getCurrentAnimTrack()),-1!==this.physics.tags.indexOf("player")&&this.unstick()}},{key:"getCurrentAnimTrack",value:function(){var t=this.entity.find(TopDownDirection),e=void 0;return this.physics.speed.length>0?t.direction.y<0?e="walkup":(0===t.direction.x||t.lastDirection.x===t.direction.x&&"walk"===this.sprite.playing.name||(e="walk"),e="walk"):e=t.direction.y<0?"idleup":"idle",e}}]),TopDownControls}(g.Component);v([g.Component.require,m("design:type",_.Physics)],TopDownControls.prototype,"physics",void 0),v([g.Component.require,m("design:type",w.Sprite)],TopDownControls.prototype,"sprite",void 0),v([g.Component.require,m("design:type",TopDownDirection)],TopDownControls.prototype,"topDownDirection",void 0),v([g.Component.require,m("design:type",S.PlayerEffects)],TopDownControls.prototype,"playerEffects",void 0),TopDownControls=v([g.Component.register,m("design:paramtypes",[Object])],TopDownControls),e.TopDownControls=TopDownControls},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u),c=n(2),h=i(c),f=n(5),d=i(f),p=n(3),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(7),m=n(6),g=n(12),_=n(28),b=n(44),w=n(56),x=n(55),k=(n(28),n(17)),E=n(16),O=n(34),S=n(126),T=function(t){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,s.default)(this,e);var n=(0,h.default)(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.sliderEnabled=!0,n.slider=0,n.sliderTo=-1,n.groupsMask=[],n.selection=null,n.dragging=null,n.dragOrigin=new v.Vector,n.draggingRect=new v.Rectangle,n.loaded=!1,window.scene=n,t||(n.slider=n.sliderTo),n}return(0,y.default)(e,t),(0,l.default)(e,[{key:"findUnder",value:function(t){var e=this.groupsMask.length>0?this.allInGroups(this.groupsMask):this.entities,n=null;return e.each(function(e){if(e.visible){var i=e.findAll(g.Hitbox),r=!0,o=!1,a=void 0;try{for(var s,u=i[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value;if(l.sceneBounds.containsPoint(t))return n=l,!1}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}}}),n}},{key:"renderSlider",value:function(){var t=k.Game.transitionColor;if(!this.loaded)return void m.Engine.graphics.clear(t);if(this.sliderEnabled&&this.slider!==this.sliderTo){m.Engine.graphics.setRenderTarget(m.Engine.graphics.buffer),m.Engine.graphics.shader=v.Shaders.primitive,m.Engine.graphics.shader.set("matrix",this.camera.matrix);var e=v.Ease.cubeInOut(this.slider),n=this.camera.extents;m.Engine.graphics.rect(n.left+e*n.width,n.top,n.width,n.height,t)}}},{key:"update",value:function(){b.Input.update(),(0,d.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.sliderEnabled&&this.slider!==this.sliderTo&&(this.slider=v.Calc.approach(this.slider,this.sliderTo,1.7*m.Engine.delta),this.slider===this.sliderTo&&this.sliderOnEnd&&(this.sliderOnEnd(),this.sliderOnEnd=null)),m.Engine.debugMode&&k.Game.developer&&this.updateDebugView()}},{key:"checkCommonDevKeys",value:function(){}},{key:"render",value:function(){(0,d.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"render",this).call(this),this.renderSlider(),x.TouchInput.instance.draw(this.camera)}},{key:"debugRender",value:function(t){(0,d.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"debugRender",this).call(this,t),m.Engine.graphics.fillText("scene: "+this.scene,100,100)}},{key:"updateDebugView",value:function(){var t=this.camera.worldMouse;if(_.Mouse.leftPressed){var n=(this.groupsMask.length>0?this.allInGroups(this.groupsMask):this.entities,this.findUnder(t));n&&(this.selection=n,window.editSelection=n,S.editJSON(this.selection.prefabLink),this.dragging=n,this.draggingMode=e.borderContainsPoint(n.sceneBounds,t,3),this.draggingRect.copy(n.sceneBounds),this.dragOrigin.copy(t).sub(v.Vector.temp1.set(n.left,n.top)))}else if(_.Mouse.left&&this.dragging){var i=v.Vector.temp0.copy(t).sub(this.dragOrigin),r=v.Vector.temp1.copy(t).sub(v.Vector.temp2.set(this.draggingRect.x,this.draggingRect.y)),o=v.Vector.temp3.set(this.draggingRect.right,this.draggingRect.bottom).sub(t);r.x+=1,r.y+=1;var a={};switch(this.draggingMode){case"None":a={left:i.x,top:i.y};break;case"Top":a={top:i.y,height:o.y};break;case"Bottom":a={height:r.y};break;case"Left":a={left:i.x,width:o.x};break;case"Right":a={width:r.x};break;case"BottomRight":a={width:r.x,height:r.y};break;case"TopLeft":a={top:i.y,height:o.y,left:i.x,width:o.x};break;case"TopRight":a={top:i.y,height:o.y,width:r.x};break;case"BottomLeft":a={height:r.y,left:i.x,width:o.x};break;default:throw Error("unexpected RectBorder")}this.dragging.setPrefabValues(a)}else if(!_.Mouse.left){var s="inherit",u=this.findUnder(t);if(u){var l=u.sceneBounds,c=e.borderContainsPoint(l,t,3);s="None"===c?"move":e.cursorForRectBorder(c)}m.Engine.graphics.canvas.style.cursor=s}_.Mouse.leftReleased&&this.dragging&&(this.dragging=null,E.sendPrefabsToServer())}},{key:"transitionTo",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.sliderEnabled?this.doSlide(n,i,function(){return e.goto(t)}):this.goto(t)}},{key:"transitionToTitle",value:function(){var t=this,e=new(n(87).TitleScreen);this.sliderEnabled?this.doSlide(1,0,function(){return t.gotoLevel(e)}):this.gotoLevel(e)}},{key:"editMap",value:function(){}},{key:"gotoLevel",value:function(t){m.Engine.goto(t,!0)}},{key:"goto",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=void 0;k.Game._preloadedLevel&&k.Game._preloadedLevel.scene===t?(n=k.Game._preloadedLevel,k.Game._preloadedLevel=null):n=new w.Level(t,e),this.gotoLevel(n)}},{key:"reloadLevel",value:function(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?this.goto(this.scene,!1):this.transitionTo(this.scene,-1,0)}},{key:"preloadNextLevel",value:function(){var t=this.scene?k.Game.getNextLevelName(this.scene):null;t&&!e.hasPreloadedLevel(t)&&e.preloadLevel(t)}},{key:"nextLevel",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.levelDelta(1,t,e)}},{key:"prevLevel",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.levelDelta(-1,t,e)}},{key:"newGame",value:function(){k.Game.clearCompletedLevels(),this.nextLevel()}},{key:"completeLevel",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments[1];k.Game.markLevelCompleted(this.scene,e),this.nextLevel(t)}},{key:"onFinishedLevel",value:function(){}},{key:"levelDelta",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=k.Game.levels.indexOf(this.scene),r=void 0,a=void 0;if(n||1!==t){var s=[k.Game.levels[i+t],[]];r=s[0],a=s[1]}else{this.onFinishedLevel();var u=k.Game.getNextLevelNameAndEffects();if(u){var l=(0,o.default)(u,2);r=l[0],a=l[1],O.PlayerEffects.nextLevelEffects=a}}r||n?e?this.transitionTo(r):r&&this.goto(r,!1):this.gotoLevel(k.Game.EndScreen)}},{key:"doSlide",value:function(t,e,n){this.sliderOnEnd||(this.slider=t,this.sliderTo=e,this.sliderOnEnd=n)}},{key:"name",get:function(){return this.scene}}],[{key:"borderContainsPoint",value:function(t,e){var n=e.x,i=e.y,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,o=t.left,a=t.top,s=t.right,u=t.bottom,l=Math.abs(o-n)<=r,c=Math.abs(s-n)<=r,h=Math.abs(a-i)<=r,f=Math.abs(u-i)<=r;if(l&&h)return"TopLeft";if(c&&h)return"TopRight";if(l&&f)return"BottomLeft";if(c&&f)return"BottomRight";var d=o<n&&n<s,p=a<i&&i<u;return h&&d?"Top":f&&d?"Bottom":l&&p?"Left":c&&p?"Right":"None"}},{key:"cursorForRectBorder",value:function(t){switch(t){case"Top":return"n-resize";case"Bottom":return"s-resize";case"Left":return"w-resize";case"Right":return"e-resize";case"TopLeft":return"nw-resize";case"TopRight":return"ne-resize";case"BottomLeft":return"sw-resize";case"BottomRight":return"se-resize";case"None":return"inherit";default:throw Error("unexpected RectBorder value")}}},{key:"hasPreloadedLevel",value:function(t){return k.Game._preloadedLevel&&k.Game._preloadedLevel.scene===t}},{key:"preloadLevel",value:function(t){k.Game._preloadedLevel=new w.Level(t,!0)}}]),e}(m.Scene);e.EditableScene=T},function(t,e,n){n(131);for(var i=n(25),r=n(36),o=n(35),a=n(19)("toStringTag"),s=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],u=0;u<5;u++){var l=s[u],c=i[l],h=c&&c.prototype;h&&!h[a]&&r(h,a,l),o[l]=o.Array}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){t.exports=!0},function(t,e,n){var i=n(135);t.exports=function(t,e,n){if(i(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)}}return function(){return t.apply(e,arguments)}}},function(t,e,n){var i=n(38);t.exports=function(t,e){if(!i(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!i(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!i(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){var i=n(31),r=n(137),o=n(70),a=n(68)("IE_PROTO"),s=function(){},u=function(){var t,e=n(90)("iframe"),i=o.length;for(e.style.display="none",n(140).appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),u=t.F;i--;)delete u.prototype[o[i]];return u()};t.exports=Object.create||function(t,e){var n;return null!==t?(s.prototype=i(t),n=new s,s.prototype=null,n[a]=t):n=u(),void 0===e?n:r(n,e)}},function(t,e){var n=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:n)(t)}},function(t,e,n){var i=n(69)("keys"),r=n(48);t.exports=function(t){return i[t]||(i[t]=r(t))}},function(t,e,n){var i=n(25),r=i["__core-js_shared__"]||(i["__core-js_shared__"]={});t.exports=function(t){return r[t]||(r[t]={})}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,n){var i=n(26).f,r=n(33),o=n(19)("toStringTag");t.exports=function(t,e,n){t&&!r(t=n?t:t.prototype,o)&&i(t,o,{configurable:!0,value:e})}},function(t,e,n){var i=n(62);t.exports=function(t){return Object(i(t))}},function(t,e,n){e.f=n(19)},function(t,e,n){var i=n(25),r=n(18),o=n(63),a=n(73),s=n(26).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=o?{}:i.Symbol||{});"_"==t.charAt(0)||t in e||s(e,t,{value:a.f(t)})}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,n){var i=n(75),r=n(40),o=n(24),a=n(65),s=n(33),u=n(89),l=Object.getOwnPropertyDescriptor;e.f=n(32)?l:function(t,e){if(t=o(t),e=a(e,!0),u)try{return l(t,e)}catch(t){}if(s(t,e))return r(!i.f.call(t,e),t[e])}},function(t,e){function n(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function r(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function o(t){if(h===clearTimeout)return clearTimeout(t);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function a(){y&&d&&(y=!1,d.length?p=d.concat(p):v=-1,p.length&&s())}function s(){if(!y){var t=r(a);y=!0;for(var e=p.length;e;){for(d=p,p=[];++v<e;)d&&d[v].run();v=-1,e=p.length}d=null,y=!1,o(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var c,h,f=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(t){h=i}}();var d,p=[],y=!1,v=-1;f.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new u(t,e)),1!==p.length||y||r(s)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.prependListener=l,f.prependOnceListener=l,f.listeners=function(t){return[]},f.binding=function(t){throw Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw Error("process.chdir is not supported")},f.umask=function(){return 0}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(10),l=n(7),c=n(50),h=n(100),f=function(){function t(e,n){if((0,o.default)(this,t),this.sound=null,this.started=!1,this.groups=[],this.fadePercent=1,this.fadeDuration=1,this._loop=!1,this._paused=!1,this._muted=!1,this._volume=1,this.source=c.Assets.sounds[e],n&&n.length>0){var i=!0,r=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;this.group(l)}}catch(t){r=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(r)throw a}}}}return(0,s.default)(t,[{key:"play",value:function(t){if(this.loop=t,null!=this.sound&&this.started)this.sound.currentTime=0,this._paused&&this.resume();else if(this.sound=this.source.requestSound(),null!=this.sound)if(this.sound.readyState<3){var e=this;e.loadedEvent=function(){null!=e.sound&&e.internalPlay(),e.sound.removeEventListener("loadeddata",e.loadedEvent),e.loadedEvent=null},this.sound.addEventListener("loadeddata",e.loadedEvent)}else this.internalPlay();return this}},{key:"resume",value:function(){return this.started&&this._paused&&this.sound.play(),this._paused=!1,this}},{key:"pause",value:function(){return this.started&&!this._paused&&this.sound.pause(),this._paused=!0,this}},{key:"stop",value:function(){if(null!=this.sound){this.source.returnSound(this.sound),this.started&&(this.sound.pause(),this.sound.currentTime=0,this.sound.volume=1,this.sound.muted=!1,this.sound.removeEventListener("ended",this.endEvent),null!=this.loadedEvent&&this.sound.removeEventListener("loadeddata",this.loadedEvent)),this.sound=null,this.started=!1,this._paused=!1,this.fadePercent=1;var e=t.active.indexOf(this);e>=0&&t.active.splice(e,1)}return this}},{key:"group",value:function(t){return this.groups.push(t),this.internalUpdateVolume(),this.internalUpdateMuted(),this}},{key:"ungroup",value:function(t){var e=this.groups.indexOf(t);return e>=0&&(this.groups.splice(e,1),this.internalUpdateVolume(),this.internalUpdateMuted()),this}},{key:"ungroupAll",value:function(){return this.groups=[],this.internalUpdateVolume(),this.internalUpdateMuted(),this}},{key:"ingroup",value:function(t){return this.groups.indexOf(t)>=0}},{key:"internalPlay",value:function(){this.started=!0,t.active.push(this);var e=this;this.endEvent=function(){e.stop()},this.sound.addEventListener("ended",this.endEvent),this.sound.loop=this.loop,this.internalUpdateVolume(),this.internalUpdateMuted(),this._paused||this.sound.play()}},{key:"internalUpdateVolume",value:function(){if(this.started){var t=1,e=!0,n=!1,i=void 0;try{for(var r,o=this.groups[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;t*=h.AudioGroup.volume(a)}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}this.sound.volume=this._volume*t*u.Engine.volume}}},{key:"internalUpdateMuted",value:function(){if(this.started){for(var t=!1,e=0;e<this.groups.length&&!t;e++)t=t||h.AudioGroup.muted(this.groups[e]);this.sound.muted=u.Engine.muted||this._muted||t}}},{key:"update",value:function(){this.fadePercent<1&&(this.fadePercent=l.Calc.approach(this.fadePercent,1,u.Engine.delta/this.fadeDuration),this.volume=this.fadeFrom+(this.fadeTo-this.fadeFrom)*this.fadeEase(this.fadePercent))}},{key:"fade",value:function(t,e,n){return this.fadeFrom=this.volume,this.fadeTo=t,this.fadeDuration=Math.max(.001,e),this.fadeEase=void 0!=n?n:function(t){return t},this.fadePercent=0,this}},{key:"playing",get:function(){return this.started&&!this._paused}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this.started&&(this.sound.loop=this._loop)}},{key:"paused",get:function(){return this._paused}},{key:"muted",get:function(){return this._muted},set:function(t){this._muted=t,this.internalUpdateMuted()}},{key:"volume",get:function(){return this._volume},set:function(t){this._volume=t,this.internalUpdateVolume()}}]),t}();f.active=[],e.Sound=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(37),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=n(10),h=n(15),f=function(){function t(){(0,s.default)(this,t)}return(0,l.default)(t,[{key:"percent",value:function(){return new h.Vector}}],[{key:"init",value:function(){var e=this;t._position=new h.Vector(0,0),t._positionNext=new h.Vector(0,0),c.Engine.root.addEventListener("mousemove",function(e){t.absolute=new h.Vector(e.pageX,e.pageY),t.setNextMouseTo(e.pageX,e.pageY)}),c.Engine.root.addEventListener("mousedown",function(n){e.mouseDownCb&&e.mouseDownCb(n),0===n.button?t._leftNext=!0:t._rightNext=!0}),c.Engine.root.addEventListener("mouseup",function(e){0===e.button?t._leftNext=!1:t._rightNext=!1})}},{key:"update",value:function(){this._leftWas=this._left,this._left=this._leftNext,this._rightWas=this._right,this._right=this._rightNext,this._position=this._positionNext}},{key:"pageToScreen",value:function(t,e){var n=c.Engine.graphics.canvas.getBoundingClientRect(),i=c.Engine.graphics.getOutputBounds(),r=new h.Vector(i.width/c.Engine.width,i.height/c.Engine.height);return[(t-n.left-i.left)/r.x,(e-n.top-i.top)/r.y]}},{key:"setNextMouseTo",value:function(e,n){var i=(c.Engine.graphics.canvas.getBoundingClientRect(),c.Engine.graphics.getOutputBounds());new h.Vector(i.width/c.Engine.width,i.height/c.Engine.height),t._positionNext=new(Function.prototype.bind.apply(h.Vector,[null].concat((0,o.default)(this.pageToScreen(e,n)))))}},{key:"x",get:function(){return this._position.x}},{key:"y",get:function(){return this._position.y}},{key:"position",get:function(){return new h.Vector(this._position.x,this._position.y)}},{key:"left",get:function(){return this._left}},{key:"leftPressed",get:function(){return this._left&&!this._leftWas}},{key:"leftReleased",get:function(){return!this._left&&this._leftWas}},{key:"right",get:function(){return this._right}},{key:"rightPressed",get:function(){return this._right&&!this._rightWas}},{key:"rightReleased",get:function(){return!this._right&&this._rightWas}}]),t}();f.absolute=new h.Vector(0,0),e.Mouse=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(10),l=n(51),c=n(15),h=function(){function t(e,n,i,r){(0,o.default)(this,t),this.dirty=!0,this.uniformsByName={},u.Engine.graphics.gl,this.attributes=r,this.uniforms=i,this.setProgramText(e,n)}return(0,s.default)(t,[{key:"setProgramText",value:function(t,e){var n=u.Engine.graphics.gl,i=n.createShader(n.VERTEX_SHADER);if(n.shaderSource(i,t),n.compileShader(i),!n.getShaderParameter(i,n.COMPILE_STATUS))throw Error("An error occurred compiling the shaders: "+n.getShaderInfoLog(i));var r=n.createShader(n.FRAGMENT_SHADER);if(n.shaderSource(r,e),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))throw Error("An error occurred compiling the shaders: "+n.getShaderInfoLog(r));if(this.program&&n.deleteProgram(this.program),this.program=n.createProgram(),n.attachShader(this.program,i),n.attachShader(this.program,r),n.linkProgram(this.program),!n.getProgramParameter(this.program,n.LINK_STATUS))throw Error("Unable to initialize the shader program.");n.deleteShader(i),n.deleteShader(r);var o=!0,a=!1,s=void 0;try{for(var l,c=this.attributes[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;h.attribute=n.getAttribLocation(this.program,h.name)}}catch(t){a=!0,s=t}finally{try{!o&&c.return&&c.return()}finally{if(a)throw s}}var d=!0,p=!1,y=void 0;try{for(var v,m=this.uniforms[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var g=v.value;this.uniformsByName[g.name]=g,g.shader=this,g.uniform=n.getUniformLocation(this.program,g.name),g.type===f.sampler2D&&null==this.sampler2d&&(this.sampler2d=g)}}catch(t){p=!0,y=t}finally{try{!d&&m.return&&m.return()}finally{if(p)throw y}}}},{key:"set",value:function(t,e){this.uniformsByName[t].value=e}}]),t}();h._last_uuid=0,e.Shader=h;var f;!function(t){t[t.float=0]="float",t[t.floatArray=1]="floatArray",t[t.float2=2]="float2",t[t.float2Array=3]="float2Array",t[t.float3=4]="float3",t[t.float3Array=5]="float3Array",t[t.float4=6]="float4",t[t.float4Array=7]="float4Array",t[t.matrix2d=8]="matrix2d",t[t.matrix3d=9]="matrix3d",t[t.matrix4d=10]="matrix4d",t[t.int=11]="int",t[t.intArray=12]="intArray",t[t.int2=13]="int2",t[t.int2Array=14]="int2Array",t[t.int3=15]="int3",t[t.int3Array=16]="int3Array",t[t.int4=17]="int4",t[t.int4Array=18]="int4Array",t[t.sampler2D=19]="sampler2D"}(f=e.ShaderUniformType||(e.ShaderUniformType={}));var d=function(){function t(e,n,i){(0,o.default)(this,t),this._value=null,this.name=e,this.type=n,this._value=i}return(0,s.default)(t,[{key:"value",get:function(){return this._value},set:function(t){this.value!=t&&(this._value=t,this._shader.dirty=!0,this.dirty=!0)}},{key:"shader",set:function(t){this._shader=t}}]),t}();e.ShaderUniform=d,function(t){t[t.Position=0]="Position",t[t.Texcoord=1]="Texcoord",t[t.Color=2]="Color"}(e.ShaderAttributeType||(e.ShaderAttributeType={}));var p=function t(e,n){(0,o.default)(this,t),this.name=e,this.type=n};e.ShaderAttribute=p,e.setGLUniformValue={},e.setGLUniformValue[f.float]=function(t,e,n){t.uniform1f(e,n)},e.setGLUniformValue[f.float2]=function(t,e,n){n instanceof c.Vector?t.uniform2f(e,n.x,n.y):t.uniform2f(e,n[0],n[1])},e.setGLUniformValue[f.float3]=function(t,e,n){t.uniform3f(e,n[0],n[1],n[2])},e.setGLUniformValue[f.float4]=function(t,e,n){t.uniform4f(e,n[0],n[1],n[2],n[3])},e.setGLUniformValue[f.floatArray]=function(t,e,n){t.uniform1fv(e,n)},e.setGLUniformValue[f.float2Array]=function(t,e,n){t.uniform2fv(e,n)},e.setGLUniformValue[f.float3Array]=function(t,e,n){t.uniform3fv(e,n)},e.setGLUniformValue[f.float4Array]=function(t,e,n){t.uniform4fv(e,n)},e.setGLUniformValue[f.int]=function(t,e,n){t.uniform1i(e,n)},e.setGLUniformValue[f.int2]=function(t,e,n){n instanceof c.Vector?t.uniform2i(e,Math.round(n.x),Math.round(n.y)):t.uniform2i(e,n[0],n[1])},e.setGLUniformValue[f.int3]=function(t,e,n){t.uniform3i(e,n[0],n[1],n[2])},e.setGLUniformValue[f.int4]=function(t,e,n){t.uniform4i(e,n[0],n[1],n[2],n[3])},e.setGLUniformValue[f.intArray]=function(t,e,n){t.uniform1iv(e,n)},e.setGLUniformValue[f.int2Array]=function(t,e,n){t.uniform2iv(e,n)},e.setGLUniformValue[f.int3Array]=function(t,e,n){t.uniform3iv(e,n)},e.setGLUniformValue[f.int4Array]=function(t,e,n){t.uniform4iv(e,n)},e.setGLUniformValue[f.matrix2d]=function(t,e,n){t.uniformMatrix2fv(e,!1,n)},e.setGLUniformValue[f.matrix3d]=function(t,e,n){n instanceof l.Matrix?t.uniformMatrix3fv(e,!1,n.mat):t.uniformMatrix3fv(e,!1,n)},e.setGLUniformValue[f.matrix4d]=function(t,e,n){t.uniformMatrix2fv(e,!1,n)}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){return void 0===t?e:t}var o=n(5),a=i(o),s=n(0),u=i(s),l=n(1),c=i(l),h=n(2),f=i(h),d=n(3),p=i(d),y=n(4),v=i(y),m=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,v.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var g=n(6),_=n(7),b=n(8),w=n(46);n(13);var ParticleAttractor=function(t){function ParticleAttractor(){return(0,u.default)(this,ParticleAttractor),(0,f.default)(this,(ParticleAttractor.__proto__||Object.getPrototypeOf(ParticleAttractor)).apply(this,arguments))}return(0,p.default)(ParticleAttractor,t),(0,c.default)(ParticleAttractor,[{key:"update",value:function(){if(this.target){var t=(g.Engine.delta,this.target.getScenePosition(_.Vector.temp1)),e=850*g.Engine.delta,n=e-.1*e,i=e+.1*e,r=!0,o=!1,a=void 0;try{for(var s,u=this.particleSystem.particles[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value,c=_.Calc.range(n,i);l.speedX=_.Calc.approach(l.speedX,8*(t.x-l.x),c),l.speedY=_.Calc.approach(l.speedY,8*(t.y-l.y),c)}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}}}}]),ParticleAttractor}(b.AutoComponent);m([b.AutoComponent.require,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,v.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",w.ParticleSystem)],ParticleAttractor.prototype,"particleSystem",void 0),ParticleAttractor=m([b.AutoComponent.register],ParticleAttractor),e.ParticleAttractor=ParticleAttractor;var Burst=function(t){function Burst(){(0,u.default)(this,Burst);var t=(0,f.default)(this,(Burst.__proto__||Object.getPrototypeOf(Burst)).apply(this,arguments));return t.loop=!1,t}return(0,p.default)(Burst,t),(0,c.default)(Burst,[{key:"addedToScene",value:function(){(0,a.default)(Burst.prototype.__proto__||Object.getPrototypeOf(Burst.prototype),"addedToScene",this).call(this),void 0!==this.opts.loop&&(this.loop=this.opts.loop),this.pSys=this.entity.find(w.ParticleSystem),this.pSys||(this.pSys=this.entity.add(new w.ParticleSystem(this.opts.template))),this.opts.template&&(this.pSys.template.name,this.opts.template),r(this.opts.autoPlay,!0)&&this.trigger()}},{key:"update",value:function(){if(void 0===this.opts.rate){if(this.pSys.numActiveParticles>0)return;this.loop&&this.pSys.active?this.trigger():r(this.opts.autoRemove,!0)&&this.entity.scene.remove(this.entity)}else this.trigger()}},{key:"trigger",value:function(){var t=this.opts,e=t.x,n=t.y,i=t.direction,r=t.rangeX,o=t.rangeY,a=t.count,s=t.rate;void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0!==s&&(a=s*g.Engine.delta),this.pSys.numActiveParticles<this.maxParticles&&this.pSys.burst(e,n,i,r,o,a)}},{key:"maxParticles",get:function(){return this.opts.maxParticles||400}}]),Burst}(b.AutoComponent);Burst=m([b.AutoComponent.register],Burst),e.Burst=Burst},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var m=n(6),g=n(14),_=n(9),b=n(7),w=n(23),x=n(16),k=n(23),E=n(8);n(13);var O=n(21),Freezable=S=function(t){function Freezable(){(0,o.default)(this,Freezable);var t=(0,l.default)(this,(Freezable.__proto__||Object.getPrototypeOf(Freezable)).apply(this,arguments));return t.freezeTimeEnabled=!1,t.totalFreezeTime=11.69,t.freezeTime=1/0,t.frozenLastFrame=!1,t.extraFreezeTime=0,t}return(0,d.default)(Freezable,t),(0,s.default)(Freezable,[{key:"addedToScene",value:function(){(0,h.default)(Freezable.prototype.__proto__||Object.getPrototypeOf(Freezable.prototype),"addedToScene",this).call(this),this.onFreezeDelegate=new O.EventDelegate(this.opts.onFreeze,this.entity),this.onThawDelegate=new O.EventDelegate(this.opts.onThaw,this.entity),this.onCancelFreeze=new O.EventDelegate(this.opts.onCancelFreeze,this.entity)}},{key:"onAfterUnfreeze",value:function(t){this._runtimeOnThaw=t,this.isFrozen||(this._runtimeOnThaw(),this._runtimeOnThaw=void 0)}},{key:"setExcept",value:function(t,e){this.opts.except={x:t,y:e}}},{key:"canFreezeFrom",value:function(t,e){if(this.opts.except){var n=this.opts.except.x,i=this.opts.except.y;k.Flip.isFlippedX(this.entity),void 0!==n&&k.Flip.isFlippedX(this.entity)&&(n=-n);var r=this.physics.sceneCenterX-t,o=this.physics.sceneCenterY-e;if(Math.abs(r)>Math.abs(o)&&-Math.sign(r)===n||Math.abs(o)>Math.abs(r)&&-Math.sign(o)===i)return this._cancelFreeze()}return!0}},{key:"_cancelFreeze",value:function(){return this.onCancelFreeze.invoke(),!1}},{key:"stayFrozen",value:function(){this.extraFreezeTime+=m.Engine.delta}},{key:"update",value:function(){if(void 0===this.trackedComponents){this.trackedComponents=[],this.physics=this.entity.find(g.Physics);var t=!0,e=!1,n=void 0;try{for(var i,r=S.frozenComponents[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value,a=w.getComponentByName(o),s=this.entity.find(a);s&&this.trackedComponents.push(s)}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}var u=m.Engine.elapsed;this.pushable&&u-this.pushable.lastFloatingTime<.5&&(this.freezeTime+=m.Engine.delta);var l=this.isFrozen,c=void 0;if(this.freezeTimeEnabled){var h=u-this.freezeTime;c=b.Calc.clamp(h<0?0:(this.localTotalFreezeTime-h)/this.localTotalFreezeTime,0,1)}else c=l?.8:0;this.graphic.color.set(1-c,1-c,1,1),l&&!this.frozenLastFrame?this._freeze():!l&&this.frozenLastFrame&&this._unfreeze(),this.frozenLastFrame=l}},{key:"_freeze",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.trackedComponents[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)i.value.active=!1}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}this.physics&&this.physics.stop(),this.pushable=this.entity.add(new k.Pushable({threshold:.2,soundEffectName:"blockPush"})),this.frozenGraphic=this.entity.add(new k.ChildEntity({prefabName:"icecube",relativeDepth:-1})),this.previousDepth=this.entity.depth,this.entity.depth=10,this.onFreezeDelegate.invoke()}},{key:"_unfreeze",value:function(){this.entity.depth=this.previousDepth,this.previousDepth=void 0;var t=!0,e=!1,n=void 0;try{for(var i,r=this.trackedComponents[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)i.value.active=!0}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}this.entity.remove(this.pushable),this.pushable=void 0,this.frozenGraphic.entity.remove(this.frozenGraphic),this.frozenGraphic=void 0,this.onThawDelegate.invoke(),this._runtimeOnThaw&&(this._runtimeOnThaw(),this._runtimeOnThaw=void 0)}},{key:"freeze",value:function(){this.isFrozen?this.shatter():this.freezeTime=m.Engine.elapsed}},{key:"manualUnfreeze",value:function(){return!!this.isFrozen&&(this._unfreeze(),this.freezeTime=1/0,this.frozenLastFrame=!1,!0)}},{key:"shatter",value:function(){var t=b.Vector.temp0.set(this.graphic.sceneCenterX,this.graphic.sceneCenterY);this.scene.add(x.instantiatePrefab("ice_burst"),t),this.scene.remove(this.entity)}},{key:"isFrozen",get:function(){var t=m.Engine.elapsed-this.freezeTime;return t>0&&(!this.freezeTimeEnabled||t<=this.localTotalFreezeTime)}},{key:"localTotalFreezeTime",get:function(){return this.totalFreezeTime+this.extraFreezeTime}}]),Freezable}(E.AutoComponent);Freezable.frozenComponents=["Mover","Sprite","Wonder","Emitter","Facing","Trigger"],v([E.AutoComponent.require,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",_.Graphic)],Freezable.prototype,"graphic",void 0),Freezable=S=v([E.AutoComponent.register],Freezable),e.Freezable=Freezable;var S},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(6),m=n(7),g=n(16),_=n(8);n(13);var ChildEntity=function(t){function ChildEntity(){return(0,o.default)(this,ChildEntity),(0,l.default)(this,(ChildEntity.__proto__||Object.getPrototypeOf(ChildEntity)).apply(this,arguments))}return(0,d.default)(ChildEntity,t),(0,s.default)(ChildEntity,[{key:"setActive",value:function(t){(0,h.default)(ChildEntity.prototype.__proto__||Object.getPrototypeOf(ChildEntity.prototype),"setActive",this).call(this,t),this.child.visible=t}},{key:"addedToScene",value:function(){(0,h.default)(ChildEntity.prototype.__proto__||Object.getPrototypeOf(ChildEntity.prototype),"addedToScene",this).call(this),this.child=this.scene.add(this.opts.prefabName?g.instantiatePrefab(this.opts.prefabName):new v.Entity),void 0!==this.opts.name&&(this.child.name=this.opts.name),this.updatePos()}},{key:"update",value:function(){this.updatePos()}},{key:"updatePos",value:function(){this.getScenePosition(this.child.position),this.child.position.add(m.Vector.temp0.set(this.opts.left||0,this.opts.top||0)),void 0!==this.opts.relativeDepth&&(this.child.depth=this.entity.depth+this.opts.relativeDepth)}},{key:"removedFromScene",value:function(){this.child&&this.scene.remove(this.child),(0,h.default)(ChildEntity.prototype.__proto__||Object.getPrototypeOf(ChildEntity.prototype),"removedFromScene",this).call(this)}}]),ChildEntity}(_.AutoComponent);ChildEntity=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([_.AutoComponent.register],ChildEntity),e.ChildEntity=ChildEntity},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c),f=n(4),d=i(f),p=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var y=n(14),v=n(8);n(13);var Mover=function(t){function Mover(){return(0,o.default)(this,Mover),(0,l.default)(this,(Mover.__proto__||Object.getPrototypeOf(Mover)).apply(this,arguments))}return(0,h.default)(Mover,t),(0,s.default)(Mover,[{key:"update",value:function(){this.physics.speed.set(this.opts.x,this.opts.y)}},{key:"setDelta",value:function(t,e){this.opts.x=t,this.opts.y=e}}]),Mover}(v.AutoComponent);p([v.AutoComponent.require,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",y.Physics)],Mover.prototype,"physics",void 0),Mover=p([v.AutoComponent.register],Mover),e.Mover=Mover},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(8),m=n(9),g=n(7),_=n(54),StaticGraphic=function(t){function StaticGraphic(){return(0,o.default)(this,StaticGraphic),(0,l.default)(this,(StaticGraphic.__proto__||Object.getPrototypeOf(StaticGraphic)).apply(this,arguments))}return(0,d.default)(StaticGraphic,t),(0,s.default)(StaticGraphic,[{key:"addedToScene",value:function(){(0,h.default)(StaticGraphic.prototype.__proto__||Object.getPrototypeOf(StaticGraphic.prototype),"addedToScene",this).call(this);var t="string"==typeof this.opts.texture?_.Assets.atlases.sprites.get(this.opts.texture):this.opts.texture;this.graphic=this.entity.add(new m.Graphic(t,new g.Vector(this.opts.x,this.opts.y)))}}]),StaticGraphic}(v.AutoComponent);StaticGraphic=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([v.AutoComponent.register],StaticGraphic),e.StaticGraphic=StaticGraphic},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u),c=n(2),h=i(c),f=n(5),d=i(f),p=n(3),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(6),m=n(55),g=n(28),_=n(86),b=n(9),w=n(29),x=n(28),k=n(58),E=n(7),O=n(16),S=n(17),T=n(59),C=function(t){function e(){(0,s.default)(this,e);var t=(0,h.default)(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments));return t.buttons=[],t.touches={},t}return(0,y.default)(e,t),(0,l.default)(e,[{key:"addButton",value:function(t,e){this.buttons.push({graphic:t,cb:e})}},{key:"begin",value:function(){(0,d.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"begin",this).call(this),this.rects=new Map,m.TouchInput.touchTarget=this,this._mouseDownFunc=this.onMouseDown.bind(this),this._mouseUpFunc=this.onMouseUp.bind(this),document.addEventListener("mousedown",this._mouseDownFunc),document.addEventListener("mouseup",this._mouseUpFunc)}},{key:"pageToWorld",value:function(t,e){var n=g.Mouse.pageToScreen(t,e),i=(0,o.default)(n,2),r=i[0],a=i[1],s=this.camera.screenToWorld(r,a),u=(0,o.default)(s,2);return[u[0],u[1]]}},{key:"onMouseDown",value:function(t){var e=this.pageToWorld(t.pageX,t.pageY),n=(0,o.default)(e,2),i=n[0],r=n[1];this.handleTouchStart(1e3,i,r)}},{key:"onMouseUp",value:function(t){var e=this.pageToWorld(t.pageX,t.pageY),n=(0,o.default)(e,2),i=n[0],r=n[1];this.handleTouchEnd(1e3,i,r)}},{key:"onTouchStart",value:function(t){for(var e=0;e<t.changedTouches.length;++e){var n=t.changedTouches[e],i=this.pageToWorld(n.pageX,n.pageY),r=(0,o.default)(i,2),a=r[0],s=r[1];this.handleTouchStart(n.identifier,a,s)}}},{key:"onTouchEnd",value:function(t){for(var e=0;e<t.changedTouches.length;++e){var n=t.changedTouches[e],i=this.pageToWorld(n.pageX,n.pageY),r=(0,o.default)(i,2),a=r[0],s=r[1];this.handleTouchEnd(n.identifier,a,s)}}},{key:"dispose",value:function(){m.TouchInput.touchTarget===this&&(m.TouchInput.touchTarget=void 0),document.removeEventListener("mousedown",this._mouseDownFunc),document.removeEventListener("mouseup",this._mouseUpFunc),this._mouseDownFunc=void 0,this._mouseUpFunc=void 0,(0,d.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"dispose",this).call(this)}},{key:"updateWobbles",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.rects.keys()[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value,a=this.rects.get(o),s=a.startRotation,u=a.offset,l=a.speed,c=s+.02*Math.sin((v.Engine.elapsed+u)*l);o.rotation=c}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}},{key:"wobbleRect",value:function(t){return this.rects.set(t,{startRotation:t.rotation,offset:E.Calc.range(100),speed:1+E.Calc.range(.2)}),t}},{key:"addRect",value:function(t,e,n,i,r,o){var a=this._rectEntity;a||(a=this._rectEntity=this.add(new v.Entity));var s=a.add(new b.Rectsprite(n,i,o));return s.position.set(t,e),s.rotation=r,this.wobbleRect(s),s}},{key:"handleTouchStart",value:function(t,e,n){var i=this._hitTestButton(e,n);if(i)return this.touches[t]=i,!0}},{key:"handleTouchEnd",value:function(t,e,n){var i=this._hitTestButton(e,n),r=this.touches[t];if(this.touches[t]=void 0,i&&r&&r.graphic===i.graphic)return i.graphic,(0,i.cb)(),!0}},{key:"handleClick",value:function(t,e){var n=this._hitTestButton(t,e),i=n.graphic,r=n.cb;if(i)return r(),!0}},{key:"_hitTestButton",value:function(t,e){var n=E.Vector.temp4.set(t,e),i=!0,r=!1,o=void 0;try{for(var a,s=this.buttons[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value,l=u.graphic,c=u.cb;if(l&&l.sceneVisible&&l.sceneBounds.containsPoint(n))return{graphic:l,cb:c}}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}}}]),e}(T.EditableScene);e.UIScene=C;var P=function(t){function e(){(0,s.default)(this,e);var t=(0,h.default)(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.sliderEnabled=!1,t._first=!0,t.scene="title",t}return(0,y.default)(e,t),(0,l.default)(e,[{key:"begin",value:function(){var t=this;(0,d.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"begin",this).call(this);var n=(this.add(new v.Entity),new E.Color(0,0,0,.3));this.addRect(-50,0,1e3,70,-.1,n),this.addRect(-50,260,1e3,80,-.1,n);var i=new E.Color(1,1,1,.1);this.addRect(50,50,500,500,-.2,i),this.addRect(200,150,70,65,-.25,i),this.addRect(195,164,53,47,-.35,i);var r=(this.add(O.instantiatePrefab("title")),this.desktopInstructions=this.add(O.instantiatePrefab("desktop_instructions"))),o=S.Game.hasLevelsCompleted?"newgame":"startgame";r.add(new _.StaticGraphic({texture:o,x:45,y:190}));var a=this.mobileInstructions=this.add(new v.Entity);this.addButton(a.add(new _.StaticGraphic({texture:"mobilenewgame",x:50,y:245})).graphic,function(){return t.newGame()}),this.addButton(a.add(new _.StaticGraphic({texture:"mobilecontinue",x:190,y:245})).graphic,function(){return t.nextLevel()}),a.add(new _.StaticGraphic({texture:"mobileinstructions",y:140,x:35})),this.makeNewPlayer(),this.loaded=!0,this.preloadNextLevel()}},{key:"update",value:function(){(0,d.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.updateWobbles();var t=v.Engine.isMobile,n=v.Engine.graphics.canvas,i=n.width,r=n.height;this.camera.origin.set(t&&i>r?90:0,t?r>i?120:-30:0),t?(this.desktopInstructions.visible=!1,this.mobileInstructions.visible=!0):(this.desktopInstructions.visible=!0,this.mobileInstructions.visible=!1),x.Keyboard.pressed(x.Key.enter)?this.nextLevel():x.Keyboard.pressed(x.Key.n)&&this.newGame(),this.player.killed&&this.makeNewPlayer()}},{key:"makeNewPlayer",value:function(){var t=new E.Vector(220,169);this._first?this._first=!1:t.add(E.Vector.temp0.set(E.Calc.range(24)+10,E.Calc.range(24)-10)),this._spawnPlayerAt(t)}},{key:"_spawnPlayerAt",value:function(t){this.player=this.add(new w.Player,t),this.player.find(k.TopDownControls).faceLeft()}}]),e}(C);e.TitleScreen=P},function(t,e,n){"use strict";var i=n(63),r=n(30),o=n(91),a=n(36),s=n(33),u=n(35),l=n(136),c=n(71),h=n(94),f=n(19)("iterator"),d=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,n,y,v,m,g){l(n,e,y);var _,b,w,x=function(t){if(!d&&t in S)return S[t];switch(t){case"keys":case"values":return function(){return new n(this,t)}}return function(){return new n(this,t)}},k=e+" Iterator",E="values"==v,O=!1,S=t.prototype,T=S[f]||S["@@iterator"]||v&&S[v],C=T||x(v),P=v?E?x("entries"):C:void 0,A="Array"==e?S.entries||T:T;if(A&&(w=h(A.call(new t)))!==Object.prototype&&(c(w,k,!0),i||s(w,f)||a(w,f,p)),E&&T&&"values"!==T.name&&(O=!0,C=function(){return T.call(this)}),i&&!g||!d&&!O&&S[f]||a(S,f,C),u[e]=C,u[k]=p,v)if(_={values:E?C:x("values"),keys:m?C:x("keys"),entries:P},g)for(b in _)b in S||o(S,b,_[b]);else r(r.P+r.F*(d||O),e,_);return _}},function(t,e,n){t.exports=!n(32)&&!n(39)(function(){return 7!=Object.defineProperty(n(90)("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var i=n(38),r=n(25).document,o=i(r)&&i(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},function(t,e,n){t.exports=n(36)},function(t,e,n){var i=n(33),r=n(24),o=n(138)(!1),a=n(68)("IE_PROTO");t.exports=function(t,e){var n,s=r(t),u=0,l=[];for(n in s)n!=a&&i(s,n)&&l.push(n);for(;e.length>u;)i(s,n=e[u++])&&(~o(l,n)||l.push(n));return l}},function(t,e,n){var i=n(67),r=Math.min;t.exports=function(t){return t>0?r(i(t),9007199254740991):0}},function(t,e,n){var i=n(33),r=n(72),o=n(68)("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),i(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},function(t,e,n){var i=n(61),r=n(19)("toStringTag"),o="Arguments"==i(function(){return arguments}()),a=function(t,e){try{return t[e]}catch(t){}};t.exports=function(t){var e,n,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=a(e=Object(t),r))?n:o?i(e):"Object"==(s=i(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e,n){var i=n(95),r=n(19)("iterator"),o=n(35);t.exports=n(18).getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||o[i(t)]}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){var i=n(92),r=n(70).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,r)}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"linear",value:function(t){return t}},{key:"quadIn",value:function(t){return t*t}},{key:"quadOut",value:function(e){return 1-t.quadIn(1-e)}},{key:"quadInOut",value:function(e){return e<=.5?t.quadIn(2*e)/2:t.quadOut(2*e-1)/2+.5}},{key:"cubeIn",value:function(t){return t*t*t}},{key:"cubeOut",value:function(e){return 1-t.cubeIn(1-e)}},{key:"cubeInOut",value:function(e){return e<=.5?t.cubeIn(2*e)/2:t.cubeOut(2*e-1)/2+.5}},{key:"backIn",value:function(t){return t*t*(2.70158*t-1.70158)}},{key:"backOut",value:function(e){return 1-t.backIn(1-e)}},{key:"backInOut",value:function(e){return e<=.5?t.backIn(2*e)/2:t.backOut(2*e-1)/2+.5}},{key:"expoIn",value:function(t){return Math.pow(2,10*(t-1))}},{key:"expoOut",value:function(e){return 1-t.expoIn(e)}},{key:"expoInOut",value:function(e){return e<.5?t.expoIn(2*e)/2:t.expoOut(2*e)/2}},{key:"sineIn",value:function(t){return 1-Math.cos(Math.PI/2*t)}},{key:"sineOut",value:function(t){return Math.sin(Math.PI/2*t)}},{key:"sineInOut",value:function(t){return-Math.cos(Math.PI*t)/2+.5}},{key:"elasticInOut",value:function(t){if(2==(t/=.5))return 1;var e=.3*1.5,n=e/4;return t<1?Math.pow(2,10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/e)*-.5:Math.pow(2,-10*(t-=1))*Math.sin((t-n)*(2*Math.PI)/e)*.5+1}},{key:"arc",value:function(t,e){return t<.5?1-e(1-2*t):1-e(2*(t-.5))}}]),t}();e.Ease=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(79),l=function(){function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"volume",value:function(e,n){if(void 0!==n&&t.volumes[e]!==n){t.volumes[e]=n;for(var i=0;i<u.Sound.active.length;i++)u.Sound.active[i].ingroup(e)&&(u.Sound.active[i].volume=u.Sound.active[i].volume)}return void 0!=t.volumes[e]?t.volumes[e]:1}},{key:"muted",value:function(e,n){if(void 0!=n&&t.mutes[e]!=n){t.mutes[e]=n;for(var i=0;i<u.Sound.active.length;i++)u.Sound.active[i].ingroup(e)&&(u.Sound.active[i].muted=u.Sound.active[i].muted)}return void 0!=t.mutes[e]&&t.mutes[e]}}]),t}();l.volumes={},l.mutes={},e.AudioGroup=l},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(10),d=n(20),p=n(22),y=n(15),v=n(43),m=new y.Vector,Hitbox=function(t){function Hitbox(t){var e=t.left,n=t.top,i=t.width,r=t.height,a=t.tags;(0,o.default)(this,Hitbox);var s=(0,l.default)(this,(Hitbox.__proto__||Object.getPrototypeOf(Hitbox)).call(this));if(s.debugColor=new d.Color(1,0,0,.6),s.type=Hitbox.name,s.left=e,s.top=n,s.width=i,s.height=r,void 0!==a){var u=!0,c=!1,h=void 0;try{for(var f,p=a[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var y=f.value;s.tag(y)}}catch(t){c=!0,h=t}finally{try{!u&&p.return&&p.return()}finally{if(c)throw h}}}return s}return(0,h.default)(Hitbox,t),(0,s.default)(Hitbox,[{key:"setTop",value:function(t){var e=this.top+this.height;this.top=t,this.height=e-this.top}},{key:"setLeft",value:function(t){var e=this.left+this.width;this.left=t,this.width=e-this.left}},{key:"getSceneBounds",value:function(t){return t.set(this.sceneLeft,this.sceneTop,this.width,this.height),t}},{key:"debugRender",value:function(){this.debugColor&&this.active&&f.Engine.graphics.hollowRect(this.sceneLeft,this.sceneTop,this.width,this.height,1,this.debugColor)}},{key:"sceneCenterX",get:function(){return this.getScenePosition(m).x+this.left+this.width/2}},{key:"sceneCenterY",get:function(){return this.getScenePosition(m).y+this.top+this.height/2}},{key:"sceneLeft",get:function(){return this.sceneX+this.left}},{key:"sceneRight",get:function(){return this.sceneX+this.left+this.width}},{key:"sceneTop",get:function(){return this.sceneY+this.top}},{key:"sceneBottom",get:function(){return this.sceneY+this.top+this.height}},{key:"sceneBounds",get:function(){return new p.Rectangle(this.sceneLeft,this.sceneTop,this.width,this.height)}}]),Hitbox}(v.Collider);e.Hitbox=Hitbox},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(42),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u),c=n(2),h=i(c),f=n(3),d=i(f);Object.defineProperty(e,"__esModule",{value:!0});var p=(n(10),n(20)),y=n(43),Hitgrid=function(t){function Hitgrid(t,e,n){(0,s.default)(this,Hitgrid);var i=(0,h.default)(this,(Hitgrid.__proto__||Object.getPrototypeOf(Hitgrid)).call(this));if(i.map={},i.debugSub=new p.Color(200,200,200,.5),i.lineColor=new p.Color(1,0,0,.5),i.type=Hitgrid.name,i.tileWidth=t,i.tileHeight=e,void 0!==n){var r=!0,o=!1,a=void 0;try{for(var u,l=n[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=u.value;i.tag(c)}}catch(t){o=!0,a=t}finally{try{!r&&l.return&&l.return()}finally{if(o)throw a}}}return i}return(0,d.default)(Hitgrid,t),(0,l.default)(Hitgrid,[{key:"tiles",value:o.default.mark(function t(){var e,n;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=o.default.keys(this.map);case 1:if((t.t1=t.t0()).done){t.next=13;break}e=t.t1.value,t.t2=o.default.keys(this.map[e]);case 4:if((t.t3=t.t2()).done){t.next=11;break}if(n=t.t3.value,!this.map[e][n]){t.next=9;break}return t.next=9,[parseInt(e,10),parseInt(n,10)];case 9:t.next=4;break;case 11:t.next=1;break;case 13:case"end":return t.stop()}},t,this)})},{key:"set",value:function(t,e,n,i,r){for(var o=e;o<e+(i||1);o++){void 0===this.map[o]&&(this.map[o]={});for(var a=n;a<n+(r||1);a++)t?this.map[o][a]=t:delete this.map[o][a]}}},{key:"has",value:function(t,e,n,i){for(var r=t;r<t+(n||1);r++)if(void 0!==this.map[r])for(var o=e;o<e+(i||1);o++)if(1==this.map[r][o])return!0;return!1}},{key:"debugRender",value:function(t){}}]),Hitgrid}(y.Collider);e.Hitgrid=Hitgrid},function(t,e,n){(function(e){var i=n(104),r=n(105),o=r.join(e,"path.txt");if(!i.existsSync(o))throw Error("Electron failed to install correctly, please delete node_modules/electron and try installing again");t.exports=r.join(e,i.readFileSync(o,"utf-8"))}).call(e,"/")},function(t,e){},function(t,e,n){(function(t){function n(t,e){for(var n=0,i=t.length-1;i>=0;i--){var r=t[i];"."===r?t.splice(i,1):".."===r?(t.splice(i,1),n++):n&&(t.splice(i,1),n--)}if(e)for(;n--;n)t.unshift("..");return t}function i(t,e){if(t.filter)return t.filter(e);for(var n=[],i=0;i<t.length;i++)e(t[i],i,t)&&n.push(t[i]);return n}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return r.exec(t).slice(1)};e.resolve=function(){for(var e="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var a=o>=0?arguments[o]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(e=a+"/"+e,r="/"===a.charAt(0))}return e=n(i(e.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+e||"."},e.normalize=function(t){var r=e.isAbsolute(t),o="/"===a(t,-1);return t=n(i(t.split("/"),function(t){return!!t}),!r).join("/"),t||r||(t="."),t&&o&&(t+="/"),(r?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(i(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,n){function i(t){for(var e=0;e<t.length&&""===t[e];e++);for(var n=t.length-1;n>=0&&""===t[n];n--);return e>n?[]:t.slice(e,n-e+1)}t=e.resolve(t).substr(1),n=e.resolve(n).substr(1);for(var r=i(t.split("/")),o=i(n.split("/")),a=Math.min(r.length,o.length),s=a,u=0;u<a;u++)if(r[u]!==o[u]){s=u;break}for(var l=[],u=s;u<r.length;u++)l.push("..");return l=l.concat(o.slice(s)),l.join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=o(t),n=e[0],i=e[1];return n||i?(i&&(i=i.substr(0,i.length-1)),n+i):"."},e.basename=function(t,e){var n=o(t)[2];return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){return o(t)[3]};var a="b"==="ab".substr(-1)?function(t,e,n){return t.substr(e,n)}:function(t,e,n){return e<0&&(e=t.length+e),t.substr(e,n)}}).call(e,n(77))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(10),l=n(107),c=function(){function t(e,n,i,r,a){(0,o.default)(this,t),this.texture=n,this.frameBuffer=e,this.vertexBuffer=i,this.colorBuffer=r,this.texcoordBuffer=a}return(0,s.default)(t,[{key:"width",get:function(){return this.texture.width}},{key:"height",get:function(){return this.texture.height}}]),(0,s.default)(t,[{key:"dispose",value:function(){this.texture.dispose(),this.texture=null;var t=u.Engine.graphics.gl;t.deleteFramebuffer(this.frameBuffer),t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.texcoordBuffer),t.deleteBuffer(this.colorBuffer),this.frameBuffer=null,this.vertexBuffer=null,this.texcoordBuffer=null,this.colorBuffer=null}}],[{key:"create",value:function(e,n){var i=u.Engine.graphics.gl,r=i.createFramebuffer(),o=i.createTexture();i.bindFramebuffer(i.FRAMEBUFFER,r),i.bindTexture(i.TEXTURE_2D,o),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,n,0,i.RGBA,i.UNSIGNED_BYTE,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,o,0);var a=i.createBuffer(),s=i.createBuffer(),c=i.createBuffer();return i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null),new t(r,new l.FosterWebGLTexture(o,e,n),a,c,s)}}]),t}();e.RenderTarget=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(10),l=function(){function t(e,n,i){(0,o.default)(this,t),this.disposed=!1,this.webGLTexture=e,this.width=n,this.height=i}return(0,s.default)(t,[{key:"dispose",value:function(){this.disposed||(u.Engine.graphics.gl.deleteTexture(this.webGLTexture),this.path="",this.webGLTexture=null,this.width=1,this.height=1,this.disposed=!0)}}]),t}();e.FosterWebGLTexture=l},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}var o=n(0),a=r(o),s=n(1),u=r(s);Object.defineProperty(e,"__esModule",{value:!0});var l=n(10),c=function(){function e(){(0,a.default)(this,e)}return(0,u.default)(e,null,[{key:"init",value:function(){null===e.fs&&l.Engine.client===l.Client.Desktop&&(e.fs=n(104),e.path=n(105))}},{key:"read",value:function(n,r){if(t.env.ELECTRON_WEB||l.Engine.client!==l.Client.Desktop){var o=new XMLHttpRequest;o.onreadystatechange=function(t){if(o.readyState===XMLHttpRequest.DONE){if(200!==o.status)throw Error("Unable to read file "+n);r(o.responseText)}},o.open("GET",n),o.send()}else e.fs.readFile(e.path.join(i,n),"utf8",function(t,e){if(t)throw t;r(e)})}},{key:"normalize",value:function(t){return l.Engine.client===l.Client.Desktop?e.path.normalize(t):t}},{key:"join",value:function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];if(n.length<=0)return".";if(l.Engine.client===l.Client.Desktop){for(var r=n[0],o=1;o<n.length;o++)r=e.path.join(r,n[o]);return e.path.normalize(r)}var a=[],s=!0,u=!1,c=void 0;try{for(var h,f=n[Symbol.iterator]();!(s=(h=f.next()).done);s=!0){var d=h.value,p=d.split("/"),y=!0,v=!1,m=void 0;try{for(var g,_=p[Symbol.iterator]();!(y=(g=_.next()).done);y=!0){var b=g.value;a.push(b)}}catch(t){v=!0,m=t}finally{try{!y&&_.return&&_.return()}finally{if(v)throw m}}}}catch(t){u=!0,c=t}finally{try{!s&&f.return&&f.return()}finally{if(u)throw c}}return a.length>0?a.join("/"):"."}},{key:"extension",value:function(t){var e="",n=/(?:\.([^.]+))?$/.exec(t);return n.length>1&&(e=n[1]),e}}]),e}();c.fs=null,c.path=null,e.FosterIO=c}).call(e,n(77),"/")},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(10),l=n(20),c=function(){function t(){(0,o.default)(this,t),this.sortOrder=0,this.visible=!0,this.target=null,this.clearTargetColor=new l.Color(0,0,0,0),this.scene=null,this.groupsMask=[]}return(0,s.default)(t,[{key:"update",value:function(){}},{key:"preRender",value:function(){}},{key:"render",value:function(){return this.drawBegin(),this.drawEntities()}},{key:"drawBegin",value:function(){null!=this.target?(u.Engine.graphics.setRenderTarget(this.target),u.Engine.graphics.clear(this.clearTargetColor)):u.Engine.graphics.setRenderTarget(u.Engine.graphics.buffer),u.Engine.graphics.shader=this.shader,u.Engine.graphics.shader.set(this.shaderCameraUniformName,this.getActiveCamera().matrix)}},{key:"getEntitiesToRender",value:function(){return this.groupsMask.length>0?this.scene.allInGroups(this.groupsMask):this.scene.entities}},{key:"drawEntities",value:function(){var t=this.getActiveCamera(),e=0;return this.getEntitiesToRender().each(function(n){n.visible&&(n.render(t),++e)}),e}},{key:"getActiveCamera",value:function(){return this.camera||this.scene.camera}},{key:"postRender",value:function(){}},{key:"dispose",value:function(){null!=this.target&&this.target.dispose(),this.target=null}}]),t}();e.Renderer=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(e,n){(0,o.default)(this,t),this.sounds=[],this.path=e,n&&this.sounds.push(n)}return(0,s.default)(t,[{key:"requestSound",value:function(){if(this.sounds.length>0){var e=this.sounds[0];return this.sounds.splice(0,1),e}if(this.sounds.length<t.maxInstances){var n=new Audio;return n.src=this.path,n}return null}},{key:"returnSound",value:function(t){this.sounds.push(t)}},{key:"dispose",value:function(){}}]),t}();u.maxInstances=50,e.AudioSource=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(37),s=i(a),u=n(0),l=i(u),c=n(1),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(22),d=n(53),p=function(){function t(e,n,i,r){(0,l.default)(this,t),this.metadata={},this.subtextures={},this.name=e,this.texture=n,this.reader=r,this.data=i,this.reader(i,this)}return(0,h.default)(t,[{key:"get",value:function(t){var e=this.subtextures[t];if(!e)throw Error("no texture "+t);return e}},{key:"has",value:function(t){return void 0!==this.subtextures[t]}},{key:"list",value:function(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value;n.push(this.get(t+u))}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}},{key:"find",value:function(t){var e=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],[]);for(var n in this.subtextures)0===n.indexOf(t)&&e.push({name:n,tex:this.subtextures[n]});e.sort(function(t,e){return t.name<e.name?-1:t.name>e.name?1:0});var i=[],r=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value.tex;i.push(l)}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}return i}}]),t}();e.Atlas=p;var y=function(){function t(){(0,l.default)(this,t)}return(0,h.default)(t,null,[{key:"DoodleStudio",value:function(t,e){var n=JSON.parse(t),i="once"!==n.playbackMode,r=n.frames,o=0;"loopbackandforth"===n.playbackMode&&r.push.apply(r,(0,s.default)(r.slice(0,r.length-1).reverse()));var a=!0,u=!1,l=void 0;try{for(var c,h=r[Symbol.iterator]();!(a=(c=h.next()).done);a=!0){var p=c.value,y=p.rect,v=new f.Rectangle(y.x,y.y,y.width,y.height),m=new d.Texture(e.texture.texture,v);m.metadata.duration=p.duration,m.metadata.loops=i,e.subtextures["main "+o]=m,++o}}catch(t){u=!0,l=t}finally{try{!a&&h.return&&h.return()}finally{if(u)throw l}}}},{key:"Aseprite",value:function(t,e){var n=JSON.parse(t),i=n.frames,r=!0,a=!1,s=void 0;try{for(var u,l=Object.entries(i)[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=(0,o.default)(u.value,2),h=c[0],p=c[1],y=h.replace(".ase","").replace(".png",""),v=p.frame,m=void 0;if(p.trimmed){var g=p.spriteSourceSize,_=p.sourceSize;m=new d.Texture(e.texture.texture,new f.Rectangle(v.x,v.y,v.w,v.h),new f.Rectangle(-g.x,-g.y,_.w,_.h))}else m=new d.Texture(e.texture.texture,new f.Rectangle(v.x,v.y,v.w,v.h));void 0!==p.duration&&(m.metadata.duration=parseInt(p.duration,10)),e.subtextures[y]=m}}catch(t){a=!0,s=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw s}}e.metadata=n.meta}}]),t}();e.AtlasReaders=y},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(113),l=function(){function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"create",value:function(e){var n=new u.SpriteTemplate(e);return t.bank[e]=n,n}},{key:"get",value:function(e){return t.bank[e]}},{key:"has",value:function(e){return void 0!=t.bank[e]}}]),t}();l.bank={},e.SpriteBank=l},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(22),l=n(114),c=function(){function t(e){(0,o.default)(this,t),this.animations={},this.name=e}return(0,s.default)(t,[{key:"toString",value:function(){return"<SpriteTemplate '"+this.name+"'>"}},{key:"add",value:function(t,e,n,i,r,o){var a=new l.SpriteAnimationTemplate(t,e,n,i,r,o);return this.animations[t]=a,null==this.first&&(this.first=a),this}},{key:"addFrameAnimation",value:function(t,e,n,i,r,o,a,s,c){for(var h=Math.floor(n.width/i),f=[],d=0;d<o.length;d++){var p=o[d],y=p%h*i,v=Math.floor(p/h)*i;f.push(n.getSubtexture(new u.Rectangle(y,v,i,r)))}var m=new l.SpriteAnimationTemplate(t,e,f,a,s,c);return this.animations[t]=m,null==this.first&&(this.first=m),this}},{key:"get",value:function(t){return this.animations[t]}},{key:"has",value:function(t){return void 0!==this.animations[t]}}]),t}();e.SpriteTemplate=c},function(t,e,n){"use strict";var i=n(0),r=function(t){return t&&t.__esModule?t:{default:t}}(i);Object.defineProperty(e,"__esModule",{value:!0});var o=n(15),a=function t(e,n,i,a,s,u){(0,r.default)(this,t),this.loops=!1,this.goto=null,this.name=e,this.speed=n,this.frames=i,this.loops=a||!1,this.position=s||new o.Vector(0,0),this.origin=u||new o.Vector(0,0)};e.SpriteAnimationTemplate=a},function(t,e,n){var i=n(30),r=n(18),o=n(39);t.exports=function(t,e){var n=(r.Object||{})[t]||Object[t],a={};a[t]=e(n),i(i.S+i.F*o(function(){n(1)}),"Object",a)}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(10),d=n(41),p=n(15),y=n(12),Physics=function(t){function Physics(t){var e=t.left,n=t.top,i=t.width,r=t.height,a=t.tags,s=t.solids;(0,o.default)(this,Physics);var u=(0,l.default)(this,(Physics.__proto__||Object.getPrototypeOf(Physics)).call(this,{left:e,top:n,width:i,height:r,tags:a}));return u.solids=[],u.onCollide=[],u.speed=new p.Vector(0,0),u.remainder=new p.Vector(0,0),void 0!==s&&(u.solids=s),u}return(0,h.default)(Physics,t),(0,s.default)(Physics,[{key:"update",value:function(){0!==this.speed.x&&this.moveX(this.speed.x*f.Engine.delta),0!==this.speed.y&&this.moveY(this.speed.y*f.Engine.delta)}},{key:"moveBy",value:function(t){var e=this.moveX(t.x),n=this.moveY(t.y);return e&&n}},{key:"move",value:function(t,e){var n=this.moveX(t),i=this.moveY(e);return n&&i}},{key:"moveX",value:function(t){var e=t+this.remainder.x;return this.remainder.x=e%1,e-=this.remainder.x,this.moveXAbsolute(e)}},{key:"moveXAbsolute",value:function(t){var e=this.entity;if(this.solids.length<=0)e.x+=Math.round(t);else{var n=d.Calc.sign(t);for(t=Math.abs(Math.round(t));t>0;){var i=this.collides(this.solids,n,0),r=!(!i||!i.entity)&&i.entity===e;if(null!=i&&!r){this.remainder.x=0,null!=this.onCollideX&&this.onCollideX(i);var o=!0,a=!1,s=void 0;try{for(var u,l=this.onCollide[Symbol.iterator]();!(o=(u=l.next()).done);o=!0)(0,u.value)(!0,i)}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return!1}e.x+=n,t-=1}}return!0}},{key:"moveY",value:function(t){var e=t+this.remainder.y;return this.remainder.y=e%1,e-=this.remainder.y,this.moveYAbsolute(e)}},{key:"moveYAbsolute",value:function(t){var e=this.entity;if(this.solids.length<=0)e.y+=Math.round(t);else{var n=d.Calc.sign(t);for(t=Math.abs(Math.round(t));t>0;){var i=this.collides(this.solids,0,n),r=!(!i||!i.entity)&&i.entity===e;if(null!=i&&!r){this.remainder.y=0,null!=this.onCollideY&&this.onCollideY(i);var o=!0,a=!1,s=void 0;try{for(var u,l=this.onCollide[Symbol.iterator]();!(o=(u=l.next()).done);o=!0)(0,u.value)(!1,i)}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}return!1}e.y+=n,t-=1}}return!0}},{key:"friction",value:function(t,e){return this.speed.x<0?this.speed.x=Math.min(0,this.speed.x+t*f.Engine.delta):this.speed.x>0&&(this.speed.x=Math.max(0,this.speed.x-t*f.Engine.delta)),this.speed.y<0?this.speed.y=Math.min(0,this.speed.y+e*f.Engine.delta):this.speed.y>0&&(this.speed.y=Math.max(0,this.speed.y-e*f.Engine.delta)),this}},{key:"maxspeed",value:function(t,e){return void 0!==t&&null!==t&&(this.speed.x=Math.max(-t,Math.min(t,this.speed.x))),void 0!==e&&null!==e&&(this.speed.y=Math.max(-e,Math.min(e,this.speed.y))),this}},{key:"circularMaxspeed",value:function(t){return this.speed.length>t&&this.speed.normalize().scale(t),this}},{key:"stop",value:function(){this.speed.x=this.speed.y=0,this.remainder.x=this.remainder.y=0}}]),Physics}(y.Hitbox);e.Physics=Physics},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(27),d=n(10),p=n(20),y=n(22),v=n(15),Graphic=function(t){function Graphic(t,e){(0,o.default)(this,Graphic);var n=(0,l.default)(this,(Graphic.__proto__||Object.getPrototypeOf(Graphic)).call(this));return n.scale=new v.Vector(1,1),n.origin=new v.Vector(0,0),n.rotation=0,n.flipX=!1,n.flipY=!1,n.color=p.Color.white.clone(),n.alpha=1,null!=t&&(n.texture=t,n.crop=new y.Rectangle(0,0,t.width,t.height)),e&&n.position.copy(e),n}return(0,h.default)(Graphic,t),(0,s.default)(Graphic,[{key:"toString",value:function(){return"<Graphic "+this.texture.bounds+" of "+this.texture.texture.path+">"}},{key:"center",value:function(){this.justify(.5,.5)}},{key:"justify",value:function(t,e){this.origin.set(this.width*t,this.height*e)}},{key:"render",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;d.Engine.graphics.texture(this.texture,this.scenePosition.x,this.scenePosition.y,this.crop,p.Color.temp.copy(this.color).mult(this.alpha),this.origin,this.scale,this.rotation,this.flipX,this.flipY,this.texture.bounds.width,this.texture.bounds.height,e)}},{key:"width",get:function(){return this.crop?this.crop.width:this.texture?this.texture.width:0}},{key:"height",get:function(){return this.crop?this.crop.height:this.texture?this.texture.height:0}},{key:"sceneBounds",get:function(){return new y.Rectangle(this.sceneX,this.sceneY,this.width,this.height)}},{key:"sceneCenterX",get:function(){return this.getScenePosition(Graphic.sp).x+this.width/2},set:function(t){this.position.x=t-(this.entity?this.entity.x:0)-this.width/2}},{key:"sceneCenterY",get:function(){return this.getScenePosition(Graphic.sp).y+this.height/2},set:function(t){this.position.y=t-(this.entity?this.entity.y:0)-this.height/2}}]),Graphic}(f.Component);Graphic.sp=new v.Vector,e.Graphic=Graphic},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var n,i,r,o,a,s,l;return u.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:n=e.scenePosition,i=Math.floor((t.sceneLeft-n.x)/e.tileWidth),r=Math.floor((t.sceneTop-n.y)/e.tileHeight),o=Math.ceil((t.sceneRight-n.x)/e.tileWidth),a=Math.ceil((t.sceneBottom-n.y)/e.tileHeight),s=i;case 6:if(!(s<o)){u.next=18;break}l=r;case 8:if(!(l<a)){u.next=15;break}if(!e.has(s,l)){u.next=12;break}return u.next=12,new S.Hitbox({left:s*e.tileWidth+n.x,width:e.tileWidth,top:l*e.tileHeight+n.y,height:e.tileHeight});case 12:l++,u.next=8;break;case 15:s++,u.next=6;break;case 18:case"end":return u.stop()}},k[0],this)}function o(t,e){var n=[],i=!0,o=!1,a=void 0;try{for(var s,u=e[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(l instanceof S.Hitgrid){var c=!0,h=!1,f=void 0;try{for(var d,p=r(t,l)[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var y=d.value;n.push(y)}}catch(t){h=!0,f=t}finally{try{!c&&p.return&&p.return()}finally{if(h)throw f}}}else n.push(l)}}catch(t){o=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(o)throw a}}return n}function a(t,e){switch(t){case"left":e.sort(function(t,e){return-O.Calc.cmp(t.sceneRight,e.sceneRight)});break;case"right":e.sort(function(t,e){return O.Calc.cmp(t.sceneLeft,e.sceneLeft)});break;case"up":e.sort(function(t,e){return-O.Calc.cmp(t.sceneBottom,e.sceneBottom)});break;case"down":e.sort(function(t,e){return O.Calc.cmp(t.sceneTop,e.sceneTop)});break;default:throw Error(t)}return e}var s=n(42),u=i(s),l=n(11),c=i(l),h=n(0),f=i(h),d=n(1),p=i(d),y=n(2),v=i(y),m=n(5),g=i(m),_=n(3),b=i(_),w=n(4),x=i(w),k=[r].map(u.default.mark);Object.defineProperty(e,"__esModule",{value:!0});var E=n(8),O=n(7),S=n(12);n(13);var T=["player","enemy_solid","solid","mimic_orb"],Awareness=function(t){function Awareness(){(0,f.default)(this,Awareness);var t=(0,v.default)(this,(Awareness.__proto__||Object.getPrototypeOf(Awareness)).apply(this,arguments));return t.xrayGroups=[],t.lookingFor="player",t.killing=[],t.wouldKill=!1,t.sightboxes={},t.killboxes={},t}return(0,b.default)(Awareness,t),(0,p.default)(Awareness,[{key:"update",value:function(){var t=this;this.killing.length=0,this.wouldKill=!1;var e=!0,n=!1,i=void 0;try{for(var r,s=Object.entries(this.killboxes)[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var u=(0,c.default)(r.value,2),l=u[0],h=u[1],f=l,d=a(f,o(h,h.collideAllMulti(T).filter(function(e){return e.entity!==t.entity})));if(d.length>0){var p=d[0];if(p.entity&&-1!==p.entity.groups.indexOf(this.lookingFor)){this.killing.push([p,f]),this.wouldKill=!0;break}var y=!0,v=!1,m=void 0;try{for(var g,_=d[Symbol.iterator]();!(y=(g=_.next()).done);y=!0){var b=g.value;b.entity&&-1!==b.entity.groups.indexOf(this.lookingFor)&&(this.wouldKill=!0)}}catch(t){v=!0,m=t}finally{try{!y&&_.return&&_.return()}finally{if(v)throw m}}}}}catch(t){n=!0,i=t}finally{try{!e&&s.return&&s.return()}finally{if(n)throw i}}this.xrayGroups.length=0;var w=!0,x=!1,k=void 0;try{for(var E,O=Object.entries(this.sightboxes)[Symbol.iterator]();!(w=(E=O.next()).done);w=!0){var S=(0,c.default)(E.value,2),h=(S[0],S[1]),C=!0,P=!1,A=void 0;try{for(var R,M=h.collideAllMulti(T)[Symbol.iterator]();!(C=(R=M.next()).done);C=!0){var j=R.value,L=!0,F=!1,D=void 0;try{for(var B,N=j.entity.groups[Symbol.iterator]();!(L=(B=N.next()).done);L=!0){var I=B.value;this.xrayGroups.push(I)}}catch(t){F=!0,D=t}finally{try{!L&&N.return&&N.return()}finally{if(F)throw D}}}}catch(t){P=!0,A=t}finally{try{!C&&M.return&&M.return()}finally{if(P)throw A}}}}catch(t){x=!0,k=t}finally{try{!w&&O.return&&O.return()}finally{if(x)throw k}}}},{key:"addedToScene",value:function(){function t(t,n){t.down=d.add(new S.Hitbox({left:u-n/2+h/2,top:o,width:n,height:e})),t.up=d.add(new S.Hitbox({left:u-n/2+h/2,top:o-e,width:n,height:e})),t.left=d.add(new S.Hitbox({left:r-e,top:s-n/2+f/2,width:e,height:n})),t.right=d.add(new S.Hitbox({left:u,top:s-n/2+f/2,width:e,height:n}))}(0,g.default)(Awareness.prototype.__proto__||Object.getPrototypeOf(Awareness.prototype),"addedToScene",this).call(this),this.mainHitbox=this.entity.find(S.Hitbox);var e=330,n=this.getLookCenter(),i=(0,c.default)(n,2),r=i[0],o=i[1],a=[this.mainHitbox.top,this.mainHitbox.left],s=a[0],u=a[1],l=[this.mainHitbox.width,this.mainHitbox.height],h=l[0],f=l[1],d=this.entity;t(this.sightboxes,34),t(this.killboxes,4)}},{key:"getLookCenter",value:function(){var t=this.mainHitbox;return[t.left+t.width/2,t.top+t.height/2]}}]),Awareness}(E.AutoComponent);Awareness=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,x.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([E.AutoComponent.register],Awareness),e.Awareness=Awareness},function(t,e,n){"use strict";var i=n(0),r=function(t){return t&&t.__esModule?t:{default:t}}(i);Object.defineProperty(e,"__esModule",{value:!0});var o=function t(){(0,r.default)(this,t)};e.Particle=o},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(20),l=n(99),c=function(){function t(e){(0,o.default)(this,t),this.texture=null,this.speedBase=0,this.speedRange=0,this.accelBaseX=0,this.accelRangeX=0,this.accelBaseY=0,this.accelRangeY=0,this.frictionBaseX=0,this.frictionRangeX=0,this.frictionBaseY=0,this.frictionRangeY=0,this.colorsFrom=[u.Color.white],this.colorsTo=[u.Color.white],this.colorEaser=l.Ease.linear,this.alphaFromBase=1,this.alphaFromRange=0,this.alphaToBase=1,this.alphaToRange=0,this.alphaEaser=l.Ease.linear,this.rotationFromBase=0,this.rotationFromRange=0,this.rotationToBase=0,this.rotationToRange=0,this.rotationEaser=l.Ease.linear,this.scaleFromBaseX=1,this.scaleFromRangeX=0,this.scaleToBaseX=1,this.scaleToRangeX=0,this.scaleXEaser=l.Ease.linear,this.scaleFromBaseY=1,this.scaleFromRangeY=0,this.scaleToBaseY=1,this.scaleToRangeY=0,this.scaleYEaser=l.Ease.linear,this.durationBase=1,this.durationRange=1,this.name=e,t.templates[e]=this}return(0,s.default)(t,[{key:"tex",value:function(t){return this.texture=t,this}},{key:"speed",value:function(t,e){return this.speedBase=t,this.speedRange=e||0,this}},{key:"accelX",value:function(t,e){return this.accelBaseX=t,this.accelRangeX=e||0,this}},{key:"accelY",value:function(t,e){return this.accelBaseY=t,this.accelRangeY=e||0,this}},{key:"frictionX",value:function(t,e){return this.frictionBaseX=t,this.frictionRangeX=e||0,this}},{key:"frictionY",value:function(t,e){return this.frictionBaseY=t,this.frictionRangeY=e||0,this}},{key:"colors",value:function(t,e){return this.colorsFrom=t,this.colorsTo=e||t,this}},{key:"colorEase",value:function(t){return this.colorEaser=t,this}},{key:"alpha",value:function(t,e){return this.alphaFrom(t,e),this.alphaTo(t,e),this}},{key:"alphaFrom",value:function(t,e){return this.alphaFromBase=t,this.alphaFromRange=e||0,this}},{key:"alphaTo",value:function(t,e){return this.alphaToBase=t,this.alphaToRange=e||0,this}},{key:"alphaEase",value:function(t){return this.alphaEaser=t,this}},{key:"rotation",value:function(t,e){return this.rotationFrom(t,e),this.rotationTo(t,e),this}},{key:"rotationFrom",value:function(t,e){return this.rotationFromBase=t,this.rotationFromRange=e||0,this}},{key:"rotationTo",value:function(t,e){return this.rotationToBase=t,this.rotationToRange=e||0,this}},{key:"rotationEase",value:function(t){return this.rotationEaser=t,this}},{key:"scale",value:function(t,e){return this.scaleFrom(t,e),this.scaleTo(t,e),this}},{key:"scaleFrom",value:function(t,e){return this.scaleFromX(t,e),this.scaleFromY(t,e),this}},{key:"scaleTo",value:function(t,e){return this.scaleToX(t,e),this.scaleToY(t,e),this}},{key:"scaleEase",value:function(t){return this.scaleXEaser=t,this.scaleYEaser=t,this}},{key:"scaleX",value:function(t,e){return this.scaleFromX(t,e),this.scaleToX(t,e),this}},{key:"scaleFromX",value:function(t,e){return this.scaleFromBaseX=t,this.scaleFromRangeX=e||0,this}},{key:"scaleToX",value:function(t,e){return this.scaleToBaseX=t,this.scaleToRangeX=e||0,this}},{key:"scaleY",value:function(t,e){return this.scaleFromY(t,e),this.scaleToY(t,e),this}},{key:"scaleXEase",value:function(t){return this.scaleXEaser=t,this}},{key:"scaleFromY",value:function(t,e){return this.scaleFromBaseY=t,this.scaleFromRangeY=e||0,this}},{key:"scaleToY",value:function(t,e){return this.scaleToBaseY=t,this.scaleToRangeY=e||0,this}},{key:"scaleYEase",value:function(t){return this.scaleYEaser=t,this}},{key:"duration",value:function(t,e){return this.durationBase=t,this.durationRange=e||0,this}}]),t}();c.templates={},e.ParticleTemplate=c},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(14),m=n(7),g=n(12),_=n(17),b=n(83),w=n(16),x=n(57),k=n(8),CausesDamage=function(t){function CausesDamage(){(0,o.default)(this,CausesDamage);var t=(0,l.default)(this,(CausesDamage.__proto__||Object.getPrototypeOf(CausesDamage)).apply(this,arguments));return t.amount=1,t}return(0,d.default)(CausesDamage,t),(0,s.default)(CausesDamage,[{key:"addedToScene",value:function(){var t=this;(0,h.default)(CausesDamage.prototype.__proto__||Object.getPrototypeOf(CausesDamage.prototype),"addedToScene",this).call(this),this.hitbox=this.entity.find(g.Hitbox);var e=this.entity.find(v.Physics);e&&e.onCollide.push(function(e,n){return t.damageCollider(n)})}},{key:"damageCollider",value:function(t){var e=!1;if(this.opts.unfreezes){var n=t.entity.find(b.Freezable);n&&n.isFrozen&&(n.manualUnfreeze(),e=!0)}if(!e){var i=t.entity.find(x.Health);if(!i)return;i.tryApplyDamage(this)}if(this.opts.damageParticles){var r=this.hitbox.getSceneBounds(m.Rectangle.temp0).getCenter(m.Vector.temp0);this.scene.add(w.instantiatePrefab(this.opts.damageParticles,null,r.x,r.y))}this.opts.diesOnCollision&&this.entity.destroyLater()}},{key:"update",value:function(){(0,h.default)(CausesDamage.prototype.__proto__||Object.getPrototypeOf(CausesDamage.prototype),"update",this).call(this);var t=!0,e=!1,n=void 0;try{for(var i,r=this.hitbox.collideAllMulti([_.Game.TAGS.PLAYER,_.Game.TAGS.ENEMY_SOLID])[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;this.damageCollider(o)}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}}]),CausesDamage}(k.AutoComponent);CausesDamage=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([k.AutoComponent.register],CausesDamage),e.CausesDamage=CausesDamage},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c),f=n(4),d=i(f);Object.defineProperty(e,"__esModule",{value:!0});var p=n(8),y=n(12),v=n(84),m=n(9),Flip=g=function(t){function Flip(){(0,o.default)(this,Flip);var t=(0,l.default)(this,(Flip.__proto__||Object.getPrototypeOf(Flip)).apply(this,arguments));return t.flipX=!1,t}return(0,h.default)(Flip,t),(0,s.default)(Flip,[{key:"addedToScene",value:function(){var t=this,e=this.entity.getComponentByName(this.opts.bodyName),n=e.x+e.width/2,i=(e.y,e.height,["solid","enemy_solid"]);if(0!==e.collideAllMulti(i,-24,0).filter(function(e){return e.entity!==t.entity}).length){this.flipX=!0;var r=!0,o=!1,a=void 0;try{for(var s,u=this.entity.findAll(m.Sprite)[Symbol.iterator]();!(r=(s=u.next()).done);r=!0)s.value.flipX=!0}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}var l=!0,c=!1,h=void 0;try{for(var f,d=this.entity.findAll(y.Hitbox)[Symbol.iterator]();!(l=(f=d.next()).done);l=!0){var p=f.value;p!==e&&(p.left+=p.width+2*n-(p.left+p.width))}}catch(t){c=!0,h=t}finally{try{!l&&d.return&&d.return()}finally{if(c)throw h}}var g=!0,_=!1,b=void 0;try{for(var w,x=this.entity.findAll(v.ChildEntity)[Symbol.iterator]();!(g=(w=x.next()).done);g=!0){var k=w.value,E=!0,O=!1,S=void 0;try{for(var T,C=k.child.findAll(m.Sprite)[Symbol.iterator]();!(E=(T=C.next()).done);E=!0){var P=T.value;P.flipX=!P.flipX,P.x+=P.width+2*n-(P.x+P.width)}}catch(t){O=!0,S=t}finally{try{!E&&C.return&&C.return()}finally{if(O)throw S}}}}catch(t){_=!0,b=t}finally{try{!g&&x.return&&x.return()}finally{if(_)throw b}}}}}],[{key:"isFlippedX",value:function(t){var e=t.find(g);return e&&e.flipX}}]),Flip}(p.AutoComponent);Flip=g=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([p.AutoComponent.register],Flip),e.Flip=Flip;var g},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(8),m=n(9),g=n(7),Shadow=function(t){function Shadow(){return(0,o.default)(this,Shadow),(0,l.default)(this,(Shadow.__proto__||Object.getPrototypeOf(Shadow)).apply(this,arguments))}return(0,d.default)(Shadow,t),(0,s.default)(Shadow,[{key:"addedToScene",value:function(){if((0,h.default)(Shadow.prototype.__proto__||Object.getPrototypeOf(Shadow.prototype),"addedToScene",this).call(this),this.level){var t=void 0;if(this.opts.graphicName&&(t=this.entity.getComponentByName(this.opts.graphicName)),t=t||this.entity.find(m.Graphic)){var e=t.y+t.height-23,n=this.level.getShadow(0),i=this.graphic=this.entity.add(new m.Graphic(n,g.Vector.temp0.set(0,3)));i.y=e;var r=this.opts.offset?this.opts.offset:g.Vector.zero,o=r.x,a=r.y;void 0!==o&&(i.x+=o),void 0!==a&&(i.y+=a),i.alpha=void 0===this.opts.alpha?.6:this.opts.alpha}}}},{key:"removedFromEntity",value:function(){(0,h.default)(Shadow.prototype.__proto__||Object.getPrototypeOf(Shadow.prototype),"removedFromEntity",this).call(this),this.entity.remove(this.graphic)}}]),Shadow}(v.AutoComponent);Shadow=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([v.AutoComponent.register],Shadow),e.Shadow=Shadow},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},m=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var g=n(14),_=n(7),b=n(9),w=n(12),x=n(16),k=n(8),E=n(29),O=n(21);n(13);var Pickup=S=function(t){function Pickup(){(0,o.default)(this,Pickup);var t=(0,l.default)(this,(Pickup.__proto__||Object.getPrototypeOf(Pickup)).apply(this,arguments));return t.pickedUp=!1,t}return(0,d.default)(Pickup,t),(0,s.default)(Pickup,[{key:"didPickup",value:function(t){}},{key:"addedToScene",value:function(){(0,h.default)(Pickup.prototype.__proto__||Object.getPrototypeOf(Pickup.prototype),"addedToScene",this).call(this),this.onPickup=new O.EventDelegate(this.opts.onPickup,this.entity)}},{key:"fadeAway",value:function(){S.fadeOutAllGraphicsAndRemoveEntity(this.entity)}},{key:"update",value:function(){var t=this.hitbox.collide("player",0,0);if(t&&t.entity instanceof E.Player){this.active=!1,this.didPickup(t.entity);var e=_.Vector.temp0.set(this.graphic.sceneCenterX,this.graphic.sceneCenterY),n=this.opts.burstName||"pickup_burst";this.entity.scene.add(x.instantiatePrefab(n),e),this.onPickup.hasCallbacks?this.onPickup.invoke():this.fadeAway()}}}],[{key:"fadeOutAllGraphicsAndRemoveEntity",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,n=t.findAll(b.Graphic),i=n.map(function(t){return t.alpha}),r=g.Tween.create(t).start(e,1,0,_.Ease.linear,function(t){for(var e=0;e<n.length;++e)n[e].alpha=t*i[e]},!0);r.setOnComplete(function(){return t.scene.remove(t)}),r.restart()}}]),Pickup}(k.AutoComponent);v([k.AutoComponent.require,m("design:type",b.Graphic)],Pickup.prototype,"graphic",void 0),v([k.AutoComponent.require,m("design:type",w.Hitbox)],Pickup.prototype,"hitbox",void 0),Pickup=S=v([k.AutoComponent.register],Pickup),e.Pickup=Pickup;var S},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){t.top=-1e3,t.left=-1e3,t.width=0,t.height=0}function o(t){if(!t||"object"!==(void 0===t?"undefined":(0,s.default)(t)))return t;if(Array.isArray(t))return t.map(o);var e={};return Object.keys(t).forEach(function(n){e[n]=o(t[n])}),e}var a=n(4),s=i(a),u=n(11),l=i(u),c=n(0),h=i(c),f=n(1),d=i(f),p=n(2),y=i(p),v=n(5),m=i(v),g=n(3),_=i(g);Object.defineProperty(e,"__esModule",{value:!0});var b=n(12),w=n(7),x=n(6),k=n(59),E=n(9),HitgridWithHoles=function(t){function HitgridWithHoles(){(0,h.default)(this,HitgridWithHoles);var t=(0,y.default)(this,(HitgridWithHoles.__proto__||Object.getPrototypeOf(HitgridWithHoles)).apply(this,arguments));return t.lastFrameObjs=[],t.thisFrameObjs=[],t.colors=[new w.Color(1,0,1,1),new w.Color(0,1,0,1),new w.Color(0,0,1,1),new w.Color(1,1,0,1)],t.splits={},t}return(0,_.default)(HitgridWithHoles,t),(0,d.default)(HitgridWithHoles,[{key:"addedToScene",value:function(){var t=this;(0,m.default)(HitgridWithHoles.prototype.__proto__||Object.getPrototypeOf(HitgridWithHoles.prototype),"addedToScene",this).call(this),this.originalCopy=new b.Hitgrid(this.tileWidth,this.tileHeight),this.originalCopy.map=o(this.map),this.scene.earlyUpdate.push(function(){return t.earlyUpdate()})}},{key:"copy",value:function(t){this.tileWidth=t.tileWidth,this.tileHeight=t.tileHeight,this.type=t.type,this.map=o(t.map)}},{key:"trackObject",value:function(t){this.thisFrameObjs.push(t),t.untag("solid"),t.untag("enemy_solid"),t.solids=t.solids.filter(function(t){return"player"!==t})}},{key:"earlyUpdate",value:function(){this.thisFrameObjs.length=0}},{key:"makeHitboxes",value:function(t,e){if(HitgridWithHoles.pool.length>=t){var n=HitgridWithHoles.pool.splice(0,t),i=!0,r=!1,o=void 0;try{for(var a,s=n[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value;u.left=e.x,u.top=e.y,u.width=e.width,u.height=e.height}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return n}for(var l=[],c=0;c<t;++c){var h=this.entity.add(new b.Hitbox({left:e.x,top:e.y,width:e.width,height:e.height,tags:this.tags}));h.debugColor=this.colors[c],l.push(h)}return l}},{key:"returnHitboxes",value:function(t){var e=!0,n=!1,i=void 0;try{for(var o,a=t[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var s=o.value;r(s),HitgridWithHoles.pool.push(s)}}catch(t){n=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"lateUpdate",value:function(){var t=[],e=!0,n=!1,i=void 0;try{for(var r,a=this.lastFrameObjs[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;-1===this.thisFrameObjs.indexOf(s)&&t.push(s)}}catch(t){n=!0,i=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw i}}var u=[],c=!0,h=!1,f=void 0;try{for(var d,p=this.thisFrameObjs[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var y=d.value;-1===this.lastFrameObjs.indexOf(y)&&u.push(y)}}catch(t){h=!0,f=t}finally{try{!c&&p.return&&p.return()}finally{if(h)throw f}}this.map=o(this.originalCopy.map);var v=!0,m=!1,g=void 0;try{for(var _,b=Object.entries(this.splits)[Symbol.iterator]();!(v=(_=b.next()).done);v=!0){var w=(0,l.default)(_.value,2),x=(w[0],w[1]);this.returnHitboxes(x)}}catch(t){m=!0,g=t}finally{try{!v&&b.return&&b.return()}finally{if(m)throw g}}this.splits={};var k=!0,E=!1,O=void 0;try{for(var S,T=this.thisFrameObjs[Symbol.iterator]();!(k=(S=T.next()).done);k=!0){var C=S.value;this.carve(C.sceneBounds)}}catch(t){E=!0,O=t}finally{try{!k&&T.return&&T.return()}finally{if(E)throw O}}var P=this.scene.firstColliderInTag("player"),A=this.tags[0];if(P&&P.check(A))for(var R=0;R<3;++R){if(!P.check(A,0,-R)){P.move(0,-R);break}if(!P.check(A,0,R)){P.move(0,R);break}if(!P.check(A,R,0)){P.move(R,0);break}if(!P.check(A,-R,0)){P.move(-R,0);break}}}},{key:"carve",value:function(t){window.hg=this;var e=this.scenePosition,n=this.tileWidth,i=this.tileHeight,r=!0,o=!1,a=void 0;try{for(var s,u=this.tiles()[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var c=(0,l.default)(s.value,2),h=c[0],f=c[1],d=new w.Rectangle(e.x+h*n,e.y+f*i,n,i);if(d.intersectsRect(t)){t.set(t.centerX-n/2,t.centerY-i/2,n,i);var p=h+"_"+f,y=void 0;this.splits[p]?y=this.splits[p]:(y=this.splits[p]=this.makeHitboxes(4,d),this.set(!1,h,f)),y[0].width=Math.min(d.right,t.left)-d.left,y[1].height=Math.min(d.bottom,t.top)-d.top,y[2].setTop(Math.min(d.bottom,t.bottom)),y[3].setLeft(Math.min(d.right,t.right)),y[0].active=y[0].width>0&&y[0].height>0,y[1].active=y[1].width>0&&y[1].height>0,y[2].active=y[2].width>1&&y[2].height>1,y[3].active=y[3].width>1&&y[3].height>1}}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"worldToMap",value:function(t){var e=this.scenePosition;t.x=Math.floor((t.x-e.x)/this.tileWidth),t.y=Math.floor((t.y-e.y)/this.tileHeight)}}]),HitgridWithHoles}(b.Hitgrid);HitgridWithHoles.pool=[],e.HitgridWithHoles=HitgridWithHoles;var O=function(t){function e(){return(0,h.default)(this,e),(0,y.default)(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return(0,_.default)(e,t),(0,d.default)(e,[{key:"begin",value:function(){(0,m.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"begin",this).call(this),this.camera.origin.set(x.Engine.width/2,x.Engine.height/2);var t=this.add(new x.Entity);t.name="test terrain";for(var n=t.add(new HitgridWithHoles(24,24,["water_solid"])),i=0;i<5;++i)for(var r=0;r<5;++r)n.set(!0,r,i);this.add(new x.Entity).add(new E.Sprite({animation:"guy"}))}}]),e}(k.EditableScene);e.HitgridHolesTestScene=O},function(t,e,n){"use strict";function i(t){}Object.defineProperty(e,"__esModule",{value:!0}),n(229),e.editJSON=i},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},m=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var g=n(6),_=n(14),b=n(7);n(13);var Wonder=function(t){function Wonder(t){var e=t.speed;(0,o.default)(this,Wonder);var n=(0,l.default)(this,(Wonder.__proto__||Object.getPrototypeOf(Wonder)).call(this));return n.speed=15,n.speed=e,n}return(0,d.default)(Wonder,t),(0,s.default)(Wonder,[{key:"addedToScene",value:function(){(0,h.default)(Wonder.prototype.__proto__||Object.getPrototypeOf(Wonder.prototype),"addedToScene",this).call(this),this.dir="right"}},{key:"onCollide",value:function(t){t.entity!==this.entity&&("right"===this.dir?this.dir="up":"left"===this.dir?this.dir="down":"down"===this.dir?this.dir="right":"up"===this.dir&&(this.dir="left"))}},{key:"update",value:function(){var t=this;(0,h.default)(Wonder.prototype.__proto__||Object.getPrototypeOf(Wonder.prototype),"update",this).call(this),this.physics.onCollideX=function(e){t.onCollide(e)},this.physics.onCollideY=function(e){t.onCollide(e)};var e=b.Vector[this.dir];this.physics.speed.set(this.speed*e.x,this.speed*e.y)}}]),Wonder}(g.Component);v([g.Component.require,m("design:type",_.Physics)],Wonder.prototype,"physics",void 0),Wonder=v([g.Component.register,m("design:paramtypes",[Object])],Wonder),e.Wonder=Wonder},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(17);n(126),i.Game.start()},function(t,e,n){t.exports={default:n(130),__esModule:!0}},function(t,e,n){n(60),n(49),t.exports=n(142)},function(t,e,n){"use strict";var i=n(132),r=n(133),o=n(35),a=n(24);t.exports=n(88)(Array,"Array",function(t,e){this._t=a(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,r(1)):"keys"==e?r(0,n):"values"==e?r(0,t[n]):r(0,[n,t[n]])},"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries")},function(t,e){t.exports=function(){}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,n){var i=n(61);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){"use strict";var i=n(66),r=n(40),o=n(71),a={};n(36)(a,n(19)("iterator"),function(){return this}),t.exports=function(t,e,n){t.prototype=i(a,{next:r(1,n)}),o(t,e+" Iterator")}},function(t,e,n){var i=n(26),r=n(31),o=n(47);t.exports=n(32)?Object.defineProperties:function(t,e){r(t);for(var n,a=o(e),s=a.length,u=0;s>u;)i.f(t,n=a[u++],e[n]);return t}},function(t,e,n){var i=n(24),r=n(93),o=n(139);t.exports=function(t){return function(e,n,a){var s,u=i(e),l=r(u.length),c=o(a,l);if(t&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((t||c in u)&&u[c]===n)return t||c||0;return!t&&-1}}},function(t,e,n){var i=n(67),r=Math.max,o=Math.min;t.exports=function(t,e){return t=i(t),t<0?r(t+e,0):o(t,e)}},function(t,e,n){t.exports=n(25).document&&document.documentElement},function(t,e,n){var i=n(67),r=n(62);t.exports=function(t){return function(e,n){var o,a,s=r(e)+"",u=i(n),l=s.length;return u<0||u>=l?t?"":void 0:(o=s.charCodeAt(u),o<55296||o>56319||u+1===l||(a=s.charCodeAt(u+1))<56320||a>57343?t?s.charAt(u):o:t?s.slice(u,u+2):a-56320+(o-55296<<10)+65536)}}},function(t,e,n){var i=n(95),r=n(19)("iterator"),o=n(35);t.exports=n(18).isIterable=function(t){var e=Object(t);return void 0!==e[r]||"@@iterator"in e||o.hasOwnProperty(i(e))}},function(t,e,n){t.exports={default:n(144),__esModule:!0}},function(t,e,n){n(60),n(49),t.exports=n(145)},function(t,e,n){var i=n(31),r=n(96);t.exports=n(18).getIterator=function(t){var e=r(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return i(e.call(t))}},function(t,e,n){t.exports={default:n(147),__esModule:!0}},function(t,e,n){n(148);var i=n(18).Object;t.exports=function(t,e,n){return i.defineProperty(t,e,n)}},function(t,e,n){var i=n(30);i(i.S+i.F*!n(32),"Object",{defineProperty:n(26).f})},function(t,e,n){t.exports={default:n(150),__esModule:!0}},function(t,e,n){n(49),n(60),t.exports=n(73).f("iterator")},function(t,e,n){t.exports={default:n(152),__esModule:!0}},function(t,e,n){n(153),n(159),n(160),n(161),t.exports=n(18).Symbol},function(t,e,n){"use strict";var i=n(25),r=n(33),o=n(32),a=n(30),s=n(91),u=n(154).KEY,l=n(39),c=n(69),h=n(71),f=n(48),d=n(19),p=n(73),y=n(74),v=n(155),m=n(156),g=n(157),_=n(31),b=n(24),w=n(65),x=n(40),k=n(66),E=n(158),O=n(76),S=n(26),T=n(47),C=O.f,P=S.f,A=E.f,R=i.Symbol,M=i.JSON,j=M&&M.stringify,L=d("_hidden"),F=d("toPrimitive"),D={}.propertyIsEnumerable,B=c("symbol-registry"),N=c("symbols"),I=c("op-symbols"),G=Object.prototype,U="function"==typeof R,V=i.QObject,H=!V||!V.prototype||!V.prototype.findChild,X=o&&l(function(){return 7!=k(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(t,e,n){var i=C(G,e);i&&delete G[e],P(t,e,n),i&&t!==G&&P(G,e,i)}:P,z=function(t){var e=N[t]=k(R.prototype);return e._k=t,e},Y=U&&"symbol"==typeof R.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof R},W=function(t,e,n){return t===G&&W(I,e,n),_(t),e=w(e,!0),_(n),r(N,e)?(n.enumerable?(r(t,L)&&t[L][e]&&(t[L][e]=!1),n=k(n,{enumerable:x(0,!1)})):(r(t,L)||P(t,L,x(1,{})),t[L][e]=!0),X(t,e,n)):P(t,e,n)},K=function(t,e){_(t);for(var n,i=m(e=b(e)),r=0,o=i.length;o>r;)W(t,n=i[r++],e[n]);return t},q=function(t,e){return void 0===e?k(t):K(k(t),e)},J=function(t){var e=D.call(this,t=w(t,!0));return!(this===G&&r(N,t)&&!r(I,t))&&(!(e||!r(this,t)||!r(N,t)||r(this,L)&&this[L][t])||e)},Q=function(t,e){if(t=b(t),e=w(e,!0),t!==G||!r(N,e)||r(I,e)){var n=C(t,e);return!n||!r(N,e)||r(t,L)&&t[L][e]||(n.enumerable=!0),n}},Z=function(t){for(var e,n=A(b(t)),i=[],o=0;n.length>o;)r(N,e=n[o++])||e==L||e==u||i.push(e);return i},$=function(t){for(var e,n=t===G,i=A(n?I:b(t)),o=[],a=0;i.length>a;)!r(N,e=i[a++])||n&&!r(G,e)||o.push(N[e]);return o};U||(R=function(){if(this instanceof R)throw TypeError("Symbol is not a constructor!");var t=f(arguments.length>0?arguments[0]:void 0),e=function(n){this===G&&e.call(I,n),r(this,L)&&r(this[L],t)&&(this[L][t]=!1),X(this,t,x(1,n))};return o&&H&&X(G,t,{configurable:!0,set:e}),z(t)},s(R.prototype,"toString",function(){return this._k}),O.f=Q,S.f=W,n(98).f=E.f=Z,n(75).f=J,n(97).f=$,o&&!n(63)&&s(G,"propertyIsEnumerable",J,!0),p.f=function(t){return z(d(t))}),a(a.G+a.W+a.F*!U,{Symbol:R});for(var tt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;tt.length>et;)d(tt[et++]);for(var tt=T(d.store),et=0;tt.length>et;)y(tt[et++]);a(a.S+a.F*!U,"Symbol",{for:function(t){return r(B,t+="")?B[t]:B[t]=R(t)},keyFor:function(t){if(Y(t))return v(B,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){H=!0},useSimple:function(){H=!1}}),a(a.S+a.F*!U,"Object",{create:q,defineProperty:W,defineProperties:K,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:$}),M&&a(a.S+a.F*(!U||l(function(){var t=R();return"[null]"!=j([t])||"{}"!=j({a:t})||"{}"!=j(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!Y(t)){for(var e,n,i=[t],r=1;arguments.length>r;)i.push(arguments[r++]);return e=i[1],"function"==typeof e&&(n=e),!n&&g(e)||(e=function(t,e){if(n&&(e=n.call(this,t,e)),!Y(e))return e}),i[1]=e,j.apply(M,i)}}}),R.prototype[F]||n(36)(R.prototype,F,R.prototype.valueOf),h(R,"Symbol"),h(Math,"Math",!0),h(i.JSON,"JSON",!0)},function(t,e,n){var i=n(48)("meta"),r=n(38),o=n(33),a=n(26).f,s=0,u=Object.isExtensible||function(){return!0},l=!n(39)(function(){return u(Object.preventExtensions({}))}),c=function(t){a(t,i,{value:{i:"O"+ ++s,w:{}}})},h=function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,i)){if(!u(t))return"F";if(!e)return"E";c(t)}return t[i].i},f=function(t,e){if(!o(t,i)){if(!u(t))return!0;if(!e)return!1;c(t)}return t[i].w},d=function(t){return l&&p.NEED&&u(t)&&!o(t,i)&&c(t),t},p=t.exports={KEY:i,NEED:!1,fastKey:h,getWeak:f,onFreeze:d}},function(t,e,n){var i=n(47),r=n(24);t.exports=function(t,e){for(var n,o=r(t),a=i(o),s=a.length,u=0;s>u;)if(o[n=a[u++]]===e)return n}},function(t,e,n){var i=n(47),r=n(97),o=n(75);t.exports=function(t){var e=i(t),n=r.f;if(n)for(var a,s=n(t),u=o.f,l=0;s.length>l;)u.call(t,a=s[l++])&&e.push(a);return e}},function(t,e,n){var i=n(61);t.exports=Array.isArray||function(t){return"Array"==i(t)}},function(t,e,n){var i=n(24),r=n(98).f,o={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(t){try{return r(t)}catch(t){return a.slice()}};t.exports.f=function(t){return a&&"[object Window]"==o.call(t)?s(t):r(i(t))}},function(t,e){},function(t,e,n){n(74)("asyncIterator")},function(t,e,n){n(74)("observable")},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(10),l=n(80),c=n(22),h=n(51),f=n(15),d=function(){function t(){(0,o.default)(this,t),this.position=new f.Vector(0,0),this.origin=new f.Vector(0,0),this.scale=new f.Vector(1,1),this.rotation=0,this._matrix=new h.Matrix,this._internal=new h.Matrix,this._mouse=new f.Vector,this._worldMouse=new f.Vector,this.extentsA=new f.Vector,this.extentsB=new f.Vector,this.extentsC=new f.Vector,this.extentsD=new f.Vector,this.extentsRect=new c.Rectangle}return(0,s.default)(t,[{key:"screenToWorld",value:function(t,e){var n=f.Vector.temp4.set(t,e).transform(this.internal.invert());return[n.x,n.y]}},{key:"getExtents",value:function(){var t=this.internal.invert();this.extentsA.set(0,0).transform(t),this.extentsB.set(u.Engine.width,0).transform(t),this.extentsC.set(0,u.Engine.height).transform(t),this.extentsD.set(u.Engine.width,u.Engine.height).transform(t)}},{key:"x",get:function(){return this.position.x},set:function(t){this.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.position.y=t}},{key:"internal",get:function(){return this._internal.identity().translate(this.origin.x,this.origin.y).rotate(this.rotation).scale(this.scale.x,this.scale.y).translate(-this.position.x,-this.position.y)}},{key:"matrix",get:function(){return this._matrix.copy(u.Engine.graphics.orthographic).multiply(this.internal)}},{key:"mouse",get:function(){return this._mouse.set(l.Mouse.x+this.position.x-this.origin.x,l.Mouse.y+this.position.y-this.origin.y).transform(this.internal.invert())}},{key:"worldMouse",get:function(){var t=this.extents;return this._worldMouse.copy(l.Mouse.position).add(f.Vector.temp0.set(t.x,t.y))}},{key:"extents",get:function(){this.getExtents();var t=this.extentsRect;return t.x=Math.min(this.extentsA.x,this.extentsB.x,this.extentsC.x,this.extentsD.x),t.y=Math.min(this.extentsA.y,this.extentsB.y,this.extentsC.y,this.extentsD.y),t.width=Math.max(this.extentsA.x,this.extentsB.x,this.extentsC.x,this.extentsD.x)-t.x,t.height=Math.max(this.extentsA.y,this.extentsB.y,this.extentsC.y,this.extentsD.y)-t.y,t}}]),t}();e.Camera=d},function(t,e,n){t.exports={default:n(164),__esModule:!0}},function(t,e,n){n(49),n(165),t.exports=n(18).Array.from},function(t,e,n){"use strict";var i=n(64),r=n(30),o=n(72),a=n(166),s=n(167),u=n(93),l=n(168),c=n(96);r(r.S+r.F*!n(169)(function(t){Array.from(t)}),"Array",{from:function(t){var e,n,r,h,f=o(t),d="function"==typeof this?this:Array,p=arguments.length,y=p>1?arguments[1]:void 0,v=void 0!==y,m=0,g=c(f);if(v&&(y=i(y,p>2?arguments[2]:void 0,2)),void 0==g||d==Array&&s(g))for(e=u(f.length),n=new d(e);e>m;m++)l(n,m,v?y(f[m],m):f[m]);else for(h=g.call(f),n=new d;!(r=h.next()).done;m++)l(n,m,v?a(h,y,[r.value,m],!0):r.value);return n.length=m,n}})},function(t,e,n){var i=n(31);t.exports=function(t,e,n,r){try{return r?e(i(n)[0],n[1]):e(n)}catch(e){var o=t.return;throw void 0!==o&&i(o.call(t)),e}}},function(t,e,n){var i=n(35),r=n(19)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(i.Array===t||o[r]===t)}},function(t,e,n){"use strict";var i=n(26),r=n(40);t.exports=function(t,e,n){e in t?i.f(t,e,r(0,n)):t[e]=n}},function(t,e,n){var i=n(19)("iterator"),r=!1;try{var o=[7][i]();o.return=function(){r=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var n=!1;try{var o=[7],a=o[i]();a.next=function(){return{done:n=!0}},o[i]=function(){return a},t(o)}catch(t){}return n}},function(t,e,n){(function(e){var i="object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this,r=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,o=r&&i.regeneratorRuntime;if(i.regeneratorRuntime=void 0,t.exports=n(171),r)i.regeneratorRuntime=o;else try{delete i.regeneratorRuntime}catch(t){i.regeneratorRuntime=void 0}}).call(e,n(78))},function(t,e,n){(function(e){!function(e){"use strict";function n(t,e,n,i){var o=e&&e.prototype instanceof r?e:r,a=Object.create(o.prototype),s=new d(i||[]);return a._invoke=l(t,n,s),a}function i(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function r(){}function o(){}function a(){}function s(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function u(t){function n(e,r,o,a){var s=i(t[e],t,r);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&g.call(l,"__await")?Promise.resolve(l.__await).then(function(t){n("next",t,o,a)},function(t){n("throw",t,o,a)}):Promise.resolve(l).then(function(t){u.value=t,o(u)},a)}a(s.arg)}function r(t,e){function i(){return new Promise(function(i,r){n(t,e,i,r)})}return o=o?o.then(i,i):i()}"object"==typeof e.process&&e.process.domain&&(n=e.process.domain.bind(n));var o;this._invoke=r}function l(t,e,n){var r=O;return function(o,a){if(r===T)throw Error("Generator is already running");if(r===C){if("throw"===o)throw a;return y()}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var u=c(s,n);if(u){if(u===P)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===O)throw r=C,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=T;var l=i(t,e,n);if("normal"===l.type){if(r=n.done?C:S,l.arg===P)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=C,n.method="throw",n.arg=l.arg)}}}function c(t,e){var n=t.iterator[e.method];if(n===v){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=v,c(t,e),"throw"===e.method))return P;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return P}var r=i(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,P;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=v),e.delegate=null,P):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,P)}function h(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function f(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function d(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function p(t){if(t){var e=t[b];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(g.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=v,e.done=!0,e};return i.next=i}}return{next:y}}function y(){return{value:v,done:!0}}var v,m=Object.prototype,g=m.hasOwnProperty,_="function"==typeof Symbol?Symbol:{},b=_.iterator||"@@iterator",w=_.asyncIterator||"@@asyncIterator",x=_.toStringTag||"@@toStringTag",k="object"==typeof t,E=e.regeneratorRuntime;if(E)return void(k&&(t.exports=E));E=e.regeneratorRuntime=k?t.exports:{},E.wrap=n;var O="suspendedStart",S="suspendedYield",T="executing",C="completed",P={},A={};A[b]=function(){return this};var R=Object.getPrototypeOf,M=R&&R(R(p([])));M&&M!==m&&g.call(M,b)&&(A=M);var j=a.prototype=r.prototype=Object.create(A);o.prototype=j.constructor=a,a.constructor=o,a[x]=o.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,x in t||(t[x]="GeneratorFunction")),t.prototype=Object.create(j),t},E.awrap=function(t){return{__await:t}},s(u.prototype),u.prototype[w]=function(){return this},E.AsyncIterator=u,E.async=function(t,e,i,r){var o=new u(n(t,e,i,r));return E.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},s(j),j[x]="Generator",j[b]=function(){return this},j.toString=function(){return"[object Generator]"},E.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var i=e.pop();if(i in t)return n.value=i,n.done=!1,n}return n.done=!0,n}},E.values=p,d.prototype={constructor:d,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(f),!t)for(var e in this)"t"===e.charAt(0)&&g.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,i){return o.type="throw",o.arg=t,n.next=e,i&&(n.method="next",n.arg=v),!!i}if(this.done)throw t;for(var n=this,i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],o=r.completion;if("root"===r.tryLoc)return e("end");if(r.tryLoc<=this.prev){var a=g.call(r,"catchLoc"),s=g.call(r,"finallyLoc");if(a&&s){if(this.prev<r.catchLoc)return e(r.catchLoc,!0);if(this.prev<r.finallyLoc)return e(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return e(r.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return e(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&g.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,P):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),P},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),f(n),P}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var r=i.arg;f(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:p(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=v),P}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,n(78))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){(0,s.default)(this,t),this.objects=[],this._count=0,this._iterating=!1,this._moveAfters=[]}return(0,l.default)(t,[{key:"add",value:function(t){return this.objects.push(t),this._count++,this.unsorted=!0,t}},{key:"contains",value:function(t){return null!=t&&this.objects.indexOf(t)>=0}},{key:"first",value:function(){for(var t=null,e=0;e<this.objects.length&&null==t;e++)t=this.objects[e];return t}},{key:"map",value:function(t){for(var e=this.objects.length,n=[],i=0;i<e;++i)n.push(t(this.objects[i]));return n}},{key:"each",value:function(t){var e=this.objects.length;this._iterating=!0;for(var n=0;n<e&&(null==this.objects[n]||!1!==t(this.objects[n]));n++);if(this._iterating=!1,this._moveAfters.length>0){var i=!0,r=!1,a=void 0;try{for(var s,u=this._moveAfters[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=(0,o.default)(s.value,2),c=l[0],h=l[1];this.remove(c)&&this.objects.splice(h,0,c)}}catch(t){r=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(r)throw a}}this._moveAfters=[],this.dirty=!0,this.clean()}}},{key:"moveAfter",value:function(t,e){this._iterating?this._moveAfters.push([t,e]):this.remove(t)&&this.objects.splice(e,0,t)}},{key:"at",value:function(t){for(var e=t;e<this.objects.length;e++)if(null!=this.objects[e])return this.objects[e];return null}},{key:"sort",value:function(t){if(this.unsorted){for(var e=0;e<this.objects.length-1;++e)for(var n=e+1;n>0&&null!=this.objects[n-1]&&null!=this.objects[n]&&t(this.objects[n-1],this.objects[n])>0;){var i=this.objects[n-1];this.objects[n-1]=this.objects[n],this.objects[n--]=i}this.unsorted=!1}}},{key:"remove",value:function(t){var e=this.objects.indexOf(t);return e>=0&&(this.objects[e]=null,this._count--,this.dirty=!0,!0)}},{key:"clear",value:function(){for(var t=0;t<this.objects.length;t++)this.objects[t]=null;this._count=0,this.dirty=!0}},{key:"clean",value:function(){if(this.dirty)if(this.count<=0)this.objects=[];else for(var t=this.objects.length-1;t>=0;t--)null==this.objects[t]&&this.objects.splice(t,1)}},{key:"count",get:function(){return this._count}}]),t}();e.ObjectList=c},function(t,e,n){"use strict";function i(){function t(t,e){return t.sceneRight>e.sceneLeft&&t.sceneBottom>e.sceneTop&&t.sceneLeft<e.sceneRight&&t.sceneTop<e.sceneBottom}function e(t,e){for(var n=e.sceneX,i=e.sceneY,r=Math.floor((t.sceneLeft-n)/e.tileWidth),o=Math.floor((t.sceneTop-i)/e.tileHeight),a=Math.ceil((t.sceneRight-n)/e.tileWidth),s=Math.ceil((t.sceneBottom-i)/e.tileHeight),u=r;u<a;u++)for(var l=o;l<s;l++)if(e.has(u,l))return!0;return!1}r.Collider.registerOverlapTest(o.Hitbox,o.Hitbox,t),r.Collider.registerOverlapTest(o.Hitbox,a.Hitgrid,e)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(43),o=n(101),a=n(102);e.registerDefaultOverlapTests=i},function(t,e,n){t.exports={default:n(175),__esModule:!0}},function(t,e,n){n(176),t.exports=n(18).Object.setPrototypeOf},function(t,e,n){var i=n(30);i(i.S,"Object",{setPrototypeOf:n(177).set})},function(t,e,n){var i=n(38),r=n(31),o=function(t,e){if(r(t),!i(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,i){try{i=n(64)(Function.call,n(76).f(Object.prototype,"__proto__").set,2),i(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,n){return o(t,n),e?t.__proto__=n:i(t,n),t}}({},!1):void 0),check:o}},function(t,e,n){t.exports={default:n(179),__esModule:!0}},function(t,e,n){n(180);var i=n(18).Object;t.exports=function(t,e){return i.create(t,e)}},function(t,e,n){var i=n(30);i(i.S,"Object",{create:n(66)})},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(10),l=n(80),c=n(15),h=function(){function t(){if((0,o.default)(this,t),u.Engine.client===u.Client.Desktop){var e=n(103).remote;t.browserWindow=e.getCurrentWindow(),t.screen=e.screen}}return(0,s.default)(t,null,[{key:"resize",value:function(e,n){u.Engine.client===u.Client.Desktop&&t.browserWindow.setContentSize(e,n)}},{key:"center",value:function(){u.Engine.client===u.Client.Desktop&&t.browserWindow.center()}},{key:"toggleDevTools",value:function(){u.Engine.client===u.Client.Desktop&&t.browserWindow.toggleDevTools()}},{key:"title",get:function(){return t.titleName},set:function(e){t.titleName=e,u.Engine.client===u.Client.Desktop?t.browserWindow.setTitle(e):document.title=e}},{key:"fullscreen",get:function(){return u.Engine.client===u.Client.Desktop&&t.browserWindow.isFullScreen()},set:function(e){u.Engine.client===u.Client.Desktop&&t.browserWindow.setFullScreen(e)}},{key:"screenLeft",get:function(){return u.Engine.client===u.Client.Desktop?t.browserWindow.getPosition()[0]:u.Engine.graphics.canvas.getBoundingClientRect().left}},{key:"screenTop",get:function(){return u.Engine.client===u.Client.Desktop?t.browserWindow.getPosition()[1]:u.Engine.graphics.canvas.getBoundingClientRect().top}},{key:"screenWidth",get:function(){return u.Engine.client===u.Client.Desktop?t.browserWindow.getContentSize()[0]:u.Engine.graphics.canvas.getBoundingClientRect().width}},{key:"screenHeight",get:function(){return u.Engine.client===u.Client.Desktop?t.browserWindow.getContentSize()[1]:u.Engine.graphics.canvas.getBoundingClientRect().height}},{key:"screenMouse",get:function(){if(u.Engine.client===u.Client.Desktop){var e=t.screen.getCursorScreenPoint();return new c.Vector(e.x,e.y)}return l.Mouse.absolute}}]),t}();e.GameWindow=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(1),o=i(r),a=n(0),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u,l=n(106),c=n(53),h=n(10),f=n(20),d=n(51),p=n(22),y=n(81),v=n(52),m=n(15);!function(t){t[t.None=0]="None",t[t.Exact=1]="Exact",t[t.Contain=2]="Contain",t[t.ContainInteger=3]="ContainInteger",t[t.Fill=4]="Fill",t[t.FillInteger=5]="FillInteger"}(u=e.ResolutionStyle||(e.ResolutionStyle={}));var g=function t(e,n){(0,s.default)(this,t),this.source=e,this.dest=n};e.BlendMode=g;var _=function t(){(0,s.default)(this,t)};e.BlendModes=_;var b=function(){function t(e){(0,s.default)(this,t),this.resolutionStyle=u.Contain,this.borderColor=f.Color.black.clone(),this.clearColor=new f.Color(0,0,0,1),this.vertices=[],this.texcoords=[],this.colors=[],this.currentTarget=null,this.currentShader=null,this.nextShader=null,this.currentBlendmode=null,this.nextBlendmode=null,this.orthographic=new d.Matrix,this.toscreen=new d.Matrix,this._pixel=null,this._pixelUVs=[new m.Vector(0,0),new m.Vector(1,0),new m.Vector(1,1),new m.Vector(0,1)],this._defaultPixel=null,this.drawCalls=0,this.depthTestEnabled=!1,this._lastDepthTestEnabled=-1,this._texts=[],this.topleft=new m.Vector,this.topright=new m.Vector,this.botleft=new m.Vector,this.botright=new m.Vector,this.texToDraw=new c.Texture(null,new p.Rectangle,new p.Rectangle),this.engine=e,this.canvas=document.createElement("canvas"),this.gl=this.canvas.getContext("experimental-webgl",{alpha:!1,antialias:!1}),t._initCanvas(this.canvas),this.gl.enable(this.gl.BLEND),this._updateStateFlags(),this.gl.disable(this.gl.CULL_FACE),this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),_.normal=new g(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),_.add=new g(this.gl.ONE,this.gl.DST_ALPHA),_.multiply=new g(this.gl.DST_COLOR,this.gl.ONE_MINUS_SRC_ALPHA),_.screen=new g(this.gl.ONE,this.gl.ONE_MINUS_SRC_COLOR),this.currentBlendmode=_.normal,this.vertexBuffer=this.gl.createBuffer(),this.texcoordBuffer=this.gl.createBuffer(),this.colorBuffer=this.gl.createBuffer()}return(0,o.default)(t,[{key:"_updateStateFlags",value:function(){this._lastDepthTestEnabled!==this.depthTestEnabled&&(this._lastDepthTestEnabled=this.depthTestEnabled),this.glSetEnabled(this.gl.DEPTH_TEST,this.depthTestEnabled),this.depthTestEnabled?(this.gl.depthFunc(this.gl.LESS),this.gl.disable(this.gl.BLEND)):this.gl.enable(this.gl.BLEND)}},{key:"glSetEnabled",value:function(t,e){e?this.gl.enable(t):this.gl.disable(t)}},{key:"load",value:function(){this.pixel=this._defaultPixel=c.Texture.createFromData([1,1,1,1],1,1)}},{key:"unload",value:function(){this._defaultPixel.dispose(),this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.colorBuffer),this.gl.deleteBuffer(this.texcoordBuffer),this.buffer.dispose(),this.buffer=null,this.canvas.remove(),this.canvas=null}},{key:"resize",value:function(){null!=this.buffer&&this.buffer.dispose(),this.buffer=l.RenderTarget.create(h.Engine.width,h.Engine.height),this.orthographic.identity().translate(-1,1).scale(1/this.buffer.width*2,-1/this.buffer.height*2)}},{key:"update",value:function(){t.checkCanvasSize(this.canvas),this.textCanvas&&t.checkCanvasSize(this.textCanvas)}},{key:"getOutputBounds",value:function(){var t=1,e=1;this.resolutionStyle===u.Exact?(t=this.canvas.width/this.buffer.width,e=this.canvas.height/this.buffer.height):this.resolutionStyle===u.Contain?t=e=Math.min(this.canvas.width/this.buffer.width,this.canvas.height/this.buffer.height):this.resolutionStyle===u.ContainInteger?t=e=Math.floor(Math.min(this.canvas.width/this.buffer.width,this.canvas.height/this.buffer.height)):this.resolutionStyle===u.Fill?t=e=Math.max(this.canvas.width/this.buffer.width,this.canvas.height/this.buffer.height):this.resolutionStyle===u.FillInteger&&(t=e=Math.ceil(Math.max(this.canvas.width/this.buffer.width,this.canvas.height/this.buffer.height)));var n=this.buffer.width*t,i=this.buffer.height*e;return new p.Rectangle((this.canvas.width-n)/2,(this.canvas.height-i)/2,n,i)}},{key:"clear",value:function(t){this.textContext&&this.textContext.clearRect(0,0,this.textContext.canvas.width,this.textContext.canvas.height),this.gl.clearColor(t.r,t.g,t.b,t.a),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}},{key:"fillText",value:function(t,e,n,i){}},{key:"reset",value:function(){this.drawCalls=0,this.currentShader=null,this.nextShader=null,this.vertices=[],this.colors=[],this.texcoords=[],this.setRenderTarget(this.buffer),this.clear(this.clearColor),this._updateStateFlags()}},{key:"setRenderTarget",value:function(t){this.currentTarget!=t&&(this.flush(),null==t?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.canvas.width,this.canvas.height)):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.frameBuffer),this.gl.viewport(0,0,t.width,t.height)),this.currentTarget=t)}},{key:"setShaderTexture",value:function(t){h.Engine.assert(null!=this.shader.sampler2d,"This shader has no Sampler2D to set the texture to")&&(this.shader.sampler2d.value=t.texture.webGLTexture)}},{key:"checkState",value:function(){if(null!=this.nextShader||this.currentShader.dirty||null!=this.nextBlendmode){null!=this.currentShader&&this.flush();var t=null!=this.nextShader;if(t){if(null!=this.currentShader)for(var e=0;e<this.currentShader.attributes.length;e++)this.gl.disableVertexAttribArray(this.currentShader.attributes[e].attribute);this.currentShader=this.nextShader,this.nextShader=null,this.gl.useProgram(this.currentShader.program);for(var n=0;n<this.currentShader.attributes.length;n++)this.gl.enableVertexAttribArray(this.currentShader.attributes[n].attribute)}null!=this.nextBlendmode&&(this.currentBlendmode=this.nextBlendmode,this.nextBlendmode=null,this.gl.blendFunc(this.currentBlendmode.source,this.currentBlendmode.dest));var i=0,r=!0,o=!1,a=void 0;try{for(var s,u=this.currentShader.uniforms[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var h=s.value;if(t||h.dirty){var f=h.uniform;h.type===y.ShaderUniformType.sampler2D?(this.gl.activeTexture(this.gl["TEXTURE"+i]),h.value instanceof c.Texture?this.gl.bindTexture(this.gl.TEXTURE_2D,h.value.texture.webGLTexture):h.value instanceof l.RenderTarget?this.gl.bindTexture(this.gl.TEXTURE_2D,h.value.texture.webGLTexture):this.gl.bindTexture(this.gl.TEXTURE_2D,h.value),this.gl.uniform1i(f,i),i+=1):y.setGLUniformValue[h.type](this.gl,h.uniform,h.value),h.dirty=!1}}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}this.currentShader.dirty=!1}}},{key:"flush",value:function(){if(0!==this.vertices.length){var t=!0,e=!1,n=void 0;try{for(var i,r=this.currentShader.attributes[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;if(o.type===y.ShaderAttributeType.Position){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null==this.currentTarget?this.vertexBuffer:this.currentTarget.vertexBuffer);var a=new Float32Array(this.vertices);this.gl.bufferData(this.gl.ARRAY_BUFFER,a,this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(o.attribute,3,this.gl.FLOAT,!1,0,0)}else o.type===y.ShaderAttributeType.Texcoord?(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null==this.currentTarget?this.texcoordBuffer:this.currentTarget.texcoordBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texcoords),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(o.attribute,2,this.gl.FLOAT,!1,0,0)):o.type===y.ShaderAttributeType.Color&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null==this.currentTarget?this.colorBuffer:this.currentTarget.colorBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.colors),this.gl.STATIC_DRAW),this.gl.vertexAttribPointer(o.attribute,4,this.gl.FLOAT,!1,0,0))}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices.length/3),this.drawCalls++,this.vertices=[],this.texcoords=[],this.colors=[]}}},{key:"finalize",value:function(){this.setRenderTarget(null),this.clear(this.borderColor),this.toscreen.identity().translate(-1,-1).scale(1/this.canvas.width*2,1/this.canvas.height*2),this.shader=v.Shaders.texture,this.shader.sampler2d.value=this.buffer.texture.webGLTexture,this.shader.set("matrix",this.toscreen);var t=this.getOutputBounds();this.push(t.left,t.top,0,0,f.Color.white),this.pushUnsafe(t.right,t.top,1,0,f.Color.white),this.pushUnsafe(t.right,t.bottom,1,1,f.Color.white),this.pushUnsafe(t.left,t.top,0,0,f.Color.white),this.pushUnsafe(t.right,t.bottom,1,1,f.Color.white),this.pushUnsafe(t.left,t.bottom,0,1,f.Color.white),this.flush()}},{key:"push",value:function(t,e,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.checkState(),this.vertices.push(t,e,o),this.texcoords.push(n,i),void 0!==r&&null!==r&&this.colors.push(r.r,r.g,r.b,r.a)}},{key:"pushUnsafe",value:function(t,e,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.vertices.push(t,e,o),this.texcoords.push(n,i),void 0!==r&&null!==r&&this.colors.push(r.r,r.g,r.b,r.a)}},{key:"pushList",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.checkState();for(var r=0;r<t.length;r++)if(this.vertices.push(t[r].x,t[r].y,i),void 0!==e&&null!==e&&this.texcoords.push(e[r].x,e[r].y),void 0!==n&&null!==n){var o=n[r];this.colors.push(o.r,o.g,o.b,o.a)}}},{key:"texture",value:function(t,e,n,i,r,o,a,s,u,l,c,h){var d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0;this.setShaderTexture(t);var p=null;p=void 0===i||null===i?t:t.getSubtexture(i,this.texToDraw);var y=-p.frame.x,v=-p.frame.y;if(void 0===c&&(c=p.bounds.width),void 0===h&&(h=p.bounds.height),this.topleft.set(y,v),this.topright.set(y+c,v),this.botleft.set(y,v+h),this.botright.set(y+c,v+h),!o||0===o.x&&0===o.y||(this.topleft.sub(o),this.topright.sub(o),this.botleft.sub(o),this.botright.sub(o)),!a||1===a.x&&1===a.y||(this.topleft.mult(a),this.topright.mult(a),this.botleft.mult(a),this.botright.mult(a)),s&&0!==s){var m=Math.sin(s),g=Math.cos(s);this.topleft.rotate(m,g),this.topright.rotate(m,g),this.botleft.rotate(m,g),this.botright.rotate(m,g)}var _=p.bounds.x/p.texture.width,b=p.bounds.y/p.texture.height,w=_+c/p.texture.width,x=b+h/p.texture.height;if(u){var k=_;_=w,w=k}if(l){var E=b;b=x,x=E}var O=r||f.Color.white;this.push(e+this.topleft.x,n+this.topleft.y,_,b,O,d),this.pushUnsafe(e+this.topright.x,n+this.topright.y,w,b,O,d),this.pushUnsafe(e+this.botright.x,n+this.botright.y,w,x,O,d),this.pushUnsafe(e+this.topleft.x,n+this.topleft.y,_,b,O,d),this.pushUnsafe(e+this.botright.x,n+this.botright.y,w,x,O,d),this.pushUnsafe(e+this.botleft.x,n+this.botleft.y,_,x,O,d)}},{key:"quad",value:function(t,e,n,i,r,o,a,s){if(this.topleft.set(0,0),this.topright.set(0+n,0),this.botleft.set(0,0+i),this.botright.set(0+n,0+i),!o||0===o.x&&0===o.y||(this.topleft.sub(o),this.topright.sub(o),this.botleft.sub(o),this.botright.sub(o)),!a||1===a.x&&1===a.y||(this.topleft.mult(a),this.topright.mult(a),this.botleft.mult(a),this.botright.mult(a)),s&&0!==s){var u=Math.sin(s),l=Math.cos(s);this.topleft.rotate(u,l),this.topright.rotate(u,l),this.botleft.rotate(u,l),this.botright.rotate(u,l)}r||f.Color.white,this.push(t+this.topleft.x,e+this.topleft.y,0,0,r),this.pushUnsafe(t+this.topright.x,e+this.topright.y,0,0,r),this.pushUnsafe(t+this.botright.x,e+this.botright.y,0,0,r),this.pushUnsafe(t+this.topleft.x,e+this.topleft.y,0,0,r),this.pushUnsafe(t+this.botright.x,e+this.botright.y,0,0,r),this.pushUnsafe(t+this.botleft.x,e+this.botleft.y,0,0,r)}},{key:"rect",value:function(t,e,n,i,r){null!=this.shader.sampler2d&&this.setShaderTexture(this._pixel);var o=this._pixelUVs;this.push(t,e,o[0].x,o[0].y,r),this.pushUnsafe(t+n,e,o[1].x,o[1].y,r),this.pushUnsafe(t+n,e+i,o[2].x,o[2].y,r),this.pushUnsafe(t,e,o[0].x,o[0].y,r),this.pushUnsafe(t,e+i,o[3].x,o[3].y,r),this.pushUnsafe(t+n,e+i,o[2].x,o[2].y,r)}},{key:"triangle",value:function(t,e,n,i,r,o){null!=this.shader.sampler2d&&this.setShaderTexture(this._pixel),void 0===r&&(r=i),void 0===o&&(o=i);var a=this._pixelUVs;this.push(t.x,t.y,a[0].x,a[0].y,i),this.pushUnsafe(e.x,e.y,a[1].x,a[1].y,r),this.pushUnsafe(n.x,n.y,a[2].x,a[2].y,o)}},{key:"circle",value:function(t,e,n,i,r){null!=this.shader.sampler2d&&this.setShaderTexture(this._pixel),void 0===r&&(r=i),this.checkState();for(var o=this._pixelUVs,a=new m.Vector(t.x+e,t.y),s=1;s<=n;s++){var u=s/n*Math.PI*2,l=new m.Vector(t.x+Math.cos(u),t.y+Math.sin(u));this.pushUnsafe(t.x,t.y,o[0].x,o[0].y,i),this.pushUnsafe(a.x,a.y,o[1].x,o[1].y,r),this.pushUnsafe(l.x,l.y,o[2].x,o[2].y,r),a=l}}},{key:"hollowRect",value:function(t,e,n,i,r,o){this.rect(t,e,n,r,o),this.rect(t,e+r,r,i-2*r,o),this.rect(t+n-r,e+r,r,i-2*r,o),this.rect(t,e+i-r,n,r,o)}},{key:"pageToScreen",value:function(t,e){var n=h.Engine.graphics.canvas.getBoundingClientRect(),i=h.Engine.graphics.getOutputBounds(),r=new m.Vector(i.width/h.Engine.width,i.height/h.Engine.height);return[(t-n.left-i.left)/r.y,(e-n.top-i.top)/r.y]}},{key:"shader",get:function(){return null!=this.nextShader?this.nextShader:this.currentShader},set:function(t){this.shader!=t&&null!=t&&(this.nextShader=t)}},{key:"blendmode",get:function(){return null!=this.nextBlendmode?this.nextBlendmode:this.currentBlendmode},set:function(t){this.currentBlendmode!=t&&null!=t&&(this.nextBlendmode=t)}},{key:"pixel",set:function(t){null==t&&(t=this._defaultPixel);var e=t.bounds.left/t.texture.width,n=t.bounds.top/t.texture.height,i=t.bounds.right/t.texture.width,r=t.bounds.bottom/t.texture.height;this._pixel=t,this._pixelUVs=[new m.Vector(e,n),new m.Vector(i,n),new m.Vector(i,r),new m.Vector(e,r)]},get:function(){return this._pixel}}],[{key:"_initCanvas",value:function(t){t.onselectstart=function(){return!1},h.Engine.root.appendChild(t)}},{key:"checkCanvasSize",value:function(t){t.width===h.Engine.root.clientWidth&&t.height===h.Engine.root.clientHeight||(t.width=h.Engine.root.clientWidth,t.height=h.Engine.root.clientHeight)}}]),t}();e.Graphics=b},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(15),l=function(){function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"init",value:function(){window.addEventListener("gamepadconnected",t.onAddController,!1),window.addEventListener("gamepaddisconnected",t.onRemoveController,!1)}},{key:"update",value:function(){var e=!0,n=!1,i=void 0;try{for(var r,o=t.controllers[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)r.value.update()}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}},{key:"onAddController",value:function(e){var n=!0,i=!1,r=void 0;try{for(var o,a=t.controllers[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)if(o.value.gamepad===e.gamepad)return}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}e.gamepad.id.includes("Unknown Gamepad")||(t.controllers[e.gamepad.index]=new c(e.gamepad))}},{key:"onRemoveController",value:function(t){delete this.controllers[t.gamepad.index]}},{key:"getController",value:function(e){var n=t.controllers[e];if(n)return n;var i=!0,r=!1,o=void 0;try{for(var a,s=navigator.getGamepads()[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value;if(u&&u.index===e)return t.controllers[e]=new c(u)}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}}},{key:"numControllers",value:function(){return t.controllers.length}},{key:"setRemoveControllerBehavior",value:function(e){t.onRemoveController=e}}]),t}();l.defaultDeadzone=.3,l.controllers=[],e.GamepadManager=l;var c=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.defaultDeadzone;(0,o.default)(this,t),this.leftStick=new u.Vector,this.rightStick=new u.Vector,this.buttons=[],this.gamepad=e,this.deadzone=n;for(var i=0;i<e.buttons.length;i++)this.buttons.push(new h)}return(0,s.default)(t,[{key:"update",value:function(){var t=this.gamepad=this.queryGamepad();this.leftStick.x=t.axes[0],this.leftStick.y=t.axes[1],this.rightStick.x=t.axes[2],this.rightStick.y=t.axes[3];for(var e=0;e<this.buttons.length;e++)this.buttons[e].update(t.buttons[e].pressed)}},{key:"getButton",value:function(t){return this.buttons[t]}},{key:"getLeftStick",value:function(){return this.leftStick.length>this.deadzone?this.leftStick.clone():u.Vector.zero}},{key:"getRightStick",value:function(){return this.rightStick.length>this.deadzone?this.rightStick.clone():u.Vector.zero}},{key:"getRawLeftStick",value:function(){return this.leftStick.clone()}},{key:"getRawRightStick",value:function(){return this.rightStick.clone()}},{key:"queryGamepad",value:function(){return navigator.getGamepads()[this.gamepad.index]}}]),t}(),h=function(){function t(){(0,o.default)(this,t),this._last=!1,this._next=!1}return(0,s.default)(t,[{key:"update",value:function(t){this._last=this._next,this._next=t}},{key:"down",value:function(){return this._next}},{key:"pressed",value:function(){return this._next&&!this._last}},{key:"released",value:function(){return this._last&&!this._next}}]),t}();e.ButtonState=h},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"init",value:function(){window.addEventListener("keydown",function(e){t._next[e.keyCode]=!0}),window.addEventListener("keyup",function(e){t._next[e.keyCode]=!1})}},{key:"update",value:function(){for(var e=0;e<256;e++)t._last[e]=t._down[e],t._down[e]=t._next[e]}},{key:"releaseAllKeys",value:function(){for(var e=0;e<256;++e)t._next[e]=!1}},{key:"check",value:function(e){return isNaN(e)?t.mapCheck(e):1==t._down[e]}},{key:"pressed",value:function(e){return isNaN(e)?t.mapPressed(e):1==t._down[e]&&!t._last[e]}},{key:"released",value:function(e){return isNaN(e)?t.mapReleased(e):!t._down[e]&&1==t._last[e]}},{key:"map",value:function(e,n){t._map[e]||(t._map[e]=[]);for(var i=0;i<n.length;i++)t._map[e].push(n[i])}},{key:"maps",value:function(e){for(var n in e)t.map(n,e[n])}},{key:"mapCheck",value:function(e){if(void 0!=t._map[e])for(var n=0;n<t._map[e].length;n++)if(t.check(t._map[e][n]))return!0;return!1}},{key:"mapPressed",value:function(e){if(void 0!=t._map[e])for(var n=0;n<t._map[e].length;n++)if(t.pressed(t._map[e][n]))return!0;return!1}},{key:"mapReleased",value:function(e){if(void 0!=t._map[e])for(var n=0;n<t._map[e].length;n++)if(t.released(t._map[e][n]))return!0;return!1}}]),t}();u._down=[],u._last=[],u._next=[],u._map={},e.Keyboard=u,function(t){t[t.backspace=8]="backspace",t[t.tab=9]="tab",t[t.enter=13]="enter",t[t.shift=16]="shift",t[t.ctrl=17]="ctrl",t[t.alt=18]="alt",t[t.pause=19]="pause",t[t.capslock=20]="capslock",t[t.escape=27]="escape",t[t.space=32]="space",t[t.pageUp=33]="pageUp",t[t.pageDown=34]="pageDown",t[t.end=35]="end",t[t.home=36]="home",t[t.left=37]="left",t[t.up=38]="up",t[t.right=39]="right",t[t.down=40]="down",t[t.insert=45]="insert",t[t.del=46]="del",t[t.zero=48]="zero",t[t.one=49]="one",t[t.two=50]="two",t[t.three=51]="three",t[t.four=52]="four",t[t.five=53]="five",t[t.six=54]="six",t[t.seven=55]="seven",t[t.eight=56]="eight",t[t.nine=57]="nine",t[t.a=65]="a",t[t.b=66]="b",t[t.c=67]="c",t[t.d=68]="d",t[t.e=69]="e",t[t.f=70]="f",t[t.g=71]="g",t[t.h=72]="h",t[t.i=73]="i",t[t.j=74]="j",t[t.k=75]="k",t[t.l=76]="l",t[t.m=77]="m",t[t.n=78]="n",t[t.o=79]="o",t[t.p=80]="p",t[t.q=81]="q",t[t.r=82]="r",t[t.s=83]="s",t[t.t=84]="t",t[t.u=85]="u",t[t.v=86]="v",t[t.w=87]="w",t[t.x=88]="x",t[t.y=89]="y",t[t.z=90]="z",t[t.leftWindow=91]="leftWindow",t[t.rightWindow=92]="rightWindow",t[t.select=93]="select",t[t.numpad0=96]="numpad0",t[t.numpad1=97]="numpad1",t[t.numpad2=98]="numpad2",t[t.numpad3=99]="numpad3",t[t.numpad4=100]="numpad4",t[t.numpad5=101]="numpad5",t[t.numpad6=102]="numpad6",t[t.numpad7=103]="numpad7",t[t.numpad8=104]="numpad8",t[t.numpad9=105]="numpad9",t[t.multiply=106]="multiply",t[t.add=107]="add",t[t.subtract=109]="subtract",t[t.decimal=110]="decimal",t[t.divide=111]="divide",t[t.f1=112]="f1",t[t.f2=113]="f2",t[t.f3=114]="f3",t[t.f4=115]="f4",t[t.f5=116]="f5",t[t.f6=117]="f6",t[t.f7=118]="f7",t[t.f8=119]="f8",t[t.f9=120]="f9",t[t.f10=121]="f10",t[t.f11=122]="f11",t[t.f12=123]="f12",t[t.numlock=144]="numlock",t[t.scrollLock=145]="scrollLock",t[t.semicolon=186]="semicolon",t[t.equal=187]="equal",t[t.comma=188]="comma",t[t.dash=189]="dash",t[t.period=190]="period",t[t.forwardSlash=191]="forwardSlash",t[t.graveAccent=192]="graveAccent",t[t.openBracket=219]="openBracket",t[t.backSlash=220]="backSlash",t[t.closeBraket=221]="closeBraket",t[t.singleQuote=222]="singleQuote"}(e.Key||(e.Key={}))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=n(10),h=n(7),f=function(){function t(e,n){(0,s.default)(this,t),this.id=-1,this.position=new h.Vector(0,0),this.visible=!0,this.active=!0,this.isCreated=!1,this.isStarted=!1,this.components=new h.ObjectList,this.componentByName={},this.groups=[],this._depth=0,this.id=t._next_id++,void 0!==e&&(this.x=e),void 0!==n&&(this.y=n),this.group("sprite")}return(0,l.default)(t,[{key:"toString",value:function(){return"<Entity "+this.id+" '"+(this.name||"[noname]")+"'>"}},{key:"getComponentByName",value:function(t){var e=this.componentByName[t];if(!e)throw Error("no getComponentByName('"+t+"'");return e}},{key:"created",value:function(){}},{key:"added",value:function(){}},{key:"started",value:function(){}},{key:"removed",value:function(){}},{key:"recycled",value:function(){}},{key:"destroyed",value:function(){}},{key:"destroyLater",value:function(){this.scene.destroyLater(this)}},{key:"update",value:function(){this.components.each(function(t){t.active&&t.update()})}},{key:"lateUpdate",value:function(){this.components.each(function(t){t.active&&t.lateUpdate()})}},{key:"render",value:function(t){this.components.each(function(e){e.visible&&e.render(t)})}},{key:"debugRender",value:function(t){c.Engine.graphics.triangle(h.Vector.temp0.set(this.x+9,this.y),h.Vector.temp1.set(this.x+9-3,this.y-3),h.Vector.temp2.set(this.x+9-3,this.y+3),h.Color.red),c.Engine.graphics.rect(this.x,this.y,10,1,h.Color.red),c.Engine.graphics.triangle(h.Vector.temp0.set(this.x,this.y-9),h.Vector.temp1.set(this.x-3,this.y-9+3),h.Vector.temp2.set(this.x+3,this.y-9+3),h.Color.green),c.Engine.graphics.rect(this.x,this.y,1,-10,h.Color.green),this.components.each(function(e){e.visible&&e.debugRender(t)})}},{key:"add",value:function(t){return this.components.add(t),t.entity=this,t.addedToEntity(),null!=this.scene&&this.scene._trackComponent(t),t}},{key:"remove",value:function(t){return this.components.remove(t),t.removedFromEntity(),t.entity=null,null!=this.scene&&this.scene._untrackComponent(t),this._removeNamedComponent(t),t}},{key:"_removeNamedComponent",value:function(t){var e=[],n=!0,i=!1,r=void 0;try{for(var a,s=Object.entries(this.componentByName)[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var u=(0,o.default)(a.value,2),l=u[0];u[1]===t&&e.push(l)}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}var c=!0,h=!1,f=void 0;try{for(var d,p=e[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var l=d.value;delete this.componentByName[l]}}catch(t){h=!0,f=t}finally{try{!c&&p.return&&p.return()}finally{if(h)throw f}}}},{key:"removeAll",value:function(){for(var t=this.components.count-1;t>=0;t--)this.remove(this.components[t]);this.componentByName={}}},{key:"find",value:function(t){var e=null;return this.components.each(function(n){if(n instanceof t)return e=n,!1}),e}},{key:"findAll",value:function(t){var e=[];return this.components.each(function(n){n instanceof t&&e.push(n)}),e}},{key:"group",value:function(t){this.groups.push(t),null!=this.scene&&this.scene._groupEntity(this,t)}},{key:"ungroup",value:function(t){var e=this.groups.indexOf(t);e>=0&&(this.groups.splice(e,1),null!=this.scene&&this.scene._ungroupEntity(this,t))}},{key:"ingroup",value:function(t){return this.groups.indexOf(t)>=0}},{key:"x",get:function(){return this.position.x},set:function(t){this.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.position.y=t}},{key:"depth",get:function(){return this._depth},set:function(t){if(null==this.scene)throw Error("Cannot set depth without being attached to a scene");if(this._depth!==t){this._depth=t,this.scene.entities.unsorted=!0;var e=!0,n=!1,i=void 0;try{for(var r,o=this.groups[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;this.scene.groups[a].unsorted=!0}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}}}]),t}();f._next_id=1,e.Entity=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(37),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=n(43),h=n(10),f=n(187),d=n(7),p=function(){function t(){(0,s.default)(this,t),this.camera=new d.Camera,this.entities=new d.ObjectList,this.renderers=new d.ObjectList,this.groups={},this.colliders={},this.cache={},this.earlyUpdate=[],this._markedForDestruction=[],this.camera=new d.Camera,this.addRenderer(new f.SpriteRenderer)}return(0,l.default)(t,[{key:"begin",value:function(){}},{key:"ended",value:function(){}},{key:"dispose",value:function(){var t=this;this.renderers.each(function(t){return t.dispose()}),this.renderers.clear(),this.entities.each(function(e){return t.destroy(e)}),this.entities.clear(),this.colliders={},this.groups={},this.cache={}}},{key:"update",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.earlyUpdate[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)(0,i.value)()}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}this.entities.each(function(t){t.isStarted||(t.isStarted=!0,t.started()),t.active&&t.isStarted&&t.update()}),this.entities.each(function(t){t.active&&t.isStarted&&t.lateUpdate()});var o=!0,a=!1,s=void 0;try{for(var u,l=this._markedForDestruction[Symbol.iterator]();!(o=(u=l.next()).done);o=!0){var c=u.value;this.destroy(c)}}catch(t){a=!0,s=t}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}this.renderers.each(function(t){t.visible&&t.update()}),this.entities.clean(),this.renderers.clean();for(var h in this.groups)this.groups[h].clean()}},{key:"render",value:function(){var t=this;this.entities.sort(function(t,e){return e.depth-t.depth});for(var e in this.groups)this.groups[e].sort(function(t,e){return e.depth-t.depth});this.renderers.each(function(t){t.visible&&t.preRender()}),this.renderers.each(function(t){t.visible&&t.render()}),this.renderers.each(function(t){t.visible&&t.postRender()}),h.Engine.debugMode&&(h.Engine.graphics.setRenderTarget(h.Engine.graphics.buffer),h.Engine.graphics.shader=d.Shaders.primitive,h.Engine.graphics.shader.set("matrix",this.camera.matrix),this.debugRender(this.camera),this.entities.each(function(e){e.active&&e.debugRender(t.camera)}))}},{key:"debugRender",value:function(t){}},{key:"add",value:function(t,e){var n=this;t.scene=this,this.entities.add(t),void 0!==e&&t.position.set(e.x,e.y),t.isCreated||(t.isCreated=!0,t.created());var i=!0,r=!1,o=void 0;try{for(var a,s=t.groups[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value;this._groupEntity(t,u)}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return t.components.each(function(t){return n._trackComponent(t)}),t.added(),t}},{key:"recreate",value:function(t){if(Array.isArray(this.cache[t])&&this.cache[t].length>0){var e=this.cache[t][0];return this.cache[t].splice(0,1),this.add(e)}return null}},{key:"recycle",value:function(t,e){this.remove(e),void 0===this.cache[t]&&(this.cache[t]=[]),this.cache[t].push(e),e.recycled()}},{key:"remove",value:function(t){var e=this;t.removed(),t.components.each(function(t){return e._untrackComponent(t)});var n=!0,i=!1,r=void 0;try{for(var o,a=t.groups[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;this._ungroupEntity(t,s)}}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}t.isStarted=!1,t.scene=null,this.entities.remove(t)}},{key:"removeAll",value:function(){var t=this;this.entities.each(function(e){return t.remove(e)})}},{key:"destroy",value:function(t){null!=t.scene&&this.remove(t),t.destroyed(),t.isCreated=!1}},{key:"destroyLater",value:function(t){-1===this._markedForDestruction.indexOf(t)&&this._markedForDestruction.push(t)}},{key:"findAllComponents",value:function(t){var e=[];return this.entities.each(function(n){e.push.apply(e,(0,o.default)(n.findAll(t)))}),e}},{key:"find",value:function(t){var e=null;return this.entities.each(function(n){if(n instanceof t)return e=n,!1}),e}},{key:"findEach",value:function(t,e){this.entities.each(function(n){if(n instanceof t)return e(n)})}},{key:"findAll",value:function(t){var e=[];return this.entities.each(function(n){n instanceof t&&e.push(n)}),e}},{key:"firstInGroup",value:function(t){return void 0!==this.groups[t]&&this.groups[t].count>0?this.groups[t].first():null}},{key:"eachInGroup",value:function(t,e){void 0!==this.groups[t]&&this.groups[t].each(e)}},{key:"allInGroup",value:function(t){return void 0!==this.groups[t]?this.groups[t]:null}},{key:"eachInGroups",value:function(t,e){for(var n=!1,i=0;i<t.length&&!n;i++)this.eachInGroup(t[i],function(t){var i=e(t);return!1===i&&(n=!0),i})}},{key:"allInGroups",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!=e&&void 0!==e||(e=new d.ObjectList);var n=!0,i=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value,u=this.allInGroup(s);null!=u&&u.each(function(t){return e.add(t)})}}catch(t){i=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw r}}return e}},{key:"firstColliderInTag",value:function(t){return void 0!==this.colliders[t]&&this.colliders[t].length>0?this.colliders[t][0]:null}},{key:"allCollidersInTag",value:function(t){return void 0!==this.colliders[t]?this.colliders[t]:[]}},{key:"addRenderer",value:function(t){return t.scene=this,this.renderers.add(t),this.renderers.sort(function(t,e){return d.Calc.cmp(t.sortOrder,e.sortOrder)}),t}},{key:"removeRenderer",value:function(t,e){return this.renderers.remove(t),e&&t.dispose(),t.scene=null,t}},{key:"_groupEntity",value:function(t,e){void 0===this.groups[e]&&(this.groups[e]=new d.ObjectList),this.groups[e].add(t)}},{key:"_ungroupEntity",value:function(t,e){void 0!==this.groups[e]&&this.groups[e].remove(t)}},{key:"_trackComponent",value:function(t){if(null==t.entity||t.entity.scene!==this)throw Error("Component must be added through an existing entity");if(t instanceof c.Collider){var e=!0,n=!1,i=void 0;try{for(var r,o=t.tags[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;this._trackCollider(t,a)}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}t.scene=this,t.addedToScene()}},{key:"_untrackComponent",value:function(t){if(t.removedFromScene(),t instanceof c.Collider){var e=!0,n=!1,i=void 0;try{for(var r,o=t.tags[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value;this._untrackCollider(t,a)}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}}t.scene=null}},{key:"_trackCollider",value:function(t,e){void 0===this.colliders[e]&&(this.colliders[e]=[]),this.colliders[e].push(t)}},{key:"_untrackCollider",value:function(t,e){if(void 0!==this.colliders[e]){var n=this.colliders[e].indexOf(t);n>=0&&(this.colliders[e].splice(n,1),this.colliders[e].length<=0&&delete this.colliders[e])}}}]),t}();e.Scene=p},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(2),s=i(a),u=n(3),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=n(109),h=n(52),f=function(t){function e(){(0,o.default)(this,e);var t=(0,s.default)(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.shader=h.Shaders.texture,t.shaderCameraUniformName="matrix",t}return(0,l.default)(e,t),e}(c.Renderer);e.SpriteRenderer=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=n(110),l=n(10),c=n(108),h=n(50),f=n(111),d=n(53),p=function(){function t(e){(0,o.default)(this,t),this.root="",this._loading=!1,this._loaded=!1,this.assets=0,this.assetsLoaded=0,this.textures=[],this.jsons=[],this.xmls=[],this.sounds=[],this.atlases=[],this.texts=[],this.pending={},this.root=e||""}return(0,s.default)(t,[{key:"checkLoading",value:function(){if(this.loading||this.loaded)throw Error("Cannot add more assets when already loaded")}},{key:"addTexture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.checkLoading(),this.textures.push({path:t,colorKey:e}),this.assets++,this}},{key:"addJson",value:function(t){return this.checkLoading(),this.jsons.push(t),this.assets++,this}},{key:"addXml",value:function(t){return this.checkLoading(),this.xmls.push(t),this.assets++,this}},{key:"addText",value:function(t){return this.checkLoading(),this.texts.push(t),this.assets++,this}},{key:"addSound",value:function(t,e){return this.checkLoading(),this.sounds.push({handle:t,path:e}),this.assets++,this}},{key:"addAtlas",value:function(t,e,n,i){return this.checkLoading(),this.atlases.push({name:t,image:e,data:n,loader:i}),this.assets+=3,this}},{key:"load",value:function(t){this._loading=!0,this.callback=t;var e=!0,n=!1,i=void 0;try{for(var r,o=this.textures[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var a=r.value,s=c.FosterIO.join(this.root,a.path);this.loadTexture({path:s,colorKey:a.colorKey})}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}var u=!0,l=!1,h=void 0;try{for(var f,d=this.jsons[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var p=f.value;this.loadJson(c.FosterIO.join(this.root,p))}}catch(t){l=!0,h=t}finally{try{!u&&d.return&&d.return()}finally{if(l)throw h}}var y=!0,v=!1,m=void 0;try{for(var g,_=this.xmls[Symbol.iterator]();!(y=(g=_.next()).done);y=!0){var b=g.value;this.loadXml(c.FosterIO.join(this.root,b))}}catch(t){v=!0,m=t}finally{try{!y&&_.return&&_.return()}finally{if(v)throw m}}var w=!0,x=!1,k=void 0;try{for(var E,O=this.texts[Symbol.iterator]();!(w=(E=O.next()).done);w=!0){var S=E.value;this.loadText(c.FosterIO.join(this.root,S))}}catch(t){x=!0,k=t}finally{try{!w&&O.return&&O.return()}finally{if(x)throw k}}var T=!0,C=!1,P=void 0;try{for(var A,R=this.sounds[Symbol.iterator]();!(T=(A=R.next()).done);T=!0){var M=A.value;this.loadSound(M.handle,c.FosterIO.join(this.root,M.path))}}catch(t){C=!0,P=t}finally{try{!T&&R.return&&R.return()}finally{if(C)throw P}}var j=!0,L=!1,F=void 0;try{for(var D,B=this.atlases[Symbol.iterator]();!(j=(D=B.next()).done);j=!0){var N=D.value;this.loadAtlas(N)}}catch(t){L=!0,F=t}finally{try{!j&&B.return&&B.return()}finally{if(L)throw F}}}},{key:"unload",value:function(){if(this.loading)throw Error("Cannot unload until finished loading");if(!this.loaded)throw Error("Cannot unload before loading");throw Error("Asset Unloading not Implemented")}},{key:"markPending",value:function(t,e){var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];window.assetLoader=this;var r=this.pending[t]||(this.pending[t]=[]);i?r.push(e):r.splice(r.indexOf(e),1);var o=!1;return function(){o||(o=!0,n.markPending(t,e,!1))}}},{key:"loadTexture",value:function(e,n){var i=this,r=e.path,o=(l.Engine.graphics.gl,new Image),a=this.markPending("texture",r);o.addEventListener("load",function(){var s=d.Texture.create(o,e.colorKey);s.texture.path=r,h.Assets.textures[t.pathify(r)]=s,a(),void 0!==n&&n(s),i.incrementLoader()}),o.src=r}},{key:"loadJson",value:function(e,n){var i=this,r=this.markPending("json",e);c.FosterIO.read(e,function(o){var a=t.pathify(e);h.Assets.json[a]=JSON.parse(o),r(),void 0!==n&&n(h.Assets.json[a]),i.incrementLoader()})}},{key:"loadXml",value:function(e,n){var i=this,r=this.markPending("xml",e);c.FosterIO.read(e,function(o){var a=t.pathify(e);h.Assets.xml[a]=(new DOMParser).parseFromString(o,"text/xml"),r(),void 0!==n&&n(h.Assets.xml[a]),i.incrementLoader()})}},{key:"loadText",value:function(e,n){var i=this,r=this.markPending("text",e);c.FosterIO.read(e,function(o){var a=t.pathify(e);h.Assets.text[a]=o,r(),void 0!==n&&n(h.Assets.text[a]),i.incrementLoader()})}},{key:"loadSound",value:function(t,e,n){var i=this,r=new Audio,o=this.markPending("sound",e);r.addEventListener("canplaythrough",function(){h.Assets.sounds[t]=new u.AudioSource(e,r),o(),void 0!==n&&n(h.Assets.sounds[t]),i.incrementLoader()}),r.src=e}},{key:"loadAtlas",value:function(t){function e(){if(null!=i&&null!=r){var e=new f.Atlas(t.name,i,r,t.loader);h.Assets.atlases[e.name]=e,n.incrementLoader()}}var n=this,i=null,r=null;this.loadText(c.FosterIO.join(this.root,t.data),function(t){r=t,e()}),this.loadTexture({path:c.FosterIO.join(this.root,t.image),colorKey:null},function(t){i=t,e()})}},{key:"incrementLoader",value:function(){this.assetsLoaded++,this.progressCallback&&this.progressCallback(this.assetsLoaded/this.assets),this.assetsLoaded===this.assets&&(this._loaded=!0,this._loading=!1,void 0!==this.callback&&this.callback())}},{key:"loading",get:function(){return this._loading}},{key:"loaded",get:function(){return this._loaded}},{key:"percent",get:function(){return this.assetsLoaded/this.assets}}],[{key:"pathify",value:function(t){for(t=c.FosterIO.normalize(t);t.indexOf("\\")>=0;)t=t.replace("\\","/");return t}}]),t}();e.AssetLoader=p},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(100)),i(n(110)),i(n(79))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(111)),i(n(106)),i(n(53))},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a);Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){(0,o.default)(this,t)}return(0,s.default)(t,null,[{key:"onLevelCompleted",value:function(t){if(t&&t.length){var e=window.ga;e&&e("send","event","Levels","completed",t)}}}]),t}();e.Analytics=u},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=n(17),h=n(7),f=function(){function t(){(0,s.default)(this,t)}return(0,l.default)(t,null,[{key:"clearCompletedLevels",value:function(){this._setCompletedLevels([])}},{key:"markLevelCompleted",value:function(t,e){e=e.slice();var n=this.completedLevels,i=!1,r=!0,o=!1,a=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value;if(l.levelName===name){l.effects=e,i=!0;break}}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}i||n.push({levelName:t,effects:e}),this._setCompletedLevels(n)}},{key:"_setCompletedLevels",value:function(t){if(window.localStorage){t.sort(function(t,e){return h.Calc.cmp(c.Game.levels.indexOf(t.levelName),c.Game.levels.indexOf(e.levelName))});var e={version:1,completedLevels:t};return localStorage.setItem("saveGame",JSON.stringify(e)),e}}},{key:"upgrade",value:function(t,e){if(!t){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value;n.push({levelName:u,effects:[]})}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}t=this._setCompletedLevels(n)}return t}},{key:"getNextLevelName",value:function(t){var e=this.getNextLevelNameAndEffects(t);if(e){var n=(0,o.default)(e,2),i=n[0];return n[1],i}return null}},{key:"getNextLevelNameAndEffects",value:function(t){var e=this.completedLevels.slice();t&&e.push({levelName:t,effects:[]});var n={},i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value,l=u.levelName;u.effects,n[l]=!0}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}var h=void 0,f=!0,d=!1,p=void 0;try{for(var y,v=c.Game.levels[Symbol.iterator]();!(f=(y=v.next()).done);f=!0){var m=y.value;if(!n[m]){h=m;break}}}catch(t){d=!0,p=t}finally{try{!f&&v.return&&v.return()}finally{if(d)throw p}}var g=[];return h?(g=this.getEffectsForNextLevelName(h,e),[h,g]):null}},{key:"getEffectsForNextLevelName",value:function(t,e){var n=c.Game.levels[c.Game.levels.indexOf(t)-1],i=!0,r=!1,o=void 0;try{for(var a,s=(e||this.completedLevels)[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var u=a.value,l=u.levelName,h=u.effects;if(l===n)return h.slice()}}catch(t){r=!0,o=t}finally{try{!i&&s.return&&s.return()}finally{if(r)throw o}}return[]}},{key:"hasLevelsCompleted",get:function(){return this.completedLevels.length>0}},{key:"completedLevels",get:function(){if(!window.localStorage)return[];var t=localStorage.getItem("saveGame"),e=t?JSON.parse(t):void 0,n=void 0;return e||(n=JSON.parse(localStorage.getItem("completedLevels")||"[]")),e=this.upgrade(e,n),e.completedLevels}}]),t}();e.SaveGame=f},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(){var t=l.Assets.atlases.sprites,e={},n=!0,i=!1,r=void 0;try{for(var o,s=t.metadata.frameTags[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var f=o.value,d=f.name,p=f.direction;e[d]={direction:p}}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}var y=!0,v=!1,m=void 0;try{for(var g,_=Object.entries(t.subtextures)[Symbol.iterator]();!(y=(g=_.next()).done);y=!0){var b=(0,u.default)(g.value,2),d=b[0],w=b[1],x=d.split("_");if(!(x.length<2)){var k=(0,u.default)(x,2),E=k[0],O=k[1];O=O.replace(/\s+\d+$/,"");var S=c.SpriteBank.get(E)||c.SpriteBank.create(E),T=e[E+"_"+O];S.get(O)||S.add(O,h,[],!1);var C=S.get(O);if(C.frames.push(w),T&&(C.loops=!0,"pingpong"===T.direction)){var P=C.frames;P.push.apply(P,(0,a.default)(P.slice(0,P.length-1).reverse()))}}}}catch(t){v=!0,m=t}finally{try{!y&&_.return&&_.return()}finally{if(v)throw m}}}var o=n(37),a=i(o),s=n(11),u=i(s);Object.defineProperty(e,"__esModule",{value:!0});var l=n(54),c=n(45),h=10;e.loadAutoSprites=r},function(t,e,n){t.exports={default:n(195),__esModule:!0}},function(t,e,n){n(196),t.exports=n(18).Object.getPrototypeOf},function(t,e,n){var i=n(72),r=n(94);n(115)("getPrototypeOf",function(){return function(t){return r(i(t))}})},function(t,e,n){t.exports={default:n(198),__esModule:!0}},function(t,e,n){n(199);var i=n(18).Object;t.exports=function(t,e){return i.getOwnPropertyDescriptor(t,e)}},function(t,e,n){var i=n(24),r=n(76).f;n(115)("getOwnPropertyDescriptor",function(){return function(t,e){return r(i(t),e)}})},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(27),d=n(10),Alarm=function(t){function Alarm(){(0,o.default)(this,Alarm);var t=(0,l.default)(this,(Alarm.__proto__||Object.getPrototypeOf(Alarm)).call(this));return t._percent=0,t.removeOnComplete=!1,t.active=t.visible=!1,t}return(0,h.default)(Alarm,t),(0,s.default)(Alarm,[{key:"start",value:function(t,e){return this._percent=0,this._duration=t,this.callback=e,this.active=!0,this}},{key:"restart",value:function(){return this._percent=0,this}},{key:"resume",value:function(){return this.percent<1&&(this.active=!0),this}},{key:"pause",value:function(){return this.active=!1,this}},{key:"update",value:function(){this.percent<1&&this.duration>0&&(this._percent+=d.Engine.delta/this.duration,this.percent>=1&&(this._percent=1,this.active=!1,this.callback(this),this.removeOnComplete&&this.entity.remove(this)))}},{key:"percent",get:function(){return this._percent}},{key:"duration",get:function(){return this._duration}}],[{key:"create",value:function(t){return t.add(new Alarm)}}]),Alarm}(f.Component);e.Alarm=Alarm},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(27),d=n(10),Tween=function(t){function Tween(){(0,o.default)(this,Tween);var t=(0,l.default)(this,(Tween.__proto__||Object.getPrototypeOf(Tween)).call(this));return t._percent=0,t.from=0,t.to=0,t.ease=function(t){return t},t.removeOnComplete=!1,t.active=t.visible=!1,t}return(0,h.default)(Tween,t),(0,s.default)(Tween,[{key:"setOnComplete",value:function(t){return this.onComplete=t,this}},{key:"start",value:function(t,e,n,i,r,o){return this._percent=0,this._duration=t,this.from=e,this.to=n,this.ease=i,this.step=r,this.removeOnComplete=o,this}},{key:"restart",value:function(){return this._percent=0,this.active=!0,this}},{key:"resume",value:function(){return this.percent<1&&(this.active=!0),this}},{key:"pause",value:function(){return this.active=!1,this}},{key:"update",value:function(){this.percent<1&&this.duration>0&&(this._percent+=d.Engine.delta/this.duration,this.percent>=1?(this._percent=1,this.step(this.to),this.active=!1,this.onComplete&&this.onComplete(),this.removeOnComplete&&this.entity.remove(this)):this.step(this.value))}},{key:"percent",get:function(){return this._percent}},{key:"duration",get:function(){return this._duration}},{key:"value",get:function(){return this.from+(this.to-this.from)*this.ease(this.percent)}}],[{key:"create",value:function(t){var e=new Tween;return t.add(e),e}}]),Tween}(f.Component);e.Tween=Tween},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(27),d=n(10),p=n(20),y=n(15),Rectsprite=function(t){function Rectsprite(t,e,n){(0,o.default)(this,Rectsprite);var i=(0,l.default)(this,(Rectsprite.__proto__||Object.getPrototypeOf(Rectsprite)).call(this));return i.size=new y.Vector(0,0),i.scale=new y.Vector(1,1),i.origin=new y.Vector(0,0),i.rotation=0,i.color=p.Color.white.clone(),i.alpha=1,i.size.x=t,i.size.y=e,i.color=n||p.Color.white,i}return(0,h.default)(Rectsprite,t),(0,s.default)(Rectsprite,[{key:"render",value:function(){null!=d.Engine.graphics.shader.sampler2d?d.Engine.graphics.texture(d.Engine.graphics.pixel,this.scenePosition.x,this.scenePosition.y,null,p.Color.temp.copy(this.color).mult(this.alpha),y.Vector.temp0.copy(this.origin).div(this.size),y.Vector.temp1.copy(this.size).mult(this.scale),this.rotation):d.Engine.graphics.quad(this.scenePosition.x,this.scenePosition.y,this.size.x,this.size.y,p.Color.temp.copy(this.color).mult(this.alpha),this.origin,this.scale,this.rotation)}},{key:"width",get:function(){return this.size.x},set:function(t){this.size.x=t}},{key:"height",get:function(){return this.size.y},set:function(t){this.size.y=t}}]),Rectsprite}(f.Component);e.Rectsprite=Rectsprite},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f);Object.defineProperty(e,"__esModule",{value:!0});var p=n(112),y=n(10),v=n(41),m=n(117),Sprite=function(t){function Sprite(t){var e=t.animation,n=t.origin,i=t.scale,r=t.play,a=t.flipX,s=t.flipY,u=t.x,c=t.y,h=t.rate,f=t.alpha,d=t.randomStartFrame,v=t.visible;(0,o.default)(this,Sprite);var m=(0,l.default)(this,(Sprite.__proto__||Object.getPrototypeOf(Sprite)).call(this,null));return m._animation=null,m._playing=null,m._frame=0,m.verbose=!1,m.rate=1,m.randomStartFrame=!1,m.zOverride=0,void 0!==h&&(m.rate=h),void 0!==u&&(m.x=u),void 0!==c&&(m.y=c),void 0!==f&&(m.alpha=f),void 0!==v&&(m.visible=v),i&&void 0!==i.x&&m.scale.set(i.x,i.y),void 0!==a&&(m.flipX=a),void 0!==s&&(m.flipY=s),y.Engine.assert(p.SpriteBank.has(e),"Missing animation '"+e+"'!"),m._animation=p.SpriteBank.get(e),m.texture=m._animation.first.frames[0],"center"===n?m.justify(.5,.5):"centerBottom"===n&&m.justify(.5,1),m.randomStartFrame=d,r&&m.play(r,!1,{randomFrame:d}),m}return(0,d.default)(Sprite,t),(0,s.default)(Sprite,[{key:"play",value:function(t,e,n){if(null!=this.animation){var i=this.animation.get(t);null==i||this.playing===i&&!e||(this._playing=i,this.verbose,this._frame=n&&n.randomFrame?Math.floor(v.Calc.range(0,this._playing.frames.length)):0,this.active=!0,this._playing.frames.length>0&&(this.texture=this._playing.frames[0]))}}},{key:"has",value:function(t){return null!=this.animation&&this.animation.has(t)}},{key:"update",value:function(){if(null!=this.playing){if(this._frame+=this.playing.speed*this.rate*y.Engine.delta,this.verbose,this.frame>=this.playing.frames.length||this.frame<0)if(this.playing.loops){for(;this._frame>=this.playing.frames.length;)this._frame-=this.playing.frames.length;for(;this._frame<0;)this._frame+=this.playing.frames.length}else if(null!=this.playing.goto&&this.playing.goto.length>0){var t=this.playing.goto[Math.floor(Math.random()*this.playing.goto.length)];this.play(t,!0)}else this.active=!1,this.frame>=this.playing.frames.length?this._frame=this.playing.frames.length-1:this._frame=0;null!=this.playing&&(this.texture=this.playing.frames[this.frame])}}},{key:"render",value:function(t){this.texture&&(0,h.default)(Sprite.prototype.__proto__||Object.getPrototypeOf(Sprite.prototype),"render",this).call(this,t,this.zOverride)}},{key:"animation",get:function(){return this._animation}},{key:"playing",get:function(){return this._playing}},{key:"frame",get:function(){return Math.floor(this._frame)},set:function(t){this._frame=t,null!=this.playing&&(this._frame=v.Calc.clamp(t,0,this.playing.frames.length),this.texture=this.playing.frames[this.frame])}}]),Sprite}(m.Graphic);e.Sprite=Sprite},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(27),d=n(10),p=n(20),y=n(22),v=n(15),Tilemap=function(t){function Tilemap(t,e,n){(0,o.default)(this,Tilemap);var i=(0,l.default)(this,(Tilemap.__proto__||Object.getPrototypeOf(Tilemap)).call(this));return i.color=p.Color.white.clone(),i.alpha=1,i.map={},i.crop=new y.Rectangle,i._vec=new v.Vector,i.texture=t,i.tileWidth=e,i.tileHeight=n,i.tileColumns=Math.floor(i.texture.width/i.tileWidth),i}return(0,h.default)(Tilemap,t),(0,s.default)(Tilemap,[{key:"getSceneBounds",value:function(t){return t.set(this.sceneLeft,this.sceneTop,this.width,this.height)}},{key:"set",value:function(t,e,n,i,r,o){var a=t+e*this.tileColumns;return this.setIndex(a,n,i,r,o)}},{key:"setIndex",value:function(t,e,n,i,r){(void 0===this._minTileX||e<this._minTileX)&&(this._minTileX=e),(void 0===this._minTileY||n<this._minTileY)&&(this._minTileY=n),(void 0===this._maxTileX||e>this._maxTileX)&&(this._maxTileX=e),(void 0===this._maxTileY||n>this._maxTileY)&&(this._maxTileY=n);for(var o=e;o<e+(i||1);o++){void 0===this.map[o]&&(this.map[o]={});for(var a=n;a<n+(r||1);a++)this.map[o][a]=t}return this}},{key:"clear",value:function(t,e,n,i){for(var r=t;r<t+(n||1);r++)if(void 0!==this.map[r])for(var o=e;o<e+(i||1);o++)void 0!==this.map[r][o]&&delete this.map[r][o];return this}},{key:"has",value:function(t,e){return void 0!==this.map[t]&&void 0!==this.map[t][e]}},{key:"get",value:function(t,e){if(this.has(t,e)){var n=this.map[t][e];return new v.Vector(n%this.tileColumns,Math.floor(n/this.tileColumns))}return null}},{key:"getTileSubtexture",value:function(t,e){var n=Math.floor(t%this.tileColumns)*this.tileWidth,i=Math.floor(t/this.tileColumns)*this.tileHeight,r=new y.Rectangle(n,i,this.tileWidth,this.tileHeight);return this.texture.getSubtexture(r,e)}},{key:"render",value:function(t){var e=t.extents,n=this.sceneX,i=this.sceneY,r=Math.floor((e.left-n)/this.tileWidth)-1,o=Math.ceil((e.right-n)/this.tileWidth)+1,a=Math.floor((e.top-i)/this.tileHeight)-1,s=Math.ceil((e.bottom-i)/this.tileHeight)+1;this.crop.width=this.tileWidth,this.crop.height=this.tileHeight;for(var u=r;u<o;u++)if(void 0!==this.map[u])for(var l=a;l<s;l++){var c=this.map[u][l];void 0!==c&&(this.crop.x=c%this.tileColumns*this.tileWidth,this.crop.y=Math.floor(c/this.tileColumns)*this.tileHeight,d.Engine.graphics.texture(this.texture,n+u*this.tileWidth,i+l*this.tileHeight,this.crop,p.Color.temp.copy(this.color).mult(this.alpha)))}}},{key:"sceneLeft",get:function(){return this.getScenePosition(this._vec).x}},{key:"sceneTop",get:function(){return this.getScenePosition(this._vec).y}},{key:"width",get:function(){return this.mapWidth*this.tileWidth}},{key:"height",get:function(){return this.mapHeight*this.tileHeight}},{key:"mapWidth",get:function(){return void 0===this._minTileX?0:this._maxTileX-this._minTileX+1}},{key:"mapHeight",get:function(){return void 0===this._minTileY?0:this._maxTileY-this._minTileY+1}}]),Tilemap}(f.Component);e.Tilemap=Tilemap},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var m=n(8),g=n(14),_=n(9),b=n(14),w=n(7),x=n(21),AutoTimer=function(t){function AutoTimer(){return(0,o.default)(this,AutoTimer),(0,l.default)(this,(AutoTimer.__proto__||Object.getPrototypeOf(AutoTimer)).apply(this,arguments))}return(0,d.default)(AutoTimer,t),(0,s.default)(AutoTimer,[{key:"addedToScene",value:function(){var t=this;(0,h.default)(AutoTimer.prototype.__proto__||Object.getPrototypeOf(AutoTimer.prototype),"addedToScene",this).call(this),this.onComplete=new x.EventDelegate(this.opts.onComplete,this.entity),g.Alarm.create(this.entity).start(this.opts.duration,function(){t.onComplete.invoke()})}}]),AutoTimer}(m.AutoComponent);AutoTimer=v([m.AutoComponent.register],AutoTimer),e.AutoTimer=AutoTimer;var AutoRandom=function(t){function AutoRandom(){return(0,o.default)(this,AutoRandom),(0,l.default)(this,(AutoRandom.__proto__||Object.getPrototypeOf(AutoRandom)).apply(this,arguments))}return(0,d.default)(AutoRandom,t),(0,s.default)(AutoRandom,[{key:"addedToScene",value:function(){(0,h.default)(AutoRandom.prototype.__proto__||Object.getPrototypeOf(AutoRandom.prototype),"addedToScene",this).call(this);var t=this.entity.find(_.Graphic);if(void 0!==this.opts.colorIntensity&&t){var e=w.Calc.range(this.opts.colorIntensity);t.color.r+=e,t.color.g+=e,t.color.b+=e,t.color.r=w.Calc.clamp(t.color.r),t.color.g=w.Calc.clamp(t.color.g),t.color.b=w.Calc.clamp(t.color.b)}this.opts.scale&&t&&t.scale.mult(Math.abs(w.Calc.range(this.opts.scale)))}}]),AutoRandom}(m.AutoComponent);AutoRandom=v([m.AutoComponent.register],AutoRandom),e.AutoRandom=AutoRandom;var AutoTween=function(t){function AutoTween(){return(0,o.default)(this,AutoTween),(0,l.default)(this,(AutoTween.__proto__||Object.getPrototypeOf(AutoTween)).apply(this,arguments))}return(0,d.default)(AutoTween,t),(0,s.default)(AutoTween,[{key:"addedToScene",value:function(){this.onComplete=new x.EventDelegate(this.opts.onComplete,this.entity),this.graphic=this.entity.find(_.Graphic),(0,h.default)(AutoTween.prototype.__proto__||Object.getPrototypeOf(AutoTween.prototype),"addedToScene",this).call(this),(void 0===this.opts.autoPlay||this.opts.autoPlay)&&this.play()}},{key:"play",value:function(){var t=this,e=w.Ease[this.opts.ease||"linear"],n=void 0,i=void 0;i="scale"===this.opts.mode&&void 0===this.opts.from&&this.graphic?this.graphic.scale.x:void 0!==this.opts.from?this.opts.from:0;var r=void 0!==this.opts.to?this.opts.to:0,o=this.opts.duration,a=this.entity.find(_.Graphic);switch(this.opts.mode){case"scale":n=function(t){a.scale.set(t,t)};break;case"alpha":n=function(t){a.alpha=t};break;case"moveY":i=a.entity.y,r=a.entity.y+this.opts.to,n=function(t){a.entity.y=t};break;default:throw Error("unimplemented AutoTween mode '"+this.opts.mode+"'")}this.activeTween=b.Tween.create(this.entity).start(o,i,r,e,n).setOnComplete(function(){t.activeTween=null,t.onComplete.invoke()}),this.opts.delay?g.Alarm.create(this.entity).start(this.opts.delay,function(){t.activeTween&&(n(i),t.activeTween.restart())}):(n(i),this.activeTween.restart())}}]),AutoTween}(m.AutoComponent);AutoTween=v([m.AutoComponent.register],AutoTween),e.AutoTween=AutoTween},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(4),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u),c=n(2),h=i(c),f=n(3),d=i(f);Object.defineProperty(e,"__esModule",{value:!0});var p=n(27),y=n(10),v=n(41),m=n(20),g=n(15),_=n(119),b=n(120),ParticleSystem=function(t){function ParticleSystem(t){(0,s.default)(this,ParticleSystem);var e=(0,h.default)(this,(ParticleSystem.__proto__||Object.getPrototypeOf(ParticleSystem)).call(this));return e.renderRelativeToEntity=!1,e.particles=[],"object"===(void 0===t?"undefined":(0,o.default)(t))&&(t=t.template),e.templateName=t,e}return(0,d.default)(ParticleSystem,t),(0,l.default)(ParticleSystem,[{key:"update",value:function(){for(var t=y.Engine.delta,e=this.particles.length-1;e>=0;e--){var n=this.particles[e];n.percent>=1?(this.particles.splice(e,1),ParticleSystem.cache.push(n)):(n.percent=Math.min(1,n.percent+t/n.duration),n.x+=n.speedX*t,n.y+=n.speedY*t,n.speedX+=n.accelX*t,n.speedY+=n.accelY*t,n.speedX=v.Calc.approach(n.speedX,0,n.frictionX*t),n.speedY=v.Calc.approach(n.speedY,0,n.frictionY*t))}}},{key:"render",value:function(t){var e=this.template.texture;if(null==e&&(e=y.Engine.graphics.pixel),null==e)throw Error("Particle requires a Texture");var n=this.position;this.renderRelativeToEntity&&(n=this.scenePosition);var i=this.template,r=!0,o=!1,a=void 0;try{for(var s,u=this.particles[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=s.value,c=l.percent,h=n.x+l.x,f=n.y+l.y,d=l.scaleFromX+(l.scaleToX-l.scaleFromX)*i.scaleXEaser(c),p=l.scaleFromY+(l.scaleToY-l.scaleFromY)*i.scaleYEaser(c),v=l.rotationFrom+(l.rotationTo-l.rotationFrom)*i.rotationEaser(c),m=l.alphaFrom+(l.alphaTo-l.alphaFrom)*i.alphaEaser(c),g=ParticleSystem.color.lerp(l.colorFrom,l.colorTo,i.colorEaser(c)).mult(m);y.Engine.graphics.texture(e,h,f,null,g,ParticleSystem.origin,ParticleSystem.scale.set(d,p),v)}}catch(t){o=!0,a=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw a}}}},{key:"burst",value:function(t,e,n,i,r,o){var a=this.template;void 0!==i&&null!==i||(i=0),void 0!==r&&null!==r||(r=0),void 0===o&&(o=1);for(var s=0;s<o;s++){var u=a.durationBase+v.Calc.range(a.durationRange);if(!(u<=0)){var l=null;l=ParticleSystem.cache.length>0?ParticleSystem.cache.splice(0,1)[0]:new _.Particle;var c=a.speedBase+v.Calc.range(a.speedRange);l.percent=0,l.duration=u,l.x=this.scenePosition.x+t+v.Calc.range(i),l.y=this.scenePosition.y+e+v.Calc.range(r),l.colorFrom=v.Calc.choose(a.colorsFrom),l.colorTo=v.Calc.choose(a.colorsTo),l.speedX=Math.cos(n)*c,l.speedY=-Math.sin(n)*c,l.accelX=a.accelBaseX+v.Calc.range(a.accelRangeX),l.accelY=a.accelBaseY+v.Calc.range(a.accelRangeY),l.frictionX=a.frictionBaseX+v.Calc.range(a.frictionRangeX),l.frictionY=a.frictionBaseY+v.Calc.range(a.frictionRangeY),l.scaleFromX=a.scaleFromBaseX+v.Calc.range(a.scaleFromRangeX),l.scaleFromY=a.scaleFromBaseY+v.Calc.range(a.scaleFromRangeY),l.scaleToX=a.scaleToBaseX+v.Calc.range(a.scaleToRangeX),l.scaleToY=a.scaleToBaseY+v.Calc.range(a.scaleToRangeY),l.rotationFrom=a.rotationFromBase+v.Calc.range(a.rotationFromRange),l.rotationTo=a.rotationToBase+v.Calc.range(a.rotationToRange),l.alphaFrom=a.alphaFromBase+v.Calc.range(a.alphaFromRange),l.alphaTo=a.alphaToBase+v.Calc.range(a.alphaToRange),this.particles.push(l)}}}},{key:"template",get:function(){return b.ParticleTemplate.templates[this.templateName]}},{key:"numActiveParticles",get:function(){return this.particles.length}},{key:"activeParticles",get:function(){return this.particles}}]),ParticleSystem}(p.Component);ParticleSystem.cache=[],ParticleSystem.color=new m.Color,ParticleSystem.origin=new g.Vector(.5,.5),ParticleSystem.scale=new g.Vector(0,0),e.ParticleSystem=ParticleSystem},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var m=n(8),g=n(16),_=n(14),b=n(21),DiesOnCollision=function(t){function DiesOnCollision(){(0,o.default)(this,DiesOnCollision);var t=(0,l.default)(this,(DiesOnCollision.__proto__||Object.getPrototypeOf(DiesOnCollision)).apply(this,arguments));return t.done=!1,t}return(0,d.default)(DiesOnCollision,t),(0,s.default)(DiesOnCollision,[{key:"addedToScene",value:function(){var t=this;(0,h.default)(DiesOnCollision.prototype.__proto__||Object.getPrototypeOf(DiesOnCollision.prototype),"addedToScene",this).call(this),this.onDie=new b.EventDelegate(this.opts.onDie,this.entity),this.physics.onCollide.push(function(e,n){t.done||(t.done=!0,t.opts.particlesPrefab&&t.scene.add(g.instantiatePrefab(t.opts.particlesPrefab,null,t.physics.sceneCenterX,t.physics.sceneCenterY)),t.onDie.invoke(),t.entity.destroyLater())})}}]),DiesOnCollision}(m.AutoComponent);v([m.AutoComponent.require,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",_.Physics)],DiesOnCollision.prototype,"physics",void 0),DiesOnCollision=v([m.AutoComponent.register],DiesOnCollision),e.DiesOnCollision=DiesOnCollision},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(8),m=n(23),g=n(9);n(13);var Dragon=function(t){function Dragon(){return(0,o.default)(this,Dragon),(0,l.default)(this,(Dragon.__proto__||Object.getPrototypeOf(Dragon)).apply(this,arguments))}return(0,d.default)(Dragon,t),(0,s.default)(Dragon,[{key:"addedToScene",value:function(){(0,h.default)(Dragon.prototype.__proto__||Object.getPrototypeOf(Dragon.prototype),"addedToScene",this).call(this),this.sprite=this.entity.find(g.Sprite),this.trigger=this.entity.find(m.Trigger),this.freezable=this.entity.find(m.Freezable)}},{key:"wakeUp",value:function(){var t=this;this.freezable.onAfterUnfreeze(function(){return t._wakeUpAfterFreeze()})}},{key:"_wakeUpAfterFreeze",value:function(){this.sprite.play("awake"),this.trigger.active=!0,this.entity.getComponentByName("bubble").removeSelf(),this.entity.getComponentByName("exclaim").emit(),this.freezable.setExcept(-1,0)}}]),Dragon}(v.AutoComponent);Dragon=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([v.AutoComponent.register],Dragon),e.Dragon=Dragon},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(6),m=n(12),g=n(16),_=n(85),b=n(122),w=n(21),x=n(8),Emitter=function(t){function Emitter(t){(0,o.default)(this,Emitter);var e=(0,l.default)(this,(Emitter.__proto__||Object.getPrototypeOf(Emitter)).call(this,t));return e.prefab=e.opts.prefab,e.onEmit=new w.EventDelegate(e.opts.onEmit),e}return(0,d.default)(Emitter,t),(0,s.default)(Emitter,[{key:"addedToScene",value:function(){(0,h.default)(Emitter.prototype.__proto__||Object.getPrototypeOf(Emitter.prototype),"addedToScene",this).call(this),this.onEmit.bind(this.entity)}},{key:"emit",value:function(){if(this.active){var t=this.sceneX,e=this.sceneY,n=g.instantiatePrefab(this.prefab,new v.Entity(t,e)),i=n.find(m.Collider);i&&i.blacklistedEntities.push(this.entity);var r=this.entity.find(b.Flip),o=n.find(_.Mover);r&&r.flipX&&o&&(o.opts={x:-o.opts.x,y:o.opts.y}),this.scene.add(n),this.onEmit.invoke()}}}]),Emitter}(x.AutoComponent);Emitter=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([x.AutoComponent.register,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:paramtypes",[Object])],Emitter),e.Emitter=Emitter},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},m=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var g=n(6),_=n(12),b=n(9),w=n(8),x=n(17),k=n(34);n(13);var Exit=function(t){function Exit(){(0,o.default)(this,Exit);var t=(0,l.default)(this,(Exit.__proto__||Object.getPrototypeOf(Exit)).apply(this,arguments));return t.isOpen=!1,t.triggered=!1,t}return(0,d.default)(Exit,t),(0,s.default)(Exit,[{key:"addedToScene",value:function(){(0,h.default)(Exit.prototype.__proto__||Object.getPrototypeOf(Exit.prototype),"addedToScene",this).call(this),this.sprite.play("closed")}},{key:"update",value:function(){if(!this.isOpen&&0===this.scene.allCollidersInTag("treasure").length)return this.isOpen=!0,this.sprite.play("open"),void this.hitbox.untag(x.Game.TAGS.SOLID);var t=this.hitbox.collide(x.Game.TAGS.PLAYER);if(!this.triggered&&this.isOpen&&t){t.entity.find(k.PlayerEffects).exiting=!0,this.triggered=!0,this.level&&this.level.nextLevel()}}}]),Exit}(w.AutoComponent);v([g.Component.require,m("design:type",b.Sprite)],Exit.prototype,"sprite",void 0),v([g.Component.require,m("design:type",_.Hitbox)],Exit.prototype,"hitbox",void 0),Exit=v([w.AutoComponent.register],Exit),e.Exit=Exit},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c),f=n(4),d=i(f),p=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},y=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var v=n(8),m=n(9),g=n(7),_=n(6);n(13);var Facing=b=function(t){function Facing(t){(0,o.default)(this,Facing);var e=(0,l.default)(this,(Facing.__proto__||Object.getPrototypeOf(Facing)).call(this,t));e.myCount=-1;var n=b._count++;return e.myCount=n%5+2,e}return(0,h.default)(Facing,t),(0,s.default)(Facing,[{key:"findClosestPlayerHitbox",value:function(){var t=this.scene.allCollidersInTag("player");if(0!==t.length)return g.Vector.temp0.set(this.sprite.sceneCenterX,this.sprite.sceneCenterY),t.sort(function(t,e){return g.Vector.distance(t.getScenePosition(g.Vector.temp1),e.getScenePosition(g.Vector.temp2))}),t[0]}},{key:"update",value:function(){if(0==_.Engine.frameCount%this.myCount){var t=this.findClosestPlayerHitbox();if(t){this.sprite.flipX=t.sceneCenterX>this.sprite.sceneCenterX;var e=this.sprite.randomStartFrame;this.sprite.play(Math.abs(t.sceneCenterX-this.sprite.sceneCenterX)<24?"face_in":"face_out",!1,{randomFrame:e})}}}}]),Facing}(v.AutoComponent);Facing._count=0,p([v.AutoComponent.require,y("design:type",m.Sprite)],Facing.prototype,"sprite",void 0),Facing=b=p([v.AutoComponent.register,y("design:paramtypes",[Object])],Facing),e.Facing=Facing;var b},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var m=n(6),g=n(14),_=n(7);n(13);var Floats=function(t){function Floats(){(0,o.default)(this,Floats);var t=(0,l.default)(this,(Floats.__proto__||Object.getPrototypeOf(Floats)).apply(this,arguments));return t.floatTime=1.64,t.lastLeft=-1,t.lastTop=-1,t.timeToFloat=1e3,t}return(0,d.default)(Floats,t),(0,s.default)(Floats,[{key:"addedToScene",value:function(){(0,h.default)(Floats.prototype.__proto__||Object.getPrototypeOf(Floats.prototype),"addedToScene",this).call(this)}},{key:"updateOld",value:function(){var t=this;if(this.lastLeft===this.physics.sceneLeft&&this.lastTop===this.physics.sceneTop&&this.physics.check("water")?this.timeToFloat-=m.Engine.delta:this.timeToFloat=this.floatTime,this.timeToFloat<=0){this.timeToFloat=this.floatTime;var e=this.scenePosition,n=_.Ease.linear;g.Tween.create(this.entity).start(.5,e.x,e.x+24,n,function(e){t.physics.moveX(e-t.physics.scenePosition.x)},!0).restart()}this.lastLeft=this.physics.sceneLeft,this.lastTop=this.physics.sceneTop}}]),Floats}(m.Component);v([m.Component.require,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",g.Physics)],Floats.prototype,"physics",void 0),Floats=v([m.Component.register],Floats),e.Floats=Floats},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(0),s=i(a),u=n(1),l=i(u),c=n(2),h=i(c),f=n(5),d=i(f),p=n(3),y=i(p),v=n(4),m=i(v),g=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,m.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},_=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,m.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var b=n(8),w=n(118),x=n(29),k=n(6),E=n(7),O=n(12),S=n(14),T=n(45),C=n(14),P=n(9),A=n(21);n(13);var Medusa=function(t){function Medusa(){(0,s.default)(this,Medusa);var t=(0,h.default)(this,(Medusa.__proto__||Object.getPrototypeOf(Medusa)).apply(this,arguments));return t.lastKillTime=-1e3,t.triggered=!1,t.didTrigger=!1,t}return(0,y.default)(Medusa,t),(0,l.default)(Medusa,[{key:"update",value:function(){if(this.awareness.killing.length>0){this.lastKillTime=k.Engine.elapsed,this.sprite.play("fire");var t=!0,e=!1,n=void 0;try{for(var i,r=this.awareness.killing[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var a=(0,o.default)(i.value,2),s=a[0],u=a[1];this.triggerDeath(s,u)}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}else this.awareness.wouldKill||k.Engine.elapsed-this.lastKillTime<1?this.sprite.play("fire"):-1!==this.awareness.xrayGroups.indexOf("player")?this.sprite.play("alert"):this.sprite.play("asleep")}},{key:"addedToScene",value:function(){(0,d.default)(Medusa.prototype.__proto__||Object.getPrototypeOf(Medusa.prototype),"addedToScene",this).call(this),this.onShoot=new A.EventDelegate(this.opts.onShoot,this.entity)}},{key:"sendRoots",value:function(t,e){var n=this,i=this.sprite.sceneBounds,r=i.left,o=i.right,a=i.top,s=i.bottom,u=new k.Entity,l=T.SpriteBank.get("root").animations,c=void 0,h=void 0,f=void 0,d=!1,p=!1,y=void 0,v=void 0;switch(e){case"left":f="right",h=l[f].frames[0].width,c=Math.floor((r-t.sceneCenterX)/h)+1,d=!0,y=function(t){return r-h*t},v=function(t){return a};break;case"right":f="right",h=l[f].frames[0].width,c=Math.floor((t.sceneCenterX-o)/h)+2,d=!1,y=function(t){return o-h+h*t},v=function(t){return a};break;case"up":f="down",h=l[f].frames[0].height,c=Math.floor((a-t.sceneCenterY)/h)+1,p=!0,y=function(t){return r},v=function(t){return a-h*t};break;case"down":f="down",h=l[f].frames[0].height,c=Math.floor((t.sceneCenterY-s)/h)+2,y=function(t){return r},v=function(t){return s-h-3+h*t}}C.Alarm.create(this.entity).start(.3,function(){var e=new k.Entity,i=e.add(new P.Sprite({animation:"rootcrown",play:"grow"}));i.sceneCenterX=t.sceneCenterX-3,i.sceneCenterY=t.sceneCenterY-9,n.scene.add(e)});for(var m=0;m<c;++m)!function(t){var e=u.add(new P.Sprite({x:y(t),y:v(t),animation:"root",flipX:d,flipY:p,rate:3.2,visible:!1})),i=.35*t/3.2;C.Alarm.create(n.entity).start(i,function(){e.visible=!0,e.play(f,!0,{randomFrame:!1})})}(m);this.scene.add(u),this.onShoot.invoke()}},{key:"triggerDeath",value:function(t,e){this.didTrigger=!0;var n=t.entity;if(n instanceof x.Player)this.sendRoots(t,e),n.kill();else if("grey_orb"===n.name){n.find(P.Sprite).play("disintegrate",!0,{randomFrame:!1}),n.ungroup("player"),n.findAll(O.Collider).forEach(function(t){return t.untag("player")});var i=n.find(P.Sprite);C.Alarm.create(n).start(.31,function(){return n.scene.remove(n)}),S.Tween.create(n).start(.3,1,0,E.Ease.linear,function(t){i.alpha=t},!0).restart()}else n.scene.remove(n)}}]),Medusa}(b.AutoComponent);g([b.AutoComponent.require,_("design:type",P.Sprite)],Medusa.prototype,"sprite",void 0),g([b.AutoComponent.require,_("design:type",w.Awareness)],Medusa.prototype,"awareness",void 0),Medusa=g([b.AutoComponent.register],Medusa),e.Medusa=Medusa},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(6),m=n(14),g=n(9),_=n(12),b=n(7),w=n(17),x=n(23),k=n(58),E=n(8),O=n(29),Pushable=function(t){function Pushable(){(0,o.default)(this,Pushable);var t=(0,l.default)(this,(Pushable.__proto__||Object.getPrototypeOf(Pushable)).apply(this,arguments));return t.tileWidth=24,t.tileHeight=24,t.pushCounter=new b.Vector,t.lastFloatingTime=-100,t._dest=new b.Vector,t._startPos=new b.Vector,t}return(0,d.default)(Pushable,t),(0,s.default)(Pushable,[{key:"addedToScene",value:function(){(0,h.default)(Pushable.prototype.__proto__||Object.getPrototypeOf(Pushable.prototype),"addedToScene",this).call(this),w.Game.TAGS.SOLID,w.Game.TAGS.PLAYER,this.physics=this.entity.find(m.Physics),this.physics,this.entity.add(this.hitbox=new _.Hitbox({left:-1,top:-1,width:this.tileWidth+2,height:this.tileHeight+2,tags:[]}))}},{key:"play_sound",value:function(){this.opts.soundEffectName&&this.playOneShot(this.opts.soundEffectName)}},{key:"debugRender",value:function(t){(0,h.default)(Pushable.prototype.__proto__||Object.getPrototypeOf(Pushable.prototype),"debugRender",this).call(this,t),this._dest&&(v.Engine.graphics.rect(this._dest.x,this._dest.y,3,3,new b.Color(0,0,0,1)),v.Engine.graphics.rect(180,this._dest.y,1,12,new b.Color(1,0,0,1)))}},{key:"_triggerSink",value:function(){var t=this;this.physics.untagAll();var e=this.physics.entity.find(g.Graphic),n=b.Vector.temp0.copy(e.scale);this.activeTween=m.Tween.create(this.entity).start(1.5,1,0,b.Ease.linear,function(t){e.scale.copy(n).mult(t)},!0).setOnComplete(function(){t.destroyEntity()}).restart()}},{key:"moveThroughWater",value:function(){if(this.level){var t=this.level.waterFlow,e={isEnd:!1};if(t.trackObjectAndGetDestination(this.physics,this._dest,e)){var n=this.physics,i=n.sceneCenterX,r=n.sceneCenterY,o=this._dest.x-i,a=this._dest.y-r,s=Math.sign(o),u=Math.sign(a);Math.abs(o)>Math.abs(a)?u=0:Math.abs(a)>Math.abs(o)&&(s=0);var l=t.currentStrength*v.Engine.delta;s*=l,u*=l;var c=this.physics.entity.find(x.Freezable);if(c&&c.stayFrozen(),0!==s||0!==u){var h=this.physics.collide("player",0,0);return h&&h.entity.find(m.Physics).move(s,u),this.physics.move(s,u),!0}}}}},{key:"updatePushCounterFromPlayer",value:function(){var t=this.hitbox.collide(w.Game.TAGS.PLAYER,void 0,void 0);if(!(t&&t.entity instanceof O.Player))return void this.pushCounter.set(0,0);var e=t.entity.find(m.Physics),n=t.entity.find(k.TopDownControls),i=n.addedSpeed,r=Math.sign(i.x),o=Math.sign(i.y);0!==i.x&&0!==i.y&&(r=0,o=0);var a=e.sceneBounds,s=this.physics.sceneBounds;(r>0&&a.centerX>s.centerX||r<0&&a.centerX<s.centerX)&&(r=0),(o>0&&a.centerY>s.centerY||o<0&&a.centerY<s.centerY)&&(o=0),0===r||s.overlapsVertically(a)||(r=0),0===o||s.overlapsHorizontally(a)||(o=0),this.pushCounter.set(0===r?0:this.pushCounter.x+v.Engine.delta*r,0===o?0:this.pushCounter.y+v.Engine.delta*o)}},{key:"update",value:function(){var t=this;if((0,h.default)(Pushable.prototype.__proto__||Object.getPrototypeOf(Pushable.prototype),"update",this).call(this),!this.activeTween&&this.physics&&(!this.physics.check("water")||!this.moveThroughWater())){this.updatePushCounterFromPlayer();var e=b.Ease.sineInOut,n=this.scenePosition,i=[w.Game.TAGS.SOLID,"enemy_solid"];if(Math.abs(this.pushCounter.x)>this.threshold){var r=Math.sign(this.pushCounter.x)*this.tileWidth,o=this.physics.collideAllMulti(i,r,0);this.isBlocked(o)||(this.play_sound(),this.activeTween=m.Tween.create(this.entity).start(.42,n.x,n.x+r,e,function(e){t.physics.moveX(e-t.scenePosition.x)},!0).setOnComplete(function(){t.activeTween=void 0}).restart(),this.pushCounter.x=0)}if(Math.abs(this.pushCounter.y)>this.threshold){var a=Math.sign(this.pushCounter.y)*this.tileHeight,s=this.physics.collideAllMulti(i,0,a);this.isBlocked(s)||(this.play_sound(),this.activeTween=m.Tween.create(this.entity).start(.42,n.y,n.y+a,e,function(e){t.physics.moveY(e-t.scenePosition.y)},!0).setOnComplete(function(){t.activeTween=void 0}).restart(),this.pushCounter.y=0)}}}},{key:"isBlocked",value:function(t){var e=!0,n=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(e=(r=o.next()).done);e=!0)if(r.value.entity!==this.entity)return!0}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}return!1}},{key:"threshold",get:function(){return void 0===this.opts.threshold?.5:this.opts.threshold}}]),Pushable}(E.AutoComponent);Pushable=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([E.AutoComponent.register],Pushable),e.Pushable=Pushable},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c),f=n(4),d=i(f),p=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},y=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var v=n(6),m=n(9),g=n(57);n(13);var GraphicHitEffect=function(t){function GraphicHitEffect(t){var e=t.deathAnim;(0,o.default)(this,GraphicHitEffect);var n=(0,l.default)(this,(GraphicHitEffect.__proto__||Object.getPrototypeOf(GraphicHitEffect)).call(this));return n.playedDead=!1,n.deathAnim=e,n}return(0,h.default)(GraphicHitEffect,t),(0,s.default)(GraphicHitEffect,[{key:"update",value:function(){var t=!0;this.health.invincible&&(t=v.Engine.frameCount%2==0),!this.playedDead&&this.deathAnim&&this.health.dead&&(this.playedDead=!0,this.graphic.play(this.deathAnim)),this.graphic.visible=t}}]),GraphicHitEffect}(v.Component);p([v.Component.require,y("design:type",m.Graphic)],GraphicHitEffect.prototype,"graphic",void 0),p([v.Component.require,y("design:type",g.Health)],GraphicHitEffect.prototype,"health",void 0),GraphicHitEffect=p([v.Component.register,y("design:paramtypes",[Object])],GraphicHitEffect),e.GraphicHitEffect=GraphicHitEffect},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(8),m=n(9),g=n(7),_=n(6),b=n(12),w=n(16),x=n(29),k=n(34),E=n(82),Laser=function(t){function Laser(){(0,o.default)(this,Laser);var t=(0,l.default)(this,(Laser.__proto__||Object.getPrototypeOf(Laser)).apply(this,arguments));return t.entityHitTimes=new Map,t}return(0,d.default)(Laser,t),(0,s.default)(Laser,[{key:"addedToScene",value:function(){(0,h.default)(Laser.prototype.__proto__||Object.getPrototypeOf(Laser.prototype),"addedToScene",this).call(this),this.graphic=this.entity.find(m.Graphic);var t=this.graphic,e=t.width,n=t.height,i=this.rectsprite=this.entity.add(new m.Rectsprite(2,this.opts.length,g.Color.red));i.position.set(e/2-1,n/2+1),this.scene.add(w.instantiatePrefab(this.opts.impactPrefab,null,i.sceneX+i.width/2,i.sceneY+this.opts.length)),this.hitbox=this.entity.add(new b.Hitbox({left:i.x,top:i.y,width:i.width,height:i.height}))}},{key:"update",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.hitbox.collideAll("player")[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;x.Player.isPlayerOrb(o)&&this.transmorgify(o)}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}},{key:"transmorgify",value:function(t){if(!(this.entityHitTimes.has(t.entity)&&_.Engine.elapsed-this.entityHitTimes.get(t.entity)<2)){var e=t.entity.find(k.PlayerEffects);e&&(this.entityHitTimes.set(t.entity,_.Engine.elapsed),e.toggleEffect(k.EffectType.WalkBackwards),this.scene.add(w.instantiatePrefab("red_laser_absorb",null,t.sceneCenterX,t.sceneCenterY)).find(E.ParticleAttractor).target=t)}}},{key:"removedFromScene",value:function(){this.entity.remove(this.rectsprite),this.rectsprite=void 0}}]),Laser}(v.AutoComponent);Laser=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([v.AutoComponent.register],Laser),e.Laser=Laser},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},m=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var g=n(6),_=n(14),b=n(12),w=n(7),x=n(57);n(13);var KnockBack=function(t){function KnockBack(){(0,o.default)(this,KnockBack);var t=(0,l.default)(this,(KnockBack.__proto__||Object.getPrototypeOf(KnockBack)).apply(this,arguments));return t.factor=3.4,t.speed=new w.Vector,t}return(0,d.default)(KnockBack,t),(0,s.default)(KnockBack,[{key:"addedToScene",value:function(){var t=this;(0,h.default)(KnockBack.prototype.__proto__||Object.getPrototypeOf(KnockBack.prototype),"addedToScene",this).call(this),this.health.onDamage.push(function(e){if(t.speed.set(0,0),e){var n=e.entity.find(b.Hitbox);if(n){var i=w.Vector.temp0.set(n.sceneLeft+n.width/2,n.sceneTop+n.height/2);t.speed.copy(t.entity.position).sub(i).normalize().mult(100).mult(t.factor)}t.physics.speed.add(t.speed)}})}}]),KnockBack}(g.Component);v([g.Component.require,m("design:type",x.Health)],KnockBack.prototype,"health",void 0),v([g.Component.require,m("design:type",_.Physics)],KnockBack.prototype,"physics",void 0),KnockBack=v([g.Component.register],KnockBack),e.KnockBack=KnockBack},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(2),s=i(a),u=n(3),l=i(u),c=n(4),h=i(c);Object.defineProperty(e,"__esModule",{value:!0});var f=n(8),ParentEntity=function(t){function ParentEntity(t){(0,o.default)(this,ParentEntity);var e=(0,s.default)(this,(ParentEntity.__proto__||Object.getPrototypeOf(ParentEntity)).call(this,t));return e.parent=t.parent,e}return(0,l.default)(ParentEntity,t),ParentEntity}(f.AutoComponent);ParentEntity=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,h.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([f.AutoComponent.register,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,h.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:paramtypes",[Object])],ParentEntity),e.ParentEntity=ParentEntity},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(8),m=n(6),g=n(46);n(13);var ParticleLoop=function(t){function ParticleLoop(){return(0,o.default)(this,ParticleLoop),(0,l.default)(this,(ParticleLoop.__proto__||Object.getPrototypeOf(ParticleLoop)).apply(this,arguments))}return(0,d.default)(ParticleLoop,t),(0,s.default)(ParticleLoop,[{key:"addedToScene",value:function(){(0,h.default)(ParticleLoop.prototype.__proto__||Object.getPrototypeOf(ParticleLoop.prototype),"addedToScene",this).call(this),this.pSys=this.entity.find(g.ParticleSystem),this.pSys||(this.pSys=this.entity.add(new g.ParticleSystem(this.opts.template))),this.pSys.template.name,this.opts.template}},{key:"update",value:function(){m.Engine.elapsed,this.rate}},{key:"rate",get:function(){return void 0===this.opts.rate?50:this.opts.rate}}]),ParticleLoop}(v.AutoComponent);ParticleLoop=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([v.AutoComponent.register],ParticleLoop),e.ParticleLoop=ParticleLoop},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(11),o=i(r),a=n(2),s=i(a),u=n(5),l=i(u),c=n(3),h=i(c),f=n(0),d=i(f),p=n(1),y=i(p),v=n(4),m=i(v),g=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,m.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var _=n(8),b=n(6),w=n(7),x=n(116),k=n(12),E=n(29),O=0,S=function(){function t(e,n){(0,d.default)(this,t),this.data=[];for(var i=0;i<n;++i){for(var r=[],o=0;o<e;++o)r.push(O);this.data.push(r)}}return(0,y.default)(t,[{key:"set",value:function(t,e,n){this.data[e][t]=n}},{key:"clear",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.data[Symbol.iterator]();!(t=(i=r.next()).done);t=!0)for(var o=i.value,a=0;a<o.length;++a)o[a]=O}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}}]),t}(),PathfinderMap=function(t){function PathfinderMap(){(0,d.default)(this,PathfinderMap);var t=(0,s.default)(this,(PathfinderMap.__proto__||Object.getPrototypeOf(PathfinderMap)).apply(this,arguments));return t.dirty=!0,t}return(0,h.default)(PathfinderMap,t),(0,y.default)(PathfinderMap,[{key:"addedToScene",value:function(){if((0,l.default)(PathfinderMap.prototype.__proto__||Object.getPrototypeOf(PathfinderMap.prototype),"addedToScene",this).call(this),!this.level)throw Error("only makes sense in a scene")}},{key:"getPath",value:function(t,e,n,i){this.loadData();var r=this.astar.getNode(t,e),o=this.astar.getNode(n,i);return this.astar.path(r,o)}},{key:"debugRender",value:function(){this.loadData();for(var t=0;t<this.map.data.length;++t)for(var e=this.map.data[t],n=0;n<e.length;++n)e[n]>0&&b.Engine.graphics.rect(24*n,24*t,24,24,new w.Color(1,0,0,.3))}},{key:"loadData",value:function(){if(!this.map){var t=(0,o.default)(this.level.terrainSize,2),e=t[0],n=t[1];this.map=new S(e,n),this.dirty=!0}if(this.astar||(this.astar=new M(new R)),this.dirty){this.map.clear(),this.astar.clearMarkedSolid();var i=!0,r=!1,a=void 0;try{for(var s,u=this.level.solidHitgrids[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value,c=!0,h=!1,f=void 0;try{for(var d,p=l.tiles()[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var y=(0,o.default)(d.value,2),v=y[0],m=y[1];this.map.set(v,m,1e7)}}catch(t){h=!0,f=t}finally{try{!c&&p.return&&p.return()}finally{if(h)throw f}}}}catch(t){r=!0,a=t}finally{try{!i&&u.return&&u.return()}finally{if(r)throw a}}this.dirty=!1;var g=this.level.allCollidersInTag("solid"),_=!0,b=!1,w=void 0;try{for(var x,E=g[Symbol.iterator]();!(_=(x=E.next()).done);_=!0){var O=x.value;if(O instanceof k.Hitbox){var T=!0,C=!1,P=void 0;try{for(var A,j=this.level.hitgridSquaresForHitbox(O)[Symbol.iterator]();!(T=(A=j.next()).done);T=!0){var L=(0,o.default)(A.value,2),F=L[0],D=L[1];this.astar.setSolid(F,D)}}catch(t){C=!0,P=t}finally{try{!T&&j.return&&j.return()}finally{if(C)throw P}}}}}catch(t){b=!0,w=t}finally{try{!_&&E.return&&E.return()}finally{if(b)throw w}}this.astar.load(this.map.data)}return this.map}}]),PathfinderMap}(_.AutoComponent);PathfinderMap=g([_.AutoComponent.register],PathfinderMap),e.PathfinderMap=PathfinderMap;var Pathfinder=function(t){function Pathfinder(){(0,d.default)(this,Pathfinder);var t=(0,s.default)(this,(Pathfinder.__proto__||Object.getPrototypeOf(Pathfinder)).apply(this,arguments));return t._pauseTimer=0,t.once=!1,t}return(0,h.default)(Pathfinder,t),(0,y.default)(Pathfinder,[{key:"ensurePathfinderMap",value:function(){var t=this.level.firstInGroup("pathfinder");t?this.pathfinderMap=t.find(PathfinderMap):(t=new b.Entity,t.group("pathfinder"),this.pathfinderMap=t.add(new PathfinderMap({})),this.level.add(t))}},{key:"addedToScene",value:function(){(0,l.default)(Pathfinder.prototype.__proto__||Object.getPrototypeOf(Pathfinder.prototype),"addedToScene",this).call(this),this.ensurePathfinderMap(),this.physics=this.entity.find(x.Physics)}},{key:"getTilemapCoords",value:function(){return this.level.tilemapCoords(this)}},{key:"pathTo",value:function(t,e){var n=[Math.floor(this.physics.sceneCenterX/24),Math.floor(this.physics.sceneCenterY/24)],i=n[0],r=n[1];return this.pathfinderMap.getPath(i,r,t,e)}},{key:"update",value:function(){if(!this.headingTowards)if(this._pauseTimer>0)this._pauseTimer-=E.Player.movementLastFrame;else{var t=this.level.firstColliderInTag("player");if(t){var e=[Math.floor(t.sceneCenterX/24),Math.floor(t.sceneCenterY/24)],n=e[0],i=e[1],r=this.path=this.pathTo(n,i);r&&r.length<2?this._pauseTimer=1:this.headingTowards=[r[1].x,r[1].y]}}if(this.headingTowards){var a=(0,o.default)(this.headingTowards,2),s=a[0],u=a[1];s=24*s+12,u=24*u+12;var l=[this.physics.sceneCenterX,this.physics.sceneCenterY],c=l[0],h=l[1],f=s-c,d=u-h;Math.abs(f)<1&&Math.abs(d)<1?(this.headingTowards=void 0,this._pauseTimer=this.pauseTime):Math.abs(f)>Math.abs(d)?this.move(Math.sign(f),0):this.move(0,Math.sign(d))}}},{key:"move",value:function(t,e){this.physics.move(t*this.speed,e*this.speed)}},{key:"debugRender",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,r=this.path[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value,a=24*o.x,s=24*o.y;b.Engine.graphics.rect(a+6,s+6,12,12,w.Color.white)}}catch(t){e=!0,n=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw n}}}},{key:"pauseTime",get:function(){return void 0===this.opts.pauseTime?.3:this.opts.pauseTime}},{key:"speed",get:function(){return void 0===this.opts.speed?.7:this.opts.speed}}]),Pathfinder}(_.AutoComponent);Pathfinder=g([_.AutoComponent.register],Pathfinder),e.Pathfinder=Pathfinder;var T=function(){function t(e,n,i,r){(0,d.default)(this,t),this.x=e,this.y=n,this.z=i,this.weight=r,this.connections=[]}return(0,y.default)(t,[{key:"getConnections",value:function(){return this.connections}},{key:"connectTo",value:function(t){this.connections.push(t)}}]),t}(),C=function(){function t(){(0,d.default)(this,t),this.nodes=[],this._markedSolidSet={}}return(0,y.default)(t,[{key:"clearMarkedSolid",value:function(){this._markedSolidSet={}}},{key:"getNode",value:function(t,e){for(var n=0;n<this.nodes.length;n++){var i=this.nodes[n];if(i.x==t&&i.y==e)return i}return null}},{key:"getNodes",value:function(){return this.nodes}},{key:"markedSolid",value:function(t,e){return t+"_"+e}},{key:"setSolid",value:function(t,e){this._markedSolidSet[t+"_"+e]=!0}},{key:"fromArray",value:function(t){this.nodes=[];for(var e=t[0].length,n=t.length,i=0;i<n;i++)for(var r=0;r<e;r++)this.nodes.push(new T(r,i,0,t[i][r]));for(var i=0;i<this.nodes.length;i++)for(var o=this.nodes[i],a=-1;a<=1;a++)for(var s=-1;s<=1;s++)if((0!=a||0!=s)&&!(o.x+a<0||o.x+a>=e||o.y+s<0||o.y+s>=n||Math.abs(a)>0&&Math.abs(s)>0||this.markedSolid(o.x+a,o.y+s))){var u=this.nodes[i+e*s+a];this.nodes[i].connectTo(u)}}}]),t}(),P=function(){function t(e,n,i,r){(0,d.default)(this,t),this.g=e,this.h=n,this.previous=i,this.data=r}return(0,y.default)(t,[{key:"f",value:function(){return this.g+this.h}}]),t}(),A=function t(){(0,d.default)(this,t)},R=(function(t){function e(){return(0,d.default)(this,e),(0,s.default)(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}(0,h.default)(e,t),(0,y.default)(e,[{key:"getHeuristic",value:function(t,e,n,i,r,o){return Math.sqrt(Math.pow(i-t,2)+Math.pow(r-e,2)+Math.pow(o-n,2))}}])}(A),function(t){function e(){return(0,d.default)(this,e),(0,s.default)(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return(0,h.default)(e,t),(0,y.default)(e,[{key:"getHeuristic",value:function(t,e,n,i,r,o){return Math.abs(i-t)+Math.abs(r-e)+Math.abs(o-n)}}]),e}(A)),M=function(){function t(e){(0,d.default)(this,t),this.graph=new C,this.setHeuristic(e)}return(0,y.default)(t,[{key:"getGraph",value:function(){return this.graph}},{key:"getNode",value:function(t,e){return this.graph.getNode(t,e)}},{key:"setHeuristic",value:function(t){this.heuristic=t}}]),(0,y.default)(t,[{key:"clearMarkedSolid",value:function(){this.graph.clearMarkedSolid()}},{key:"path",value:function(t,e){for(var n=[],i=[],r=new P(0,this.heuristic.getHeuristic(t.x,t.y,t.z,e.x,e.y,e.z),null,t);r.data!=e;){for(var o=null,a=-1,s=0;s<n.length;s++)(null==o||o.f()>n[s].f())&&(o=n[s],a=s);null!=o&&(n.splice(a,1),i.push(o),r=o);for(var u=r.data.getConnections(),s=0;s<u.length;s++){for(var l=!0,c=-1,h=0;h<n.length;h++)n[h].data.x==u[s].x&&n[h].data.y==u[s].y&&n[h].data.z==u[s].z&&(c=h);for(var h=0;h<i.length;h++)i[h].data.x==u[s].x&&i[h].data.y==u[s].y&&i[h].data.z==u[s].z&&(l=!1);var f=u[s],d=r.g;d+=Math.sqrt(Math.pow(r.data.x-f.x,2)+Math.pow(r.data.y-f.y,2)+Math.pow(r.data.z-f.z,2))*f.weight;var p=this.heuristic.getHeuristic(f.x,f.y,f.z,e.x,e.y,e.z);-1==c&&l?n.push(new P(d,p,r,f)):c>-1&&d+p<n[c].f()&&l&&(n[c].g=d,n[c].h=p,n[c].previous=r)}}for(var y=[];null!=r;)y.push(r.data),r=r.previous;return y.reverse(),y}},{key:"load",value:function(t){this.graph.fromArray(t)}},{key:"setSolid",value:function(t,e){this.graph.setSolid(t,e)}}]),t}()},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(8),m=n(6),g=n(9),_=n(7);n(13);var Shake=function(t){function Shake(){(0,o.default)(this,Shake);var t=(0,l.default)(this,(Shake.__proto__||Object.getPrototypeOf(Shake)).apply(this,arguments));return t.startTime=Number.POSITIVE_INFINITY,t.startPos=new _.Vector,t}return(0,d.default)(Shake,t),(0,s.default)(Shake,[{key:"addedToScene",value:function(){(0,h.default)(Shake.prototype.__proto__||Object.getPrototypeOf(Shake.prototype),"addedToScene",this).call(this),this.graphic=this.opts.graphic||this.entity.find(g.Graphic),this.opts.autoPlay&&this.play()}},{key:"play",value:function(){this.startTime=m.Engine.elapsed,this.startPos.copy(this.graphic.position)}},{key:"update",value:function(){(0,h.default)(Shake.prototype.__proto__||Object.getPrototypeOf(Shake.prototype),"update",this).call(this);var t=m.Engine.elapsed-this.startTime;t<0||(this.graphic.position.copy(this.startPos),t<this.opts.time?this.graphic.position.add(_.Vector.temp1.set(_.Calc.range(this.opts.amount),_.Calc.range(this.opts.amount))):this.startTime=Number.POSITIVE_INFINITY)}}]),Shake}(v.AutoComponent);Shake=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([v.AutoComponent.register],Shake),e.Shake=Shake},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(8),SoundEffect=function(t){function SoundEffect(){(0,o.default)(this,SoundEffect);var t=(0,l.default)(this,(SoundEffect.__proto__||Object.getPrototypeOf(SoundEffect)).apply(this,arguments));return t.playNextFrame=!1,t}return(0,d.default)(SoundEffect,t),(0,s.default)(SoundEffect,[{key:"addedToScene",value:function(){(0,h.default)(SoundEffect.prototype.__proto__||Object.getPrototypeOf(SoundEffect.prototype),"addedToScene",this).call(this),this.playNextFrame=!0}},{key:"update",value:function(){(0,h.default)(SoundEffect.prototype.__proto__||Object.getPrototypeOf(SoundEffect.prototype),"update",this).call(this),this.playNextFrame&&this.opts.name&&(this.playOneShot(this.opts.name),this.playNextFrame=!1)}}]),SoundEffect}(v.AutoComponent);SoundEffect=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([v.AutoComponent.register],SoundEffect),e.SoundEffect=SoundEffect},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},m=function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0});var g=n(6),_=n(12),b=n(121),w=n(17);n(13);var Spikes=function(t){function Spikes(t){var e=t.delay,n=void 0===e?.6:e,i=t.spikeUpTime,r=void 0===i?2.2:i;(0,o.default)(this,Spikes);var a=(0,l.default)(this,(Spikes.__proto__||Object.getPrototypeOf(Spikes)).call(this));return a.lastTriggerTime=-1e3,a.state="Dormant",a.delay=n,a.spikeUpTime=r,a}return(0,d.default)(Spikes,t),(0,s.default)(Spikes,[{key:"addedToScene",value:function(){(0,h.default)(Spikes.prototype.__proto__||Object.getPrototypeOf(Spikes.prototype),"addedToScene",this).call(this),this.spikeSprite=this.entity.componentByName.spines}},{key:"update",value:function(){var t=g.Engine.elapsed,e=t-this.lastTriggerTime,n=this.spikeSprite,i=this.delay+this.spikeUpTime;switch(n.visible="Dormant"!==this.state,this.causesDamage.active=e>this.delay&&e<i,this.state){case"Dormant":e>i&&this.hitbox.check(w.Game.TAGS.PLAYER)&&(this.lastTriggerTime=t,this.state="Triggered",n.rate=1);break;case"Triggered":e>this.delay&&(n.play("thrust",!0),this.state="Up");break;case"Up":e>i&&(n.rate=0,n.frame=0,this.state="Dormant");break;default:throw Error(this.state)}}}]),Spikes}(g.Component);v([g.Component.require,m("design:type",_.Hitbox)],Spikes.prototype,"hitbox",void 0),v([g.Component.require,m("design:type",b.CausesDamage)],Spikes.prototype,"causesDamage",void 0),Spikes=v([g.Component.register,m("design:paramtypes",[Object])],Spikes),e.Spikes=Spikes},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(3),h=i(c),f=n(4),d=i(f);Object.defineProperty(e,"__esModule",{value:!0});var p=n(6),y=n(9),SpriteAutoPlay=function(t){function SpriteAutoPlay(t){var e=t.animationName;(0,o.default)(this,SpriteAutoPlay);var n=(0,l.default)(this,(SpriteAutoPlay.__proto__||Object.getPrototypeOf(SpriteAutoPlay)).call(this));return n.animationName=e,n}return(0,h.default)(SpriteAutoPlay,t),(0,s.default)(SpriteAutoPlay,[{key:"addedToScene",value:function(){this.entity.find(y.Sprite).play(this.animationName)}}]),SpriteAutoPlay}(p.Component);SpriteAutoPlay=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([p.Component.register,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,d.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:paramtypes",[Object])],SpriteAutoPlay),e.SpriteAutoPlay=SpriteAutoPlay},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var m=n(8),g=n(9),_=n(21),SpriteEvents=function(t){function SpriteEvents(){(0,o.default)(this,SpriteEvents);var t=(0,l.default)(this,(SpriteEvents.__proto__||Object.getPrototypeOf(SpriteEvents)).apply(this,arguments));return t.wasPlaying=!1,t}return(0,d.default)(SpriteEvents,t),(0,s.default)(SpriteEvents,[{key:"addedToScene",value:function(){(0,h.default)(SpriteEvents.prototype.__proto__||Object.getPrototypeOf(SpriteEvents.prototype),"addedToScene",this).call(this),this.onFinish=new _.EventDelegate(this.opts.onFinish,this.entity)}},{key:"update",value:function(){!this.wasPlaying&&this.sprite.active?this.wasPlaying=!0:this.wasPlaying&&!this.sprite.active&&this.onFinish.invoke()}}]),SpriteEvents}(m.AutoComponent);v([m.AutoComponent.require,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",g.Sprite)],SpriteEvents.prototype,"sprite",void 0),SpriteEvents=v([m.AutoComponent.register],SpriteEvents),e.SpriteEvents=SpriteEvents},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(8),m=n(7),g=n(9),_=n(16),Trail=function(t){function Trail(){(0,o.default)(this,Trail);var t=(0,l.default)(this,(Trail.__proto__||Object.getPrototypeOf(Trail)).apply(this,arguments));return t.lastPoint=new m.Vector,t.currentPoint=new m.Vector,t}return(0,d.default)(Trail,t),(0,s.default)(Trail,[{key:"_getCurrentPos",value:function(){this.getScenePosition(this.currentPoint),this.graphic&&this.currentPoint.add(m.Vector.temp2.set(this.graphic.width/2,this.graphic.height))}},{key:"addedToScene",value:function(){(0,h.default)(Trail.prototype.__proto__||Object.getPrototypeOf(Trail.prototype),"addedToScene",this).call(this),this.graphic=this.entity.find(g.Graphic),this._getCurrentPos(),this.lastPoint.copy(this.currentPoint)}},{key:"update",value:function(){(0,h.default)(Trail.prototype.__proto__||Object.getPrototypeOf(Trail.prototype),"update",this).call(this),this._getCurrentPos();for(var t=this.opts.distance;m.Vector.distance(this.lastPoint,this.currentPoint)>t;){var e=m.Vector.temp0.copy(this.currentPoint).sub(this.lastPoint).normalize();this.lastPoint.add(e.mult(t)),this._spawn(this.lastPoint)}}},{key:"_spawn",value:function(t){var e=t.x,n=t.y;this.scene.add(_.instantiatePrefab(this.opts.prefabName,null,e,n)).depth=this.entity.depth+1}}]),Trail}(v.AutoComponent);Trail=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([v.AutoComponent.register],Trail),e.Trail=Trail},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(6),m=n(12),g=n(17),_=n(21),b=n(34),w=n(8),Trigger=function(t){function Trigger(t){(0,o.default)(this,Trigger);var e=(0,l.default)(this,(Trigger.__proto__||Object.getPrototypeOf(Trigger)).call(this,t));return e.lastTrigger=-1,e.hitboxName=t.hitboxName,e.onTrigger=new _.EventDelegate(t.onTrigger),e.triggerEvery=void 0===t.triggerEvery?1:t.triggerEvery,e}return(0,d.default)(Trigger,t),(0,s.default)(Trigger,[{key:"completeLevel",value:function(t){var e=this.scene,n=t.entity.find(b.PlayerEffects);n&&(n.exiting=!0),e.completeLevel(!0,n.asJSON())}},{key:"addedToScene",value:function(){(0,h.default)(Trigger.prototype.__proto__||Object.getPrototypeOf(Trigger.prototype),"addedToScene",this).call(this),void 0!==this.hitboxName?this.hitbox=this.entity.componentByName[this.hitboxName]:this.hitbox=this.entity.find(m.Hitbox),this.onTrigger.bind(this.entity)}},{key:"update",value:function(){(0,h.default)(Trigger.prototype.__proto__||Object.getPrototypeOf(Trigger.prototype),"update",this).call(this);var t=this.hitbox.collide(g.Game.TAGS.PLAYER);if(t){var e=v.Engine.elapsed;this.lastTrigger+this.triggerEvery>=e||(this.lastTrigger=e,this.onTrigger.invoke(t))}}}]),Trigger}(w.AutoComponent);Trigger=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}([w.AutoComponent.register,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:paramtypes",[Object])],Trigger),e.Trigger=Trigger},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){var e,n;return b.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:e=0;case 1:if(!(e<t.height)){i.next=12;break}n=0;case 3:if(!(n<t.width)){i.next=9;break}return i.next=6,[n,e];case 6:++n,i.next=3;break;case 9:++e,i.next=1;break;case 12:case"end":return i.stop()}},w[0],this)}function o(t,e){return t[0]===e[0]&&t[1]===e[1]}function a(t,e){for(var n={},i=function(t,e){return void 0!==n[t]&&!!n[t][e]},o=function(t){var e=(0,g.default)(t,2);return e[0]+"_"+e[1]},a=t.getMapLocationsByName("water_source",!1),s=0,u=0;u<10;++u){var l=void 0,c=a.splice(0,1)[0];if(c){var h=c.getScenePosition(E.Vector.temp1).sub(e.getScenePosition(E.Vector.temp2)).div(E.Vector.temp3.set(e.tileWidth,e.tileHeight)),f=h.x,d=h.y;e.has(f,d)&&!i(f,d)&&(l=[f,d])}if(!l){var p=!0,y=!1,v=void 0;try{for(var m,_=r(e)[Symbol.iterator]();!(p=(m=_.next()).done);p=!0){var b=(0,g.default)(m.value,2),w=b[0],x=b[1];if(e.has(w,x)&&!i(w,x)){l=[w,x];break}}}catch(t){y=!0,v=t}finally{try{!p&&_.return&&_.return()}finally{if(y)throw v}}}if(!l){if(0===s)return;break}var k={};k[o(l)]=!0;for(var O=[l];O.length>0&&++s<5e3;){var T=(0,g.default)(O.splice(0,1)[0],2),C=T[0],P=T[1],A=(o([C,P]),[]),R=!0,M=!1,j=void 0;try{for(var L,F=S[Symbol.iterator]();!(R=(L=F.next()).done);R=!0){var D=(0,g.default)(L.value,2),B=D[0],N=D[1],I=C+B,G=P+N,U=o([I,G]);!k[U]&&e.has(I,G)&&(k[U]=!0,A.push([B,N]),O.push([I,G]))}}catch(t){M=!0,j=t}finally{try{!R&&F.return&&F.return()}finally{if(M)throw j}}void 0===n[C]&&(n[C]={}),n[C][P]=A}for(O=[l];O.length>0;){var V=(0,g.default)(O.splice(0,1)[0],2),H=V[0],X=V[1],z=n[H]?n[H][X]:void 0;if(z){var Y=[H+z[0][0],X+z[0][1]],W=Y[0],K=Y[1];(n[W]&&n[W][K]).length?O.push([W,K]):n[W][K]=[[z[0][0],z[0][1]]]}}}return{flowmap:n,numTiles:s}}var s=n(0),u=i(s),l=n(1),c=i(l),h=n(2),f=i(h),d=n(5),p=i(d),y=n(3),v=i(y),m=n(11),g=i(m),_=n(42),b=i(_),w=[r].map(b.default.mark);Object.defineProperty(e,"__esModule",{value:!0});var x=n(6),k=n(46),E=n(7),O=n(125),S=[[1,0],[0,1],[-1,0],[0,-1]],WaterFlow=function(t){function WaterFlow(t){var e=t.tilemap,n=t.hitgrid;(0,u.default)(this,WaterFlow);var i=(0,f.default)(this,(WaterFlow.__proto__||Object.getPrototypeOf(WaterFlow)).call(this));return i.currentStrength=10,i.rects=[],i.tracked=new Map,i.prewarmed=!1,i.debugSub=new E.Color(200,0,200,.8),i.tilemap=e,i.hitgrid=n,i}return(0,v.default)(WaterFlow,t),(0,c.default)(WaterFlow,[{key:"worldToMap",value:function(t){var e=this.scenePosition;t.x=Math.floor((t.x-e.x)/this.tilemap.tileWidth),t.y=Math.floor((t.y-e.y)/this.tilemap.tileHeight)}},{key:"trackObject",value:function(t){this.solids.trackObject(t);var e=E.Vector.temp3.set(t.sceneCenterX,t.sceneCenterY);return this.getAtWorld(e)[0]}},{key:"trackObjectAndGetDestination",value:function(t,e,n){this.solids.trackObject(t);var i=(new E.Vector).set(t.sceneCenterX,t.sceneCenterY);if(this.tracked.has(t)){var r=this.tracked.get(t),a=r.pt,s=r.isEnd;if(e.copy(a),E.Vector.distance(e,i)>.6)return n.isEnd=s,!0;this.tracked.delete(t)}var u=this.tilemap,l=u.tileWidth;u.tileHeight,i.sub(this.tilemap.scenePosition).div(l).floor().mult(l).add(l/2).add(this.tilemap.scenePosition);for(var c=void 0,h=void 0,f=!1;;){var d=h;if(h=this.getDirectionAtWorld(i),!c&&!h)return!1;if(!h)break;if((c=d)&&!o(h,c))break;var p=E.Vector.temp5.set(this.tilemap.tileWidth*h[0],this.tilemap.tileHeight*h[1]);if(i.add(p),void 0===this.getDirectionAtWorld(i)){i.sub(p),f=!0;break}}return e.copy(i),n.isEnd=f,this.tracked.set(t,{isEnd:f,pt:(new E.Vector).copy(e)}),!0}},{key:"initWaterflow",value:function(){this.map=a(this.scene,this.tilemap);for(var t=this.scenePosition,e=this.tilemap,n=e.tileWidth,i=e.tileHeight,r=0;r<this.tilemap.height;++r)for(var o=0;o<this.tilemap.width;++o)this.has(o,r)&&this.rects.push(new E.Rectangle(t.x+o*n,t.y+r*i,n,i));this.solids=new O.HitgridWithHoles(this.hitgrid.tileWidth,this.hitgrid.tileHeight,["water_solid"]);var s=!0,u=!1,l=void 0;try{for(var c,h=this.hitgrid.tiles()[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var f=(0,g.default)(c.value,2),d=f[0],p=f[1];this.solids.set(!0,d,p)}}catch(t){u=!0,l=t}finally{try{!s&&h.return&&h.return()}finally{if(u)throw l}}this.hitgrid.entity.add(this.solids),this.particles=this.entity.add(new k.ParticleSystem("water"))}},{key:"update",value:function(){if((0,p.default)(WaterFlow.prototype.__proto__||Object.getPrototypeOf(WaterFlow.prototype),"update",this).call(this),this.map||this.initWaterflow(),!this.prewarmed){this.prewarmed=!0;for(var t=0;t<1e3;++t)this.update()}var e=this.scenePosition,n=this.rects[Math.floor(E.Calc.range(0,this.rects.length))],i=this.tilemap,r=i.tileWidth,o=i.tileHeight;this.particles.activeParticles.length<10*this.map.numTiles&&this.particles.burst(n.x+r/2,n.y+o/2,0,r/2,o/2,5);var a=!0,s=!1,u=void 0;try{for(var l,c=this.particles.activeParticles[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var h=l.value,f=Math.floor((h.x-e.x)/r),d=Math.floor((h.y-e.y)/o),y=void 0!==this.map.flowmap[f]?this.map.flowmap[f][d]:void 0;if(y){var v=!0,m=!1,_=void 0;try{for(var b,w=y[Symbol.iterator]();!(v=(b=w.next()).done);v=!0){var x=(0,g.default)(b.value,2),k=x[0],O=x[1];h.accelX=Math.min(25*k*.4,48),h.accelY=Math.min(25*O*.4,48)}}catch(t){m=!0,_=t}finally{try{!v&&w.return&&w.return()}finally{if(m)throw _}}}else h.percent=1}}catch(t){s=!0,u=t}finally{try{!a&&c.return&&c.return()}finally{if(s)throw u}}}},{key:"has",value:function(t,e){return void 0!==this.map.flowmap[t]&&!!this.map.flowmap[t][e]}},{key:"getAtWorld",value:function(t){var e=this.scenePosition,n=Math.floor((t.x-e.x)/this.tilemap.tileWidth),i=Math.floor((t.y-e.y)/this.tilemap.tileHeight);return void 0!==this.map.flowmap[n]?this.map.flowmap[n][i]:void 0}},{key:"getDirectionAtWorld",value:function(t){var e=this.getAtWorld(t);if(e&&0!==e.length){if(1===e.length)return e[0];throw Error("TODO: implement behaviour with more than one water direction")}}},{key:"debugRender",value:function(t){for(var e=x.Engine.graphics,n=this.tilemap,i=n.tileWidth,r=n.tileHeight,o=t.extents,a=this.scenePosition,s=Math.floor((o.left-a.x)/i)-1,u=Math.ceil((o.right-a.x)/i)+1,l=Math.floor((o.top-a.y)/r)-1,c=Math.ceil((o.bottom-a.y)/r)+1,h=s;h<u;h++)if(void 0!==this.map.flowmap[h])for(var f=l;f<c;f++)if(this.map.flowmap[h][f]){var d=a.x+h*i,p=a.y+f*r,y=new E.Color(1,0,1,.7),v=!0,m=!1,_=void 0;try{for(var b,w=this.map.flowmap[h][f][Symbol.iterator]();!(v=(b=w.next()).done);v=!0){var k=(0,g.default)(b.value,2),O=k[0],S=k[1];-1==O&&0==S?e.triangle(E.Vector.temp0.set(d,p+r/2),E.Vector.temp1.set(d+8,p),E.Vector.temp2.set(d+8,p+r),y):1==O&&0==S?e.triangle(E.Vector.temp0.set(d+i-8,p),E.Vector.temp1.set(d+i,p+r/2),E.Vector.temp2.set(d+i-8,p+r),y):0==O&&-1==S?e.triangle(E.Vector.temp0.set(d,p+8),E.Vector.temp1.set(d+i/2,p),E.Vector.temp2.set(d+i,p+8),y):0==O&&1==S&&e.triangle(E.Vector.temp0.set(d,p+r-8),E.Vector.temp1.set(d+i/2,p+r),E.Vector.temp2.set(d+i,p+r-8),y)}}catch(t){m=!0,_=t}finally{try{!v&&w.return&&w.return()}finally{if(m)throw _}}}}}]),WaterFlow}(x.Component);e.WaterFlow=WaterFlow},function(t,e,n){var i=n(230);"string"==typeof i&&(i=[[t.i,i,""]]);var r={};r.transform=void 0,n(232)(i,r),i.locals&&(t.exports=i.locals)},function(t,e,n){e=t.exports=n(231)(void 0),e.push([t.i,"\r\n.json-editor {\r\n\twidth: 400px;\r\n\tposition: absolute;\r\n\tright: 0;\r\n\ttop: 10px;\r\n\tbackground: white;\r\n\tfont-family: Consolas;\r\n\tfont-size: 10px;\r\n}",""])},function(t,e){function n(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var o=i(r);return[n].concat(r.sources.map(function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"})).concat([o]).join("\n")}return""+n}function i(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=n(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var o=this[r][0];"number"==typeof o&&(i[o]=!0)}for(r=0;r<t.length;r++){var a=t[r];"number"==typeof a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(t,e,n){function i(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=p[i.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](i.parts[o]);for(;o<i.parts.length;o++)r.parts.push(c(i.parts[o],e))}else{for(var a=[],o=0;o<i.parts.length;o++)a.push(c(i.parts[o],e));p[i.id]={id:i.id,refs:1,parts:a}}}}function r(t,e){for(var n=[],i={},r=0;r<t.length;r++){var o=t[r],a=e.base?o[0]+e.base:o[0],s=o[1],u=o[2],l=o[3],c={css:s,media:u,sourceMap:l};i[a]?i[a].parts.push(c):n.push(i[a]={id:a,parts:[c]})}return n}function o(t,e){var n=v(t.insertInto);if(!n)throw Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=_[_.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),_.push(e);else{if("bottom"!==t.insertAt)throw Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(e)}}function a(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=_.indexOf(t);e>=0&&_.splice(e,1)}function s(t){var e=document.createElement("style");return t.attrs.type="text/css",l(e,t.attrs),o(t,e),e}function u(t){var e=document.createElement("link");return t.attrs.type="text/css",t.attrs.rel="stylesheet",l(e,t.attrs),o(t,e),e}function l(t,e){Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})}function c(t,e){var n,i,r,o;if(e.transform&&t.css){if(!(o=e.transform(t.css)))return function(){};t.css=o}if(e.singleton){var l=g++;n=m||(m=s(e)),i=h.bind(null,n,l,!1),r=h.bind(null,n,l,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=u(e),i=d.bind(null,n,e),r=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=s(e),i=f.bind(null,n),r=function(){a(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}function h(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=w(e,r);else{var o=document.createTextNode(r),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(o,a[e]):t.appendChild(o)}}function f(t,e){var n=e.css,i=e.media;if(i&&t.setAttribute("media",i),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function d(t,e,n){var i=n.css,r=n.sourceMap,o=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||o)&&(i=b(i)),r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var a=new Blob([i],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}var p={},y=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}}(function(){return window&&document&&document.all&&!window.atob}),v=function(t){var e={};return function(n){return void 0===e[n]&&(e[n]=t.call(this,n)),e[n]}}(function(t){return document.querySelector(t)}),m=null,g=0,_=[],b=n(233);t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw Error("The style-loader cannot be used in a non-browser environment");e=e||{},e.attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||(e.singleton=y()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=r(t,e);return i(n,e),function(t){for(var o=[],a=0;a<n.length;a++){var s=n[a],u=p[s.id];u.refs--,o.push(u)}t&&i(r(t,e),e);for(var a=0;a<o.length;a++){var u=o[a];if(0===u.refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete p[u.id]}}}};var w=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var r=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(r))return t;var o;return o=0===r.indexOf("//")?r:0===r.indexOf("/")?n+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")"})}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f),p=n(4),y=i(p),v=function(t,e,n,i){var r,o=arguments.length,a=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(a=(o<3?r(a):o>3?r(e,n,a):r(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};Object.defineProperty(e,"__esModule",{value:!0});var m=n(6),g=n(9),_=n(7),b=n(84),Wobble=function(t){function Wobble(){(0,o.default)(this,Wobble);var t=(0,l.default)(this,(Wobble.__proto__||Object.getPrototypeOf(Wobble)).apply(this,arguments));return t.startPos=new _.Vector,t.intensity=3,t.frequency=2.1,t.offset=0,t.extraHeight=-3,t.shadows=[],t}return(0,d.default)(Wobble,t),(0,s.default)(Wobble,[{key:"addedToScene",value:function(){(0,h.default)(Wobble.prototype.__proto__||Object.getPrototypeOf(Wobble.prototype),"addedToScene",this).call(this),this.offset=_.Calc.range(0,2*Math.PI),this.startPos.copy(this.graphic.position);var t=this.scene.numShadows,e=this.entity.add(new b.ChildEntity({name:"Wobble Child of "+this.entity.name}));e.child.depth=this.entity.depth+1;for(var n=0;n<t;++n){var i=this.scene.getShadow(n),r=e.entity.add(new g.Graphic(i,_.Vector.temp0.set(-4,-5)));r.alpha=.7,r.visible=!1,this.shadows.push(r)}}},{key:"update",value:function(){if((0,h.default)(Wobble.prototype.__proto__||Object.getPrototypeOf(Wobble.prototype),"update",this).call(this),!(m.Engine.delta<=0)){var t=Math.sin(m.Engine.elapsed*this.frequency+this.offset),e=(t+1)/2,n=Math.floor(e*this.shadows.length),i=this.startPos.y+e*this.intensity;this.graphic.y=i+this.extraHeight;for(var r=(this.startPos.y,this.intensity,this.startPos.y,this.intensity,0);r<this.shadows.length;++r)this.shadows[r].visible=r===n}}}]),Wobble}(m.Component);v([m.Component.require,function(t,e){if("object"===("undefined"==typeof Reflect?"undefined":(0,y.default)(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}("design:type",g.Graphic)],Wobble.prototype,"graphic",void 0),Wobble=v([m.Component.register],Wobble),e.Wobble=Wobble},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;return e.alpha=0,_.Tween.create(t).start(n,0,1,g.Ease.linear,function(t){e.alpha=t},!0).restart()}function o(t){if("ice"===t)return b.SpriteBank.get("blue_orb").first.frames[0];if("mimic"===t)return b.SpriteBank.get("grey_orb").first.frames[0];throw Error(t)}var a=n(0),s=i(a),u=n(1),l=i(u),c=n(2),h=i(c),f=n(5),d=i(f),p=n(3),y=i(p);Object.defineProperty(e,"__esModule",{value:!0});var v=n(6),m=n(9),g=n(7),_=n(14),b=n(45),w=n(23),x=function(t){function e(){(0,s.default)(this,e);var t=(0,h.default)(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.graphics=[],t.totalPadding=new g.Vector(10,10),t.lastShots="~",t.lastNumShots=-1,t.name="Hud",t}return(0,y.default)(e,t),(0,l.default)(e,[{key:"started",value:function(){(0,d.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"started",this).call(this);var t=this.scene.firstColliderInTag("player");if(!t)throw Error("NO PLAYER COLLIDER FOUND BY HUD");this.gun=t.entity.find(w.FreezingShot),this.rect=this.add(new m.Rectsprite(0,8,new g.Color(0,0,0,.8))),this.rect.y=5,this.shake=this.add(new w.Shake({time:.26,amount:1,graphic:this.rect}))}},{key:"update",value:function(){if((0,d.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.gun){var t=b.SpriteBank.get("blue_orb");if(t){var n=this.scene.camera.extents;this.position.set(n.left,n.top).add(this.totalPadding);var i=this.gun.shotsLeft,a=t.first.frames[0];this.gun.emptyShotsTaken>0&&(this.shake.play(),this.gun.emptyShotsTaken=0);var s=this.gun.shots.join("_");if(s!==this.lastShots){this.lastShots=s;var u=this.gun.shots.length-this.lastNumShots;for(this.lastNumShots=this.gun.shots.length;this.graphics.length;)this.remove(this.graphics.splice(0,1)[0]);var l=0,c=!0,h=!1,f=void 0;try{for(var p,y=this.gun.shots[Symbol.iterator]();!(c=(p=y.next()).done);c=!0){var v=p.value,_=o(v),w=new m.Graphic(_,g.Vector.temp0.set(this.graphics.length*(_.width+4),0));this.graphics.push(this.add(w)),u>0&&this.gun.shots.length-l-1<u&&r(this,w,.3),l++}}catch(t){h=!0,f=t}finally{try{!c&&y.return&&y.return()}finally{if(h)throw f}}this.rect.width=(a.width+4)*i-4}}}}}]),e}(v.Entity);e.Hud=x},function(t,e,n){"use strict";function i(){return{vert:n(237),frag:n(238)}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(7),o=void 0;t.exports=function(){var t=i(),e=t.vert,n=t.frag;return o=new r.Shader(e,n,[new r.ShaderUniform("time",r.ShaderUniformType.float),new r.ShaderUniform("matrix",r.ShaderUniformType.matrix3d),new r.ShaderUniform("texture",r.ShaderUniformType.sampler2D)],[new r.ShaderAttribute("a_position",r.ShaderAttributeType.Position),new r.ShaderAttribute("a_texcoord",r.ShaderAttributeType.Texcoord),new r.ShaderAttribute("a_color",r.ShaderAttributeType.Color),new r.ShaderAttribute("a_colorAdd",r.ShaderAttributeType.Color)])}},function(t,e){t.exports="uniform float time;\r\n\r\nattribute vec2 a_position;\r\nattribute vec2 a_texcoord;\r\nattribute vec4 a_color;\r\nattribute vec4 a_colorAdd;\r\n\r\nuniform mat3 matrix;\r\nvarying vec2 v_texcoord;\r\nvarying vec4 v_color;\r\nvarying vec4 v_colorAdd;\r\n\r\nvoid main()\r\n{\r\n\tvec4 pos = vec4((matrix * vec3(a_position, 1.0)).xy, 0.0, 1.0);\r\n\tgl_Position = pos;\r\n\tv_texcoord = vec2(a_texcoord.x, a_texcoord.y);\r\n\tv_color = vec4(a_color.rgb * a_color.a, a_color.a);\r\n\tv_colorAdd = vec4(a_colorAdd.rgb * a_colorAdd.a, a_colorAdd.a);\r\n}"},function(t,e){t.exports="// fragment shader\r\nprecision mediump float;\r\nvarying vec2 v_texcoord;\r\nvarying vec4 v_color;\r\nvarying vec4 v_colorAdd;\r\nuniform sampler2D texture;\r\n\r\nvoid main() \r\n{\r\n\tgl_FragColor = texture2D(texture, v_texcoord) * v_color;\r\n}"},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(1),s=i(a),u=n(2),l=i(u),c=n(5),h=i(c),f=n(3),d=i(f);Object.defineProperty(e,"__esModule",{value:!0});var p=n(6),y=n(86),v=n(7),m=n(16),g=n(87),_=function(t){function e(){(0,o.default)(this,e);var t=(0,l.default)(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.sliderEnabled=!1,t.scene="endscreen",t}return(0,d.default)(e,t),(0,s.default)(e,[{key:"begin",value:function(){var t=this;(0,h.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"begin",this).call(this);var n=new v.Color(0,0,0,.3);this.addRect(-50,0,1e3,80,-.1,n),this.addRect(-50,230,1e3,120,-.1,n),this.add(m.instantiatePrefab("endscreen"));var i=this.add(new p.Entity);this.addButton(i.add(new y.StaticGraphic({texture:"mobilenewgame",x:170,y:195})).graphic,function(){return t.newGame()}),this.loaded=!0}},{key:"update",value:function(){(0,h.default)(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this),this.updateWobbles()}}]),e}(g.UIScene);e.EndScreen=_},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}var r=n(0),o=i(r),a=n(2),s=i(a),u=n(3),l=i(u);Object.defineProperty(e,"__esModule",{value:!0});var c=n(82),h=n(6),f=n(59),d=n(16),p=function(t){function e(t){(0,o.default)(this,e);var n=(0,s.default)(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return setTimeout(function(){n.entity=n.add(d.instantiatePrefab(t)),n.camera.origin.set(h.Engine.width/2,h.Engine.height/2),n.entity.components.each(function(t){t instanceof c.Burst&&(t.loop=!0)})},50),n}return(0,l.default)(e,t),e}(f.EditableScene);e.PrefabTestScene=p},function(t,e,n){"use strict";function i(){function t(t,e){new r.ParticleTemplate(t).colors(e,e).accelY(-90,15).duration(.35).alphaFrom(1).alphaTo(0).alphaEase(o.Ease.linear)}var e=[o.Color.red,new o.Color(1,.4,.4),new o.Color(1,.2,.2),new o.Color(1,.7,.7)];new r.ParticleTemplate("red_laser_impact").colors(e).duration(.9,.1).accelY(-100,20).accelX(0,-40).scaleTo(0).alphaFrom(1).alphaTo(.2).alphaEase(o.Ease.linear),new r.ParticleTemplate("red_laser_absorb").scaleFrom(6,2).duration(1,.1).colors([o.Color.red,new o.Color(1,.2,.2),new o.Color(1,.4,.4)]),new r.ParticleTemplate("water").colors([o.Color.white,new o.Color(0,0,1,1),new o.Color(0,0,.5,1)]).duration(3.2,.9),new r.ParticleTemplate("pickup").speed(0,90).accelY(350).duration(.3,.09).colors([o.Color.red,new o.Color(1,.5,1)]).alphaFrom(1).alphaTo(0).alphaEase(o.Ease.linear),new r.ParticleTemplate("freezing_shot_shatter").speed(0,90).accelY(100,200).duration(.22,.1).colors([new o.Color(100,100,255),new o.Color(150,150,255)]).alphaFrom(.9,.1).alphaTo(0),new r.ParticleTemplate("ice_shatter").speed(0,90).accelY(100).duration(.22,.1).colors([o.Color.white,o.Color.blue]).alphaFrom(.9,.1).alphaTo(0),new r.ParticleTemplate("treasure_pickup").speed(0,-10).accelY(-800,500).colors([new o.Color(0,1,1)]).duration(.7).alphaFrom(1).alphaTo(0),new r.ParticleTemplate("dust").accelX(-120,40).accelY(-20,10).colors([o.Color.red,o.Color.white,o.Color.blue]).duration(12).scale(1.5,.5),new r.ParticleTemplate("dragon_fire_burst").colors([o.Color.red,new o.Color(.8,.1,.1),new o.Color(.4,0,0)]).speed(0,90).accelY(350).duration(.3,.09).colors([o.Color.red,new o.Color(1,.5,1)]).alphaFrom(1).alphaTo(0).alphaEase(o.Ease.linear),t("ice_heart_ambient",[o.Color.fromHex("#3448ac"),o.Color.fromHex("#3b77c2")]),t("mimic_heart_ambient",[o.Color.fromHex("#c0c0c0"),o.Color.fromHex("#666666"),o.Color.fromHex("#ffffff")])}Object.defineProperty(e,"__esModule",{value:!0});var r=n(46),o=n(7);e.defineTemplates=i},function(t,e){t.exports={levels:["level0","block_intro","shot_intro","shatter_intro","dragon_intro","tutorial_block","level2","teach_dragon_freeze","water_teach","medusa_teach","medusa_simple","mimic_teach","mimic_cross","mimic_intro","spikes_intro","spike_circle","dragon_gauntlet","dragons_kill_onions","onion_city","medusa_block_trick","ice_thaw_test","medusa_maze","dragon_gauntlet_tight"]}},function(t,e,n){!function(e,n){t.exports=function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";e.__esModule=!0;var i=n(1),r=function(t){return t&&t.__esModule?t:{default:t}}(i);e.default=r.default,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(2),o=i(r),a=n(6),s=i(a),u=n(3),l=i(u),c=n(7),h=i(c),f=n(8),d=i(f),p=n(10),y=i(p),v=n(11),m=i(v),g=n(12),_=i(g),b=n(13),w=i(b),x=n(14),k=i(x),E=n(15),O=i(E),S=n(16),T=i(S),C=n(9),P=i(C),A=n(17),R=i(A);e.default={color:{Color:o.default,math:s.default,interpret:l.default},controllers:{Controller:h.default,BooleanController:d.default,OptionController:y.default,StringController:m.default,NumberController:_.default,NumberControllerBox:w.default,NumberControllerSlider:k.default,FunctionController:O.default,ColorController:T.default},dom:{dom:P.default},gui:{GUI:R.default},GUI:R.default},t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space?this.__state[e]:(y.recalculateRGB(this,e,n),this.__state[e])},set:function(t){"RGB"!==this.__state.space&&(y.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function a(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space?this.__state[e]:(y.recalculateHSV(this),this.__state[e])},set:function(t){"HSV"!==this.__state.space&&(y.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}e.__esModule=!0;var s=n(3),u=i(s),l=n(6),c=i(l),h=n(4),f=i(h),d=n(5),p=i(d),y=function(){function t(){if(r(this,t),this.__state=u.default.apply(this,arguments),!1===this.__state)throw Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return t.prototype.toString=function(){return(0,f.default)(this)},t.prototype.toHexString=function(){return(0,f.default)(this,!0)},t.prototype.toOriginal=function(){return this.__state.conversion.write(this)},t}();y.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=c.default.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw Error("Corrupted color state");p.default.extend(t.__state,c.default.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},y.recalculateHSV=function(t){var e=c.default.rgb_to_hsv(t.r,t.g,t.b);p.default.extend(t.__state,{s:e.s,v:e.v}),p.default.isNaN(e.h)?p.default.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},y.COMPONENTS=["r","g","b","h","s","v","hex","a"],o(y.prototype,"r",2),o(y.prototype,"g",1),o(y.prototype,"b",0),a(y.prototype,"h"),a(y.prototype,"s"),a(y.prototype,"v"),Object.defineProperty(y.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(y.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=c.default.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}}),e.default=y,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(4),o=i(r),a=n(5),s=i(a),u=[{litmus:s.default.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3],0)}},write:o.default},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1],0)}},write:o.default},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:o.default},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:o.default}}},{litmus:s.default.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:s.default.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:s.default.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(s.default.isNumber(t.r)&&s.default.isNumber(t.g)&&s.default.isNumber(t.b)&&s.default.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(s.default.isNumber(t.r)&&s.default.isNumber(t.g)&&s.default.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(s.default.isNumber(t.h)&&s.default.isNumber(t.s)&&s.default.isNumber(t.v)&&s.default.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(s.default.isNumber(t.h)&&s.default.isNumber(t.s)&&s.default.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],l=void 0,c=void 0,h=function(){c=!1;var t=arguments.length>1?s.default.toArray(arguments):arguments[0];return s.default.each(u,function(e){if(e.litmus(t))return s.default.each(e.conversions,function(e,n){if(l=e.read(t),!1===c&&!1!==l)return c=l,l.conversionName=n,l.conversion=e,s.default.BREAK}),s.default.BREAK}),c};e.default=h,t.exports=e.default},function(t,e){"use strict";e.__esModule=!0,e.default=function(t,e){var n=""+t.__state.conversionName,i=Math.round(t.r),r=Math.round(t.g),o=Math.round(t.b),a=t.a,s=Math.round(t.h),u=t.s.toFixed(1),l=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=t.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+i+","+r+","+o+")":"CSS_RGBA"===n?"rgba("+i+","+r+","+o+","+a+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+r+","+o+"]":"RGBA_ARRAY"===n?"["+i+","+r+","+o+","+a+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+r+",b:"+o+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+u+",v:"+l+",a:"+a+"}":"unknown format"},t.exports=e.default},function(t,e){"use strict";e.__esModule=!0;var n=Array.prototype.forEach,i=Array.prototype.slice,r={BREAK:{},extend:function(t){return this.each(i.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))},this),t},defaults:function(t){return this.each(i.call(arguments,1),function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))},this),t},compose:function(){var t=i.call(arguments);return function(){for(var e=i.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,i){if(t)if(n&&t.forEach&&t.forEach===n)t.forEach(e,i);else if(t.length===t.length+0){var r=void 0,o=void 0;for(r=0,o=t.length;r<o;r++)if(r in t&&e.call(i,t[r],r)===this.BREAK)return}else for(var a in t)if(e.call(i,t[a],a)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var i=void 0;return function(){function r(){i=null,n||t.apply(o,a)}var o=this,a=arguments,s=n||!i;clearTimeout(i),i=setTimeout(r,e),s&&t.apply(o,a)}},toArray:function(t){return t.toArray?t.toArray():i.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return""+t},e}(function(t){return isNaN(t)}),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)}};e.default=r,t.exports=e.default},function(t,e){"use strict";e.__esModule=!0;var n=void 0,i={hsv_to_rgb:function(t,e,n){var i=Math.floor(t/60)%6,r=t/60-Math.floor(t/60),o=n*(1-e),a=n*(1-r*e),s=n*(1-(1-r)*e),u=[[n,s,o],[a,n,o],[o,n,s],[o,a,n],[s,o,n],[n,o,a]][i];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(t,e,n){var i=Math.min(t,e,n),r=Math.max(t,e,n),o=r-i,a=void 0,s=void 0;return 0===r?{h:NaN,s:0,v:0}:(s=o/r,a=t===r?(e-n)/o:e===r?2+(n-t)/o:4+(t-e)/o,a/=6,a<0&&(a+=1),{h:360*a,s:s,v:r/255})},rgb_to_hex:function(t,e,n){var i=this.hex_with_component(0,2,t);return i=this.hex_with_component(i,1,e),i=this.hex_with_component(i,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,i){return i<<(n=8*e)|t&~(255<<n)}};e.default=i,t.exports=e.default},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var i=function(){function t(e,i){n(this,t),this.initialValue=e[i],this.domElement=document.createElement("div"),this.object=e,this.property=i,this.__onChange=void 0,this.__onFinishChange=void 0}return t.prototype.onChange=function(t){return this.__onChange=t,this},t.prototype.onFinishChange=function(t){return this.__onFinishChange=t,this},t.prototype.setValue=function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this},t.prototype.getValue=function(){return this.object[this.property]},t.prototype.updateDisplay=function(){return this},t.prototype.isModified=function(){return this.initialValue!==this.getValue()},t}();e.default=i,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=n(7),u=i(s),l=n(9),c=i(l),h=function(t){function e(n,i){function a(){u.setValue(!u.__prev)}r(this,e);var s=o(this,t.call(this,n,i)),u=s;return s.__prev=s.getValue(),s.__checkbox=document.createElement("input"),s.__checkbox.setAttribute("type","checkbox"),c.default.bind(s.__checkbox,"change",a,!1),s.domElement.appendChild(s.__checkbox),s.updateDisplay(),s}return a(e,t),e.prototype.setValue=function(e){var n=t.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n},e.prototype.updateDisplay=function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),t.prototype.updateDisplay.call(this)},e}(u.default);e.default=h,t.exports=e.default},function(t,e,n){"use strict";function i(t){if("0"===t||o.default.isUndefined(t))return 0;var e=t.match(u);return o.default.isNull(e)?0:parseFloat(e[1])}e.__esModule=!0;var r=n(5),o=function(t){return t&&t.__esModule?t:{default:t}}(r),a={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},s={};o.default.each(a,function(t,e){o.default.each(t,function(t){s[t]=e})});var u=/(\d+(\.\d+)?)px/,l={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var i=n,r=e;o.default.isUndefined(r)&&(r=!0),o.default.isUndefined(i)&&(i=!0),t.style.position="absolute",r&&(t.style.left=0,t.style.right=0),i&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,i){var r=n||{},a=s[e];if(!a)throw Error("Event type "+e+" not supported.");var u=document.createEvent(a);switch(a){case"MouseEvents":var l=r.x||r.clientX||0,c=r.y||r.clientY||0;u.initMouseEvent(e,r.bubbles||!1,r.cancelable||!0,window,r.clickCount||1,0,0,l,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var h=u.initKeyboardEvent||u.initKeyEvent;o.default.defaults(r,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),h(e,r.bubbles||!1,r.cancelable,window,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.keyCode,r.charCode);break;default:u.initEvent(e,r.bubbles||!1,r.cancelable||!0)}o.default.defaults(u,i),t.dispatchEvent(u)},bind:function(t,e,n,i){var r=i||!1;return t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on"+e,n),l},unbind:function(t,e,n,i){var r=i||!1;return t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on"+e,n),l},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return l},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),i=n.indexOf(e);-1!==i&&(n.splice(i,1),t.className=n.join(" "))}else t.className=void 0;return l},hasClass:function(t,e){return RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return i(e["border-left-width"])+i(e["border-right-width"])+i(e["padding-left"])+i(e["padding-right"])+i(e.width)},getHeight:function(t){var e=getComputedStyle(t);return i(e["border-top-width"])+i(e["border-bottom-width"])+i(e["padding-top"])+i(e["padding-bottom"])+i(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}};e.default=l,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=n(7),u=i(s),l=n(9),c=i(l),h=n(5),f=i(h),d=function(t){function e(n,i,a){r(this,e);var s=o(this,t.call(this,n,i)),u=a,l=s;if(s.__select=document.createElement("select"),f.default.isArray(u)){var h={};f.default.each(u,function(t){h[t]=t}),u=h}return f.default.each(u,function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),l.__select.appendChild(n)}),s.updateDisplay(),c.default.bind(s.__select,"change",function(){var t=this.options[this.selectedIndex].value;l.setValue(t)}),s.domElement.appendChild(s.__select),s}return a(e,t),e.prototype.setValue=function(e){var n=t.prototype.setValue.call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n},e.prototype.updateDisplay=function(){return c.default.isActive(this.__select)?this:(this.__select.value=this.getValue(),t.prototype.updateDisplay.call(this))},e}(u.default);e.default=d,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=n(7),u=i(s),l=n(9),c=i(l),h=function(t){function e(n,i){function a(){l.setValue(l.__input.value)}function s(){l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}r(this,e);var u=o(this,t.call(this,n,i)),l=u;return u.__input=document.createElement("input"),u.__input.setAttribute("type","text"),c.default.bind(u.__input,"keyup",a),c.default.bind(u.__input,"change",a),c.default.bind(u.__input,"blur",s),c.default.bind(u.__input,"keydown",function(t){13===t.keyCode&&this.blur()}),u.updateDisplay(),u.domElement.appendChild(u.__input),u}return a(e,t),e.prototype.updateDisplay=function(){return c.default.isActive(this.__input)||(this.__input.value=this.getValue()),t.prototype.updateDisplay.call(this)},e}(u.default);e.default=h,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){var e=""+t;return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}e.__esModule=!0;var u=n(7),l=i(u),c=n(5),h=i(c),f=function(t){function e(n,i,a){r(this,e);var u=o(this,t.call(this,n,i)),l=a||{};return u.__min=l.min,u.__max=l.max,u.__step=l.step,h.default.isUndefined(u.__step)?0===u.initialValue?u.__impliedStep=1:u.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(u.initialValue))/Math.LN10))/10:u.__impliedStep=u.__step,u.__precision=s(u.__impliedStep),u}return a(e,t),e.prototype.setValue=function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),t.prototype.setValue.call(this,n)},e.prototype.min=function(t){return this.__min=t,this},e.prototype.max=function(t){return this.__max=t,this},e.prototype.step=function(t){return this.__step=t,this.__impliedStep=t,this.__precision=s(t),this},e}(l.default);e.default=f,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){var n=Math.pow(10,e);return Math.round(t*n)/n}e.__esModule=!0;var u=n(12),l=i(u),c=n(9),h=i(c),f=n(5),d=i(f),p=function(t){function e(n,i,a){function s(){var t=parseFloat(v.__input.value);d.default.isNaN(t)||v.setValue(t)}function u(){v.__onFinishChange&&v.__onFinishChange.call(v,v.getValue())}function l(){u()}function c(t){var e=m-t.clientY;v.setValue(v.getValue()+e*v.__impliedStep),m=t.clientY}function f(){h.default.unbind(window,"mousemove",c),h.default.unbind(window,"mouseup",f),u()}function p(t){h.default.bind(window,"mousemove",c),h.default.bind(window,"mouseup",f),m=t.clientY}r(this,e);var y=o(this,t.call(this,n,i,a));y.__truncationSuspended=!1;var v=y,m=void 0;return y.__input=document.createElement("input"),y.__input.setAttribute("type","text"),h.default.bind(y.__input,"change",s),h.default.bind(y.__input,"blur",l),h.default.bind(y.__input,"mousedown",p),h.default.bind(y.__input,"keydown",function(t){13===t.keyCode&&(v.__truncationSuspended=!0,this.blur(),v.__truncationSuspended=!1,u())}),y.updateDisplay(),y.domElement.appendChild(y.__input),y}return a(e,t),e.prototype.updateDisplay=function(){return this.__input.value=this.__truncationSuspended?this.getValue():s(this.getValue(),this.__precision),t.prototype.updateDisplay.call(this)},e}(l.default);e.default=p,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e,n,i,r){return i+(t-e)/(n-e)*(r-i)}e.__esModule=!0;var u=n(12),l=i(u),c=n(9),h=i(c),f=function(t){function e(n,i,a,u,l){function c(t){document.activeElement.blur(),h.default.bind(window,"mousemove",f),h.default.bind(window,"mouseup",d),f(t)}function f(t){t.preventDefault();var e=y.__background.getBoundingClientRect();return y.setValue(s(t.clientX,e.left,e.right,y.__min,y.__max)),!1}function d(){h.default.unbind(window,"mousemove",f),h.default.unbind(window,"mouseup",d),y.__onFinishChange&&y.__onFinishChange.call(y,y.getValue())}r(this,e);var p=o(this,t.call(this,n,i,{min:a,max:u,step:l})),y=p;return p.__background=document.createElement("div"),p.__foreground=document.createElement("div"),h.default.bind(p.__background,"mousedown",c),h.default.addClass(p.__background,"slider"),h.default.addClass(p.__foreground,"slider-fg"),p.updateDisplay(),p.__background.appendChild(p.__foreground),p.domElement.appendChild(p.__background),p}return a(e,t),e.prototype.updateDisplay=function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",t.prototype.updateDisplay.call(this)},e}(l.default);e.default=f,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}e.__esModule=!0;var s=n(7),u=i(s),l=n(9),c=i(l),h=function(t){function e(n,i,a){r(this,e);var s=o(this,t.call(this,n,i)),u=s;return s.__button=document.createElement("div"),s.__button.innerHTML=void 0===a?"Fire":a,c.default.bind(s.__button,"click",function(t){return t.preventDefault(),u.fire(),!1}),c.default.addClass(s.__button,"button"),s.domElement.appendChild(s.__button),s}return a(e,t),e.prototype.fire=function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())},e}(u.default);e.default=h,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e,n,i){t.style.background="",g.default.each(b,function(r){t.style.cssText+="background: "+r+"linear-gradient("+e+", "+n+" 0%, "+i+" 100%); "})}function u(t){t.style.background="",t.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",t.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",t.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}e.__esModule=!0;var l=n(7),c=i(l),h=n(9),f=i(h),d=n(2),p=i(d),y=n(3),v=i(y),m=n(5),g=i(m),_=function(t){function e(n,i){function a(t){y(t),f.default.bind(window,"mousemove",y),f.default.bind(window,"mouseup",l)}function l(){f.default.unbind(window,"mousemove",y),f.default.unbind(window,"mouseup",l),d()}function c(){var t=(0,v.default)(this.value);!1!==t?(b.__color.__state=t,b.setValue(b.__color.toOriginal())):this.value=""+b.__color}function h(){f.default.unbind(window,"mousemove",m),f.default.unbind(window,"mouseup",h),d()}function d(){b.__onFinishChange&&b.__onFinishChange.call(b,b.__color.toOriginal())}function y(t){t.preventDefault();var e=b.__saturation_field.getBoundingClientRect(),n=(t.clientX-e.left)/(e.right-e.left),i=1-(t.clientY-e.top)/(e.bottom-e.top);return i>1?i=1:i<0&&(i=0),n>1?n=1:n<0&&(n=0),b.__color.v=i,b.__color.s=n,b.setValue(b.__color.toOriginal()),!1}function m(t){t.preventDefault();var e=b.__hue_field.getBoundingClientRect(),n=1-(t.clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),b.__color.h=360*n,b.setValue(b.__color.toOriginal()),!1}r(this,e);var _=o(this,t.call(this,n,i));_.__color=new p.default(_.getValue()),_.__temp=new p.default(0);var b=_;_.domElement=document.createElement("div"),f.default.makeSelectable(_.domElement,!1),_.__selector=document.createElement("div"),_.__selector.className="selector",_.__saturation_field=document.createElement("div"),_.__saturation_field.className="saturation-field",_.__field_knob=document.createElement("div"),_.__field_knob.className="field-knob",_.__field_knob_border="2px solid ",_.__hue_knob=document.createElement("div"),_.__hue_knob.className="hue-knob",_.__hue_field=document.createElement("div"),_.__hue_field.className="hue-field",_.__input=document.createElement("input"),_.__input.type="text",_.__input_textShadow="0 1px 1px ",f.default.bind(_.__input,"keydown",function(t){13===t.keyCode&&c.call(this)}),f.default.bind(_.__input,"blur",c),f.default.bind(_.__selector,"mousedown",function(){f.default.addClass(this,"drag").bind(window,"mouseup",function(){f.default.removeClass(b.__selector,"drag")})});var w=document.createElement("div");return g.default.extend(_.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),g.default.extend(_.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:_.__field_knob_border+(_.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),g.default.extend(_.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),g.default.extend(_.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),g.default.extend(w.style,{width:"100%",height:"100%",background:"none"}),s(w,"top","rgba(0,0,0,0)","#000"),g.default.extend(_.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),u(_.__hue_field),g.default.extend(_.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:_.__input_textShadow+"rgba(0,0,0,0.7)"}),f.default.bind(_.__saturation_field,"mousedown",a),f.default.bind(_.__field_knob,"mousedown",a),f.default.bind(_.__hue_field,"mousedown",function(t){m(t),f.default.bind(window,"mousemove",m),f.default.bind(window,"mouseup",h)}),_.__saturation_field.appendChild(w),_.__selector.appendChild(_.__field_knob),_.__selector.appendChild(_.__saturation_field),_.__selector.appendChild(_.__hue_field),_.__hue_field.appendChild(_.__hue_knob),_.domElement.appendChild(_.__input),_.domElement.appendChild(_.__selector),_.updateDisplay(),_}return a(e,t),e.prototype.updateDisplay=function(){var t=(0,v.default)(this.getValue());if(!1!==t){var e=!1;g.default.each(p.default.COMPONENTS,function(n){if(!g.default.isUndefined(t[n])&&!g.default.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}},this),e&&g.default.extend(this.__color.__state,t)}g.default.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;g.default.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,s(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=""+this.__color,g.default.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})},e}(c.default),b=["-moz-","-o-","-webkit-","-ms-",""];e.default=_,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e,n){var i=document.createElement("li");return e&&i.appendChild(e),n?t.__ul.insertBefore(i,n):t.__ul.appendChild(i),t.onResize(),i}function o(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function a(t,e,n){if(n.__li=e,n.__gui=t,X.default.extend(n,{options:function(e){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),u(t,n.object,n.property,{before:i,factoryArgs:[X.default.toArray(arguments)]})}if(X.default.isArray(e)||X.default.isObject(e)){var r=n.__li.nextElementSibling;return n.remove(),u(t,n.object,n.property,{before:r,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof L.default){var i=new M.default(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});X.default.each(["updateDisplay","onChange","onFinishChange","step"],function(t){var e=n[t],r=i[t];n[t]=i[t]=function(){var t=Array.prototype.slice.call(arguments);return r.apply(i,t),e.apply(n,t)}}),V.default.addClass(e,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof M.default){var r=function(e){if(X.default.isNumber(n.__min)&&X.default.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,r=n.__gui.__listening.indexOf(n)>-1;n.remove();var o=u(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return o.name(i),r&&o.listen(),o}return e};n.min=X.default.compose(r,n.min),n.max=X.default.compose(r,n.max)}else n instanceof C.default?(V.default.bind(e,"click",function(){V.default.fakeEvent(n.__checkbox,"click")}),V.default.bind(n.__checkbox,"click",function(t){t.stopPropagation()})):n instanceof A.default?(V.default.bind(e,"click",function(){V.default.fakeEvent(n.__button,"click")}),V.default.bind(e,"mouseover",function(){V.default.addClass(n.__button,"hover")}),V.default.bind(e,"mouseout",function(){V.default.removeClass(n.__button,"hover")})):n instanceof D.default&&(V.default.addClass(e,"color"),n.updateDisplay=X.default.compose(function(t){return e.style.borderLeftColor=""+n.__color,t},n.updateDisplay),n.updateDisplay());n.setValue=X.default.compose(function(e){return t.getRoot().__preset_select&&n.isModified()&&o(t.getRoot(),!0),e},n.setValue)}function s(t,e){var n=t.getRoot(),i=n.__rememberedObjects.indexOf(e.object);if(-1!==i){var r=n.__rememberedObjectIndecesToControllers[i];if(void 0===r&&(r={},n.__rememberedObjectIndecesToControllers[i]=r),r[e.property]=e,n.load&&n.load.remembered){var o=n.load.remembered,a=void 0;if(o[t.preset])a=o[t.preset];else{if(!o[W])return;a=o[W]}if(a[i]&&void 0!==a[i][e.property]){var s=a[i][e.property];e.initialValue=s,e.setValue(s)}}}}function u(t,e,n,i){if(void 0===e[n])throw Error('Object "'+e+'" has no property "'+n+'"');var o=void 0;if(i.color)o=new D.default(e,n);else{var u=[e,n].concat(i.factoryArgs);o=E.default.apply(t,u)}i.before instanceof S.default&&(i.before=i.before.__li),s(t,o),V.default.addClass(o.domElement,"c");var l=document.createElement("span");V.default.addClass(l,"property-name"),l.innerHTML=o.property;var c=document.createElement("div");c.appendChild(l),c.appendChild(o.domElement);var h=r(t,c,i.before);return V.default.addClass(h,tt.CLASS_CONTROLLER_ROW),o instanceof D.default?V.default.addClass(h,"color"):V.default.addClass(h,g(o.getValue())),a(t,h,o),t.__controllers.push(o),o}function l(t,e){return document.location.href+"."+e}function c(t,e,n){var i=document.createElement("option");i.innerHTML=e,i.value=e,t.__preset_select.appendChild(i),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function h(t,e){e.style.display=t.useLocalStorage?"block":"none"}function f(t){var e=t.__save_row=document.createElement("li");V.default.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),V.default.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",V.default.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",V.default.addClass(i,"button"),V.default.addClass(i,"save");var r=document.createElement("span");r.innerHTML="New",V.default.addClass(r,"button"),V.default.addClass(r,"save-as");var o=document.createElement("span");o.innerHTML="Revert",V.default.addClass(o,"button"),V.default.addClass(o,"revert");var a=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?X.default.each(t.load.remembered,function(e,n){c(t,n,n===t.preset)}):c(t,W,!1),V.default.bind(a,"change",function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value}),e.appendChild(a),e.appendChild(n),e.appendChild(i),e.appendChild(r),e.appendChild(o),K){var s=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(l(t,"isLocal"))&&u.setAttribute("checked","checked"),h(t,s),V.default.bind(u,"change",function(){t.useLocalStorage=!t.useLocalStorage,h(t,s)})}var f=document.getElementById("dg-new-constructor");V.default.bind(f,"keydown",function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||q.hide()}),V.default.bind(n,"click",function(){f.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),q.show(),f.focus(),f.select()}),V.default.bind(i,"click",function(){t.save()}),V.default.bind(r,"click",function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)}),V.default.bind(o,"click",function(){t.revert()})}function d(t){function e(e){return e.preventDefault(),t.width+=r-e.clientX,t.onResize(),r=e.clientX,!1}function n(){V.default.removeClass(t.__closeButton,tt.CLASS_DRAG),V.default.unbind(window,"mousemove",e),V.default.unbind(window,"mouseup",n)}function i(i){return i.preventDefault(),r=i.clientX,V.default.addClass(t.__closeButton,tt.CLASS_DRAG),V.default.bind(window,"mousemove",e),V.default.bind(window,"mouseup",n),!1}var r=void 0;t.__resize_handle=document.createElement("div"),X.default.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),V.default.bind(t.__resize_handle,"mousedown",i),V.default.bind(t.__closeButton,"mousedown",i),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function p(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function y(t,e){var n={};return X.default.each(t.__rememberedObjects,function(i,r){var o={},a=t.__rememberedObjectIndecesToControllers[r];X.default.each(a,function(t,n){o[n]=e?t.initialValue:t.getValue()}),n[r]=o}),n}function v(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}function m(t){0!==t.length&&N.default.call(window,function(){m(t)}),X.default.each(t,function(t){t.updateDisplay()})}e.__esModule=!0;var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_=n(18),b=i(_),w=n(19),x=i(w),k=n(20),E=i(k),O=n(7),S=i(O),T=n(8),C=i(T),P=n(15),A=i(P),R=n(13),M=i(R),j=n(14),L=i(j),F=n(16),D=i(F),B=n(21),N=i(B),I=n(22),G=i(I),U=n(9),V=i(U),H=n(5),X=i(H),z=n(23),Y=i(z);b.default.inject(Y.default);var W="Default",K=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}}(),q=void 0,J=!0,Q=void 0,Z=!1,$=[],tt=function t(e){var n=this,i=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),V.default.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=X.default.defaults(i,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),i=X.default.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),X.default.isUndefined(i.load)?i.load={preset:W}:i.preset&&(i.load.preset=i.preset),X.default.isUndefined(i.parent)&&i.hideable&&$.push(this),i.resizable=X.default.isUndefined(i.parent)&&i.resizable,i.autoPlace&&X.default.isUndefined(i.scrollable)&&(i.scrollable=!0);var o=K&&"true"===localStorage.getItem(l(this,"isLocal")),a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(t){n.parent?n.getRoot().preset=t:i.load.preset=t,v(this),n.revert()}},width:{get:function(){return i.width},set:function(t){i.width=t,p(n,t)}},name:{get:function(){return i.name},set:function(t){i.name=t,titleRowName&&(titleRowName.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(e){i.closed=e,i.closed?V.default.addClass(n.__ul,t.CLASS_CLOSED):V.default.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return o},set:function(t){K&&(o=t,t?V.default.bind(window,"unload",a):V.default.unbind(window,"unload",a),localStorage.setItem(l(n,"isLocal"),t))}}}),X.default.isUndefined(i.parent)){if(i.closed=!1,V.default.addClass(this.domElement,t.CLASS_MAIN),V.default.makeSelectable(this.domElement,!1),K&&o){n.useLocalStorage=!0;var s=localStorage.getItem(l(this,"gui"));s&&(i.load=JSON.parse(s))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,V.default.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),i.closeOnTop?(V.default.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(V.default.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),V.default.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===i.closed&&(i.closed=!0);var u=document.createTextNode(i.name);V.default.addClass(u,"controller-name");var c=r(n,u),h=function(t){return t.preventDefault(),n.closed=!n.closed,!1};V.default.addClass(this.__ul,t.CLASS_CLOSED),V.default.addClass(c,"title"),V.default.bind(c,"click",h),i.closed||(this.closed=!1)}i.autoPlace&&(X.default.isUndefined(i.parent)&&(J&&(Q=document.createElement("div"),V.default.addClass(Q,"dg"),V.default.addClass(Q,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Q),J=!1),Q.appendChild(this.domElement),V.default.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||p(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},V.default.bind(window,"resize",this.__resizeHandler),V.default.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),V.default.bind(this.__ul,"transitionend",this.__resizeHandler),V.default.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&d(this),a=function(){K&&"true"===localStorage.getItem(l(n,"isLocal"))&&localStorage.setItem(l(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=a,i.parent||function(){var t=n.getRoot();t.width+=1,X.default.defer(function(){t.width-=1})}()};tt.toggleHide=function(){Z=!Z,X.default.each($,function(t){t.domElement.style.display=Z?"none":""})},tt.CLASS_AUTO_PLACE="a",tt.CLASS_AUTO_PLACE_CONTAINER="ac",tt.CLASS_MAIN="main",tt.CLASS_CONTROLLER_ROW="cr",tt.CLASS_TOO_TALL="taller-than-window",tt.CLASS_CLOSED="closed",tt.CLASS_CLOSE_BUTTON="close-button",tt.CLASS_CLOSE_TOP="close-top",tt.CLASS_CLOSE_BOTTOM="close-bottom",tt.CLASS_DRAG="drag",tt.DEFAULT_WIDTH=245,tt.TEXT_CLOSED="Close Controls",tt.TEXT_OPEN="Open Controls",tt._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||tt.toggleHide()},V.default.bind(window,"keydown",tt._keydownHandler,!1),X.default.extend(tt.prototype,{add:function(t,e){return u(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return u(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;X.default.defer(function(){e.onResize()})},destroy:function(){this.autoPlace&&Q.removeChild(this.domElement),V.default.unbind(window,"keydown",tt._keydownHandler,!1),V.default.unbind(window,"resize",this.__resizeHandler),this.saveToLocalStorageIfPossible&&V.default.unbind(window,"unload",this.saveToLocalStorageIfPossible)},addFolder:function(t){if(void 0!==this.__folders[t])throw Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new tt(e);this.__folders[t]=n;var i=r(this,n.domElement);return V.default.addClass(i,"folder"),n},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=V.default.getOffset(t.__ul).top,n=0;X.default.each(t.__ul.childNodes,function(e){t.autoPlace&&e===t.__save_row||(n+=V.default.getHeight(e))}),window.innerHeight-e-20<n?(V.default.addClass(t.domElement,tt.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(V.default.removeClass(t.domElement,tt.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&X.default.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:X.default.debounce(function(){this.onResize()},50),remember:function(){if(X.default.isUndefined(q)&&(q=new G.default,q.domElement.innerHTML=x.default),this.parent)throw Error("You can only call remember on a top level GUI.");var t=this;X.default.each(Array.prototype.slice.call(arguments),function(e){0===t.__rememberedObjects.length&&f(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&p(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=y(this)),t.folders={},X.default.each(this.__folders,function(e,n){t.folders[n]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=y(this),o(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[W]=y(this,!0)),this.load.remembered[t]=y(this),this.preset=t,c(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){X.default.each(this.__controllers,function(e){this.getRoot().load.remembered?s(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),X.default.each(this.__folders,function(t){t.revert(t)}),t||o(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&m(this.__listening)},updateDisplay:function(){X.default.each(this.__controllers,function(t){t.updateDisplay()}),X.default.each(this.__folders,function(t){t.updateDisplay()})}}),e.default=tt,t.exports=e.default},function(t,e){"use strict";t.exports={load:function(t,e){var n=e||document,i=n.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=t,n.getElementsByTagName("head")[0].appendChild(i)},inject:function(t,e){var n=e||document,i=document.createElement("style");i.type="text/css",i.innerHTML=t;var r=n.getElementsByTagName("head")[0];try{r.appendChild(i)}catch(t){}}}},function(t,e){t.exports='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(10),o=i(r),a=n(13),s=i(a),u=n(14),l=i(u),c=n(11),h=i(c),f=n(15),d=i(f),p=n(8),y=i(p),v=n(5),m=i(v),g=function(t,e){var n=t[e];return m.default.isArray(arguments[2])||m.default.isObject(arguments[2])?new o.default(t,e,arguments[2]):m.default.isNumber(n)?m.default.isNumber(arguments[2])&&m.default.isNumber(arguments[3])?m.default.isNumber(arguments[4])?new l.default(t,e,arguments[2],arguments[3],arguments[4]):new l.default(t,e,arguments[2],arguments[3]):m.default.isNumber(arguments[4])?new s.default(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new s.default(t,e,{min:arguments[2],max:arguments[3]}):m.default.isString(n)?new h.default(t,e):m.default.isFunction(n)?new d.default(t,e,""):m.default.isBoolean(n)?new y.default(t,e):null};e.default=g,t.exports=e.default},function(t,e){"use strict";function n(t){setTimeout(t,1e3/60)}e.__esModule=!0,e.default=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||n,t.exports=e.default},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.__esModule=!0;var o=n(9),a=i(o),s=n(5),u=i(s),l=function(){function t(){r(this,t),this.backgroundElement=document.createElement("div"),u.default.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),a.default.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),u.default.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;a.default.bind(this.backgroundElement,"click",function(){e.hide()})}return t.prototype.show=function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),u.default.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})},t.prototype.hide=function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",a.default.unbind(t.domElement,"webkitTransitionEnd",e),a.default.unbind(t.domElement,"transitionend",e),a.default.unbind(t.domElement,"oTransitionEnd",e)};a.default.bind(this.domElement,"webkitTransitionEnd",e),a.default.bind(this.domElement,"transitionend",e),a.default.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},t.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.default.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-a.default.getHeight(this.domElement)/2+"px"},t}();e.default=l,t.exports=e.default},function(t,e,n){e=t.exports=n(24)(),e.push([t.id,".dg {\n  /** Clear list styles */\n  /* Auto-place container */\n  /* Auto-placed GUI's */\n  /* Line items that don't contain folders. */\n  /** Folder names */\n  /** Hides closed items */\n  /** Controller row */\n  /** Name-half (left) */\n  /** Controller-half (right) */\n  /** Controller placement */\n  /** Shorter number boxes when slider is present. */\n  /** Ensure the entire boolean and function row shows a hand */\n  /** allow overflow for color selector */ }\n  .dg ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n  .dg.ac {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 0;\n    z-index: 0; }\n  .dg:not(.ac) .main {\n    /** Exclude mains in ac so that we don't hide close button */\n    overflow: hidden; }\n  .dg.main {\n    -webkit-transition: opacity 0.1s linear;\n    -o-transition: opacity 0.1s linear;\n    -moz-transition: opacity 0.1s linear;\n    transition: opacity 0.1s linear; }\n    .dg.main.taller-than-window {\n      overflow-y: auto; }\n      .dg.main.taller-than-window .close-button {\n        opacity: 1;\n        /* TODO, these are style notes */\n        margin-top: -1px;\n        border-top: 1px solid #2c2c2c; }\n    .dg.main ul.closed .close-button {\n      opacity: 1 !important; }\n    .dg.main:hover .close-button,\n    .dg.main .close-button.drag {\n      opacity: 1; }\n    .dg.main .close-button {\n      /*opacity: 0;*/\n      -webkit-transition: opacity 0.1s linear;\n      -o-transition: opacity 0.1s linear;\n      -moz-transition: opacity 0.1s linear;\n      transition: opacity 0.1s linear;\n      border: 0;\n      line-height: 19px;\n      height: 20px;\n      /* TODO, these are style notes */\n      cursor: pointer;\n      text-align: center;\n      background-color: #000; }\n      .dg.main .close-button.close-top {\n        position: relative; }\n      .dg.main .close-button.close-bottom {\n        position: absolute; }\n      .dg.main .close-button:hover {\n        background-color: #111; }\n  .dg.a {\n    float: right;\n    margin-right: 15px;\n    overflow-y: visible; }\n    .dg.a.has-save > ul.close-top {\n      margin-top: 0; }\n    .dg.a.has-save > ul.close-bottom {\n      margin-top: 27px; }\n    .dg.a.has-save > ul.closed {\n      margin-top: 0; }\n    .dg.a .save-row {\n      top: 0;\n      z-index: 1002; }\n      .dg.a .save-row.close-top {\n        position: relative; }\n      .dg.a .save-row.close-bottom {\n        position: fixed; }\n  .dg li {\n    -webkit-transition: height 0.1s ease-out;\n    -o-transition: height 0.1s ease-out;\n    -moz-transition: height 0.1s ease-out;\n    transition: height 0.1s ease-out;\n    -webkit-transition: overflow 0.1s linear;\n    -o-transition: overflow 0.1s linear;\n    -moz-transition: overflow 0.1s linear;\n    transition: overflow 0.1s linear; }\n  .dg li:not(.folder) {\n    cursor: auto;\n    height: 27px;\n    line-height: 27px;\n    padding: 0 4px 0 5px; }\n  .dg li.folder {\n    padding: 0;\n    border-left: 4px solid transparent; }\n  .dg li.title {\n    cursor: pointer;\n    margin-left: -4px; }\n  .dg .closed li:not(.title),\n  .dg .closed ul li,\n  .dg .closed ul li > * {\n    height: 0;\n    overflow: hidden;\n    border: 0; }\n  .dg .cr {\n    clear: both;\n    padding-left: 3px;\n    height: 27px;\n    overflow: hidden; }\n  .dg .property-name {\n    cursor: default;\n    float: left;\n    clear: left;\n    width: 40%;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dg .c {\n    float: left;\n    width: 60%;\n    position: relative; }\n  .dg .c input[type=text] {\n    border: 0;\n    margin-top: 4px;\n    padding: 3px;\n    width: 100%;\n    float: right; }\n  .dg .has-slider input[type=text] {\n    width: 30%;\n    /*display: none;*/\n    margin-left: 0; }\n  .dg .slider {\n    float: left;\n    width: 66%;\n    margin-left: -5px;\n    margin-right: 0;\n    height: 19px;\n    margin-top: 4px; }\n  .dg .slider-fg {\n    height: 100%; }\n  .dg .c input[type=checkbox] {\n    margin-top: 7px; }\n  .dg .c select {\n    margin-top: 5px; }\n  .dg .cr.function,\n  .dg .cr.function .property-name,\n  .dg .cr.function *,\n  .dg .cr.boolean,\n  .dg .cr.boolean * {\n    cursor: pointer; }\n  .dg .cr.color {\n    overflow: visible; }\n  .dg .selector {\n    display: none;\n    position: absolute;\n    margin-left: -9px;\n    margin-top: 23px;\n    z-index: 10; }\n  .dg .c:hover .selector,\n  .dg .selector.drag {\n    display: block; }\n  .dg li.save-row {\n    padding: 0; }\n    .dg li.save-row .button {\n      display: inline-block;\n      padding: 0px 6px; }\n  .dg.dialogue {\n    background-color: #222;\n    width: 460px;\n    padding: 15px;\n    font-size: 13px;\n    line-height: 15px; }\n\n/* TODO Separate style and structure */\n#dg-new-constructor {\n  padding: 10px;\n  color: #222;\n  font-family: Monaco, monospace;\n  font-size: 10px;\n  border: 0;\n  resize: none;\n  box-shadow: inset 1px 1px 1px #888;\n  word-wrap: break-word;\n  margin: 12px 0;\n  display: block;\n  width: 440px;\n  overflow-y: scroll;\n  height: 100px;\n  position: relative; }\n\n#dg-local-explain {\n  display: none;\n  font-size: 11px;\n  line-height: 17px;\n  border-radius: 3px;\n  background-color: #333;\n  padding: 8px;\n  margin-top: 10px; }\n  #dg-local-explain code {\n    font-size: 10px; }\n\n#dat-gui-save-locally {\n  display: none; }\n\n/** Main type */\n.dg {\n  color: #eee;\n  font: 11px 'Lucida Grande', sans-serif;\n  text-shadow: 0 -1px 0 #111;\n  /** Auto place */\n  /* Controller row, <li> */\n  /** Controllers */ }\n  .dg.main {\n    /** Scrollbar */ }\n    .dg.main::-webkit-scrollbar {\n      width: 5px;\n      background: #1a1a1a; }\n    .dg.main::-webkit-scrollbar-corner {\n      height: 0;\n      display: none; }\n    .dg.main::-webkit-scrollbar-thumb {\n      border-radius: 5px;\n      background: #676767; }\n  .dg li:not(.folder) {\n    background: #1a1a1a;\n    border-bottom: 1px solid #2c2c2c; }\n  .dg li.save-row {\n    line-height: 25px;\n    background: #dad5cb;\n    border: 0; }\n    .dg li.save-row select {\n      margin-left: 5px;\n      width: 108px; }\n    .dg li.save-row .button {\n      margin-left: 5px;\n      margin-top: 1px;\n      border-radius: 2px;\n      font-size: 9px;\n      line-height: 7px;\n      padding: 4px 4px 5px 4px;\n      background: #c5bdad;\n      color: #fff;\n      text-shadow: 0 1px 0 #b0a58f;\n      box-shadow: 0 -1px 0 #b0a58f;\n      cursor: pointer; }\n      .dg li.save-row .button.gears {\n        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\n        height: 7px;\n        width: 8px; }\n      .dg li.save-row .button:hover {\n        background-color: #bab19e;\n        box-shadow: 0 -1px 0 #b0a58f; }\n  .dg li.folder {\n    border-bottom: 0; }\n  .dg li.title {\n    padding-left: 16px;\n    background: #000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\n  .dg .closed li.title {\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\n  .dg .cr.boolean {\n    border-left: 3px solid #806787; }\n  .dg .cr.color {\n    border-left: 3px solid; }\n  .dg .cr.function {\n    border-left: 3px solid #e61d5f; }\n  .dg .cr.number {\n    border-left: 3px solid #2FA1D6; }\n    .dg .cr.number input[type=text] {\n      color: #2FA1D6; }\n  .dg .cr.string {\n    border-left: 3px solid #1ed36f; }\n    .dg .cr.string input[type=text] {\n      color: #1ed36f; }\n  .dg .cr.function:hover, .dg .cr.boolean:hover {\n    background: #111; }\n  .dg .c input[type=text] {\n    background: #303030;\n    outline: none; }\n    .dg .c input[type=text]:hover {\n      background: #3c3c3c; }\n    .dg .c input[type=text]:focus {\n      background: #494949;\n      color: #fff; }\n  .dg .c .slider {\n    background: #303030;\n    cursor: ew-resize; }\n  .dg .c .slider-fg {\n    background: #2FA1D6;\n    max-width: 100%; }\n  .dg .c .slider:hover {\n    background: #3c3c3c; }\n    .dg .c .slider:hover .slider-fg {\n      background: #44abda; }\n",""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var n=this[e];n[2]?t.push("@media "+n[2]+"{"+n[1]+"}"):t.push(n[1])}return t.join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},r=0;r<this.length;r++){var o=this[r][0];"number"==typeof o&&(i[o]=!0)}for(r=0;r<e.length;r++){var a=e[r];"number"==typeof a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}}])}()}()}]);